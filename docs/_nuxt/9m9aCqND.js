import{p as on,q as Ye,r as Dt,s as an,t as pe,F as Bt,u as ce,v as re,f as ln,w as cn,D as un,x as he,y as ye,z as ee,b as we,E as Q,V as B,I as fn,G as hn,O as kt,H as mn,J as dn,k as ge,K as pn,N as Ot,U as Ft,X as Ze,Y as Nt,Z as Ue,j as Je,_ as et,$ as Ht,a0 as gn,i as De,a1 as xn,g as Ie,L as _t,a2 as Ut,a3 as yn,a4 as zt,a5 as ze,d as vn,M as Gt,a6 as wn,a7 as An,a8 as Sn,a9 as Tn,aa as Wt,ab as ht,Q as le,ac as Mn,ad as Cn,ae as bn,af as En,ag as Pn,ah as Rn,ai as Ln,aj as Vn,ak as In,al as mt,am as dt,an as pt,ao as gt,ap as tt,aq as Dn,ar as Bn,as as Kt,at as kn,au as On,av as Fn,B as Nn,aw as Hn,ax as _n,ay as Un,az as zn,aA as Gn,aB as Wn,h as Kn,aC as nt,aD as jt,aE as xt,aF as Xt,P as Le,aG as jn,aH as yt,aI as Xn,C as Qn}from"./DuCXoQ7A.js";function vt(A,t){if(t===on)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),A;if(t===Ye||t===Dt){let n=A.getIndex();if(n===null){const s=[],o=A.getAttribute("position");if(o!==void 0){for(let r=0;r<o.count;r++)s.push(r);A.setIndex(s),n=A.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),A}const l=n.count-2,i=[];if(t===Ye)for(let s=1;s<=l;s++)i.push(n.getX(0)),i.push(n.getX(s)),i.push(n.getX(s+1));else for(let s=0;s<l;s++)s%2===0?(i.push(n.getX(s)),i.push(n.getX(s+1)),i.push(n.getX(s+2))):(i.push(n.getX(s+2)),i.push(n.getX(s+1)),i.push(n.getX(s)));i.length/3!==l&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const e=A.clone();return e.setIndex(i),e.clearGroups(),e}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),A}class ui extends an{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Jn(n)}),this.register(function(n){return new es(n)}),this.register(function(n){return new cs(n)}),this.register(function(n){return new us(n)}),this.register(function(n){return new fs(n)}),this.register(function(n){return new ns(n)}),this.register(function(n){return new ss(n)}),this.register(function(n){return new is(n)}),this.register(function(n){return new rs(n)}),this.register(function(n){return new qn(n)}),this.register(function(n){return new os(n)}),this.register(function(n){return new ts(n)}),this.register(function(n){return new ls(n)}),this.register(function(n){return new as(n)}),this.register(function(n){return new Zn(n)}),this.register(function(n){return new hs(n)}),this.register(function(n){return new ms(n)})}load(t,n,l,i){const e=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const u=pe.extractUrlBase(t);s=pe.resolveURL(u,this.path)}else s=pe.extractUrlBase(t);this.manager.itemStart(t);const o=function(u){i?i(u):console.error(u),e.manager.itemError(t),e.manager.itemEnd(t)},r=new Bt(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,function(u){try{e.parse(u,s,function(c){n(c),e.manager.itemEnd(t)},o)}catch(c){o(c)}},l,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,l,i){let e;const s={},o={},r=new TextDecoder;if(typeof t=="string")e=JSON.parse(t);else if(t instanceof ArrayBuffer)if(r.decode(new Uint8Array(t,0,4))===Qt){try{s[N.KHR_BINARY_GLTF]=new ds(t)}catch(f){i&&i(f);return}e=JSON.parse(s[N.KHR_BINARY_GLTF].content)}else e=JSON.parse(r.decode(t));else e=t;if(e.asset===void 0||e.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new Es(e,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const f=this.pluginCallbacks[c](u);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[f.name]=f,s[f.name]=!0}if(e.extensionsUsed)for(let c=0;c<e.extensionsUsed.length;++c){const f=e.extensionsUsed[c],h=e.extensionsRequired||[];switch(f){case N.KHR_MATERIALS_UNLIT:s[f]=new $n;break;case N.KHR_DRACO_MESH_COMPRESSION:s[f]=new ps(e,this.dracoLoader);break;case N.KHR_TEXTURE_TRANSFORM:s[f]=new gs;break;case N.KHR_MESH_QUANTIZATION:s[f]=new xs;break;default:h.indexOf(f)>=0&&o[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(s),u.setPlugins(o),u.parse(l,i)}parseAsync(t,n){const l=this;return new Promise(function(i,e){l.parse(t,n,i,e)})}}function Yn(){let A={};return{get:function(t){return A[t]},add:function(t,n){A[t]=n},remove:function(t){delete A[t]},removeAll:function(){A={}}}}const N={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Zn{constructor(t){this.parser=t,this.name=N.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let l=0,i=n.length;l<i;l++){const e=n[l];e.extensions&&e.extensions[this.name]&&e.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,e.extensions[this.name].light)}}_loadLight(t){const n=this.parser,l="light:"+t;let i=n.cache.get(l);if(i)return i;const e=n.json,r=((e.extensions&&e.extensions[this.name]||{}).lights||[])[t];let u;const c=new ce(16777215);r.color!==void 0&&c.setRGB(r.color[0],r.color[1],r.color[2],re);const f=r.range!==void 0?r.range:0;switch(r.type){case"directional":u=new un(c),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new cn(c),u.distance=f;break;case"spot":u=new ln(c),u.distance=f,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,u.angle=r.spot.outerConeAngle,u.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return u.position.set(0,0,0),u.decay=2,se(u,r),r.intensity!==void 0&&(u.intensity=r.intensity),u.name=n.createUniqueName(r.name||"light_"+t),i=Promise.resolve(u),n.cache.add(l,i),i}getDependency(t,n){if(t==="light")return this._loadLight(n)}createNodeAttachment(t){const n=this,l=this.parser,e=l.json.nodes[t],o=(e.extensions&&e.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(r){return l._getNodeRef(n.cache,o,r)})}}class $n{constructor(){this.name=N.KHR_MATERIALS_UNLIT}getMaterialType(){return he}extendParams(t,n,l){const i=[];t.color=new ce(1,1,1),t.opacity=1;const e=n.pbrMetallicRoughness;if(e){if(Array.isArray(e.baseColorFactor)){const s=e.baseColorFactor;t.color.setRGB(s[0],s[1],s[2],re),t.opacity=s[3]}e.baseColorTexture!==void 0&&i.push(l.assignTexture(t,"map",e.baseColorTexture,ye))}return Promise.all(i)}}class qn{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=i.extensions[this.name].emissiveStrength;return e!==void 0&&(n.emissiveIntensity=e),Promise.resolve()}}class Jn{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(n.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&e.push(l.assignTexture(n,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&e.push(l.assignTexture(n,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(e.push(l.assignTexture(n,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const o=s.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new we(o,o)}return Promise.all(e)}}class es{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_DISPERSION}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=i.extensions[this.name];return n.dispersion=e.dispersion!==void 0?e.dispersion:0,Promise.resolve()}}class ts{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[],s=i.extensions[this.name];return s.iridescenceFactor!==void 0&&(n.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&e.push(l.assignTexture(n,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(n.iridescenceIOR=s.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&e.push(l.assignTexture(n,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(e)}}class ns{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_SHEEN}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[];n.sheenColor=new ce(0,0,0),n.sheenRoughness=0,n.sheen=1;const s=i.extensions[this.name];if(s.sheenColorFactor!==void 0){const o=s.sheenColorFactor;n.sheenColor.setRGB(o[0],o[1],o[2],re)}return s.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&e.push(l.assignTexture(n,"sheenColorMap",s.sheenColorTexture,ye)),s.sheenRoughnessTexture!==void 0&&e.push(l.assignTexture(n,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(e)}}class ss{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(n.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&e.push(l.assignTexture(n,"transmissionMap",s.transmissionTexture)),Promise.all(e)}}class is{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_VOLUME}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[],s=i.extensions[this.name];n.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&e.push(l.assignTexture(n,"thicknessMap",s.thicknessTexture)),n.attenuationDistance=s.attenuationDistance||1/0;const o=s.attenuationColor||[1,1,1];return n.attenuationColor=new ce().setRGB(o[0],o[1],o[2],re),Promise.all(e)}}class rs{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_IOR}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=i.extensions[this.name];return n.ior=e.ior!==void 0?e.ior:1.5,Promise.resolve()}}class os{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_SPECULAR}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[],s=i.extensions[this.name];n.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&e.push(l.assignTexture(n,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return n.specularColor=new ce().setRGB(o[0],o[1],o[2],re),s.specularColorTexture!==void 0&&e.push(l.assignTexture(n,"specularColorMap",s.specularColorTexture,ye)),Promise.all(e)}}class as{constructor(t){this.parser=t,this.name=N.EXT_MATERIALS_BUMP}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[],s=i.extensions[this.name];return n.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&e.push(l.assignTexture(n,"bumpMap",s.bumpTexture)),Promise.all(e)}}class ls{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const l=this.parser.json.materials[t];return!l.extensions||!l.extensions[this.name]?null:ee}extendMaterialParams(t,n){const l=this.parser,i=l.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const e=[],s=i.extensions[this.name];return s.anisotropyStrength!==void 0&&(n.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(n.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&e.push(l.assignTexture(n,"anisotropyMap",s.anisotropyTexture)),Promise.all(e)}}class cs{constructor(t){this.parser=t,this.name=N.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,l=n.json,i=l.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const e=i.extensions[this.name],s=n.options.ktx2Loader;if(!s){if(l.extensionsRequired&&l.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,e.source,s)}}class us{constructor(t){this.parser=t,this.name=N.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,l=this.parser,i=l.json,e=i.textures[t];if(!e.extensions||!e.extensions[n])return null;const s=e.extensions[n],o=i.images[s.source];let r=l.textureLoader;if(o.uri){const u=l.options.manager.getHandler(o.uri);u!==null&&(r=u)}return this.detectSupport().then(function(u){if(u)return l.loadTextureImage(t,s.source,r);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return l.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class fs{constructor(t){this.parser=t,this.name=N.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const n=this.name,l=this.parser,i=l.json,e=i.textures[t];if(!e.extensions||!e.extensions[n])return null;const s=e.extensions[n],o=i.images[s.source];let r=l.textureLoader;if(o.uri){const u=l.options.manager.getHandler(o.uri);u!==null&&(r=u)}return this.detectSupport().then(function(u){if(u)return l.loadTextureImage(t,s.source,r);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return l.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class hs{constructor(t){this.name=N.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,l=n.bufferViews[t];if(l.extensions&&l.extensions[this.name]){const i=l.extensions[this.name],e=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return e.then(function(o){const r=i.byteOffset||0,u=i.byteLength||0,c=i.count,f=i.byteStride,h=new Uint8Array(o,r,u);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(c,f,h,i.mode,i.filter).then(function(a){return a.buffer}):s.ready.then(function(){const a=new ArrayBuffer(c*f);return s.decodeGltfBuffer(new Uint8Array(a),c,f,h,i.mode,i.filter),a})})}else return null}}class ms{constructor(t){this.name=N.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const n=this.parser.json,l=n.nodes[t];if(!l.extensions||!l.extensions[this.name]||l.mesh===void 0)return null;const i=n.meshes[l.mesh];for(const u of i.primitives)if(u.mode!==q.TRIANGLES&&u.mode!==q.TRIANGLE_STRIP&&u.mode!==q.TRIANGLE_FAN&&u.mode!==void 0)return null;const s=l.extensions[this.name].attributes,o=[],r={};for(const u in s)o.push(this.parser.getDependency("accessor",s[u]).then(c=>(r[u]=c,r[u])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(u=>{const c=u.pop(),f=c.isGroup?c.children:[c],h=u[0].count,a=[];for(const m of f){const d=new Q,p=new B,x=new le,w=new B(1,1,1),T=new fn(m.geometry,m.material,h);for(let M=0;M<h;M++)r.TRANSLATION&&p.fromBufferAttribute(r.TRANSLATION,M),r.ROTATION&&x.fromBufferAttribute(r.ROTATION,M),r.SCALE&&w.fromBufferAttribute(r.SCALE,M),T.setMatrixAt(M,d.compose(p,x,w));for(const M in r)if(M==="_COLOR_0"){const g=r[M];T.instanceColor=new hn(g.array,g.itemSize,g.normalized)}else M!=="TRANSLATION"&&M!=="ROTATION"&&M!=="SCALE"&&m.geometry.setAttribute(M,r[M]);kt.prototype.copy.call(T,m),this.parser.assignFinalMaterial(T),a.push(T)}return c.isGroup?(c.clear(),c.add(...a),c):a[0]}))}}const Qt="glTF",de=12,wt={JSON:1313821514,BIN:5130562};class ds{constructor(t){this.name=N.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,de),l=new TextDecoder;if(this.header={magic:l.decode(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Qt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-de,e=new DataView(t,de);let s=0;for(;s<i;){const o=e.getUint32(s,!0);s+=4;const r=e.getUint32(s,!0);if(s+=4,r===wt.JSON){const u=new Uint8Array(t,de+s,o);this.content=l.decode(u)}else if(r===wt.BIN){const u=de+s;this.body=t.slice(u,u+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ps{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=N.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const l=this.json,i=this.dracoLoader,e=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},r={},u={};for(const c in s){const f=$e[c]||c.toLowerCase();o[f]=s[c]}for(const c in t.attributes){const f=$e[c]||c.toLowerCase();if(s[c]!==void 0){const h=l.accessors[t.attributes[c]],a=me[h.componentType];u[f]=a.name,r[f]=h.normalized===!0}}return n.getDependency("bufferView",e).then(function(c){return new Promise(function(f,h){i.decodeDracoFile(c,function(a){for(const m in a.attributes){const d=a.attributes[m],p=r[m];p!==void 0&&(d.normalized=p)}f(a)},o,u,re,h)})})}}class gs{constructor(){this.name=N.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return(n.texCoord===void 0||n.texCoord===t.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.texCoord!==void 0&&(t.channel=n.texCoord),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class xs{constructor(){this.name=N.KHR_MESH_QUANTIZATION}}class Yt extends Bn{constructor(t,n,l,i){super(t,n,l,i)}copySampleValue_(t){const n=this.resultBuffer,l=this.sampleValues,i=this.valueSize,e=t*i*3+i;for(let s=0;s!==i;s++)n[s]=l[e+s];return n}interpolate_(t,n,l,i){const e=this.resultBuffer,s=this.sampleValues,o=this.valueSize,r=o*2,u=o*3,c=i-n,f=(l-n)/c,h=f*f,a=h*f,m=t*u,d=m-u,p=-2*a+3*h,x=a-h,w=1-p,T=x-h+f;for(let M=0;M!==o;M++){const g=s[d+M+o],y=s[d+M+r]*c,S=s[m+M+o],v=s[m+M]*c;e[M]=w*g+T*y+p*S+x*v}return e}}const ys=new le;class vs extends Yt{interpolate_(t,n,l,i){const e=super.interpolate_(t,n,l,i);return ys.fromArray(e).normalize().toArray(e),e}}const q={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},me={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},At={9728:Mn,9729:Ot,9984:Cn,9985:bn,9986:En,9987:Ft},St={33071:Pn,33648:Rn,10497:Ze},Ge={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$e={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},oe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ws={CUBICSPLINE:void 0,LINEAR:Wt,STEP:Ln},We={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function As(A){return A.DefaultMaterial===void 0&&(A.DefaultMaterial=new et({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Vn})),A.DefaultMaterial}function ae(A,t,n){for(const l in n.extensions)A[l]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[l]=n.extensions[l])}function se(A,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(A.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Ss(A,t,n){let l=!1,i=!1,e=!1;for(let u=0,c=t.length;u<c;u++){const f=t[u];if(f.POSITION!==void 0&&(l=!0),f.NORMAL!==void 0&&(i=!0),f.COLOR_0!==void 0&&(e=!0),l&&i&&e)break}if(!l&&!i&&!e)return Promise.resolve(A);const s=[],o=[],r=[];for(let u=0,c=t.length;u<c;u++){const f=t[u];if(l){const h=f.POSITION!==void 0?n.getDependency("accessor",f.POSITION):A.attributes.position;s.push(h)}if(i){const h=f.NORMAL!==void 0?n.getDependency("accessor",f.NORMAL):A.attributes.normal;o.push(h)}if(e){const h=f.COLOR_0!==void 0?n.getDependency("accessor",f.COLOR_0):A.attributes.color;r.push(h)}}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(r)]).then(function(u){const c=u[0],f=u[1],h=u[2];return l&&(A.morphAttributes.position=c),i&&(A.morphAttributes.normal=f),e&&(A.morphAttributes.color=h),A.morphTargetsRelative=!0,A})}function Ts(A,t){if(A.updateMorphTargets(),t.weights!==void 0)for(let n=0,l=t.weights.length;n<l;n++)A.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(A.morphTargetInfluences.length===n.length){A.morphTargetDictionary={};for(let l=0,i=n.length;l<i;l++)A.morphTargetDictionary[n[l]]=l}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ms(A){let t;const n=A.extensions&&A.extensions[N.KHR_DRACO_MESH_COMPRESSION];if(n?t="draco:"+n.bufferView+":"+n.indices+":"+Ke(n.attributes):t=A.indices+":"+Ke(A.attributes)+":"+A.mode,A.targets!==void 0)for(let l=0,i=A.targets.length;l<i;l++)t+=":"+Ke(A.targets[l]);return t}function Ke(A){let t="";const n=Object.keys(A).sort();for(let l=0,i=n.length;l<i;l++)t+=n[l]+":"+A[n[l]]+";";return t}function qe(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Cs(A){return A.search(/\.jpe?g($|\?)/i)>0||A.search(/^data\:image\/jpeg/)===0?"image/jpeg":A.search(/\.webp($|\?)/i)>0||A.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const bs=new Q;class Es{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new Yn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let l=!1,i=-1,e=!1,s=-1;if(typeof navigator<"u"){const o=navigator.userAgent;l=/^((?!chrome|android).)*safari/i.test(o)===!0;const r=o.match(/Version\/(\d+)/);i=l&&r?parseInt(r[1],10):-1,e=o.indexOf("Firefox")>-1,s=e?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||l&&i<17||e&&s<98?this.textureLoader=new mn(this.options.manager):this.textureLoader=new dn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Bt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const l=this,i=this.json,e=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([l.getDependencies("scene"),l.getDependencies("animation"),l.getDependencies("camera")])}).then(function(s){const o={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:l,userData:{}};return ae(e,o,i),se(o,i),Promise.all(l._invokeAll(function(r){return r.afterRoot&&r.afterRoot(o)})).then(function(){for(const r of o.scenes)r.updateMatrixWorld();t(o)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],l=this.json.meshes||[];for(let i=0,e=n.length;i<e;i++){const s=n[i].joints;for(let o=0,r=s.length;o<r;o++)t[s[o]].isBone=!0}for(let i=0,e=t.length;i<e;i++){const s=t[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(l[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,l){if(t.refs[n]<=1)return l;const i=l.clone(),e=(s,o)=>{const r=this.associations.get(s);r!=null&&this.associations.set(o,r);for(const[u,c]of s.children.entries())e(c,o.children[u])};return e(l,i),i.name+="_instance_"+t.uses[n]++,i}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let l=0;l<n.length;l++){const i=t(n[l]);if(i)return i}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const l=[];for(let i=0;i<n.length;i++){const e=t(n[i]);e&&l.push(e)}return l}getDependency(t,n){const l=t+":"+n;let i=this.cache.get(l);if(!i){switch(t){case"scene":i=this.loadScene(n);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(n)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(n)});break;case"accessor":i=this.loadAccessor(n);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(n)});break;case"buffer":i=this.loadBuffer(n);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(n)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(n)});break;case"skin":i=this.loadSkin(n);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(n)});break;case"camera":i=this.loadCamera(n);break;default:if(i=this._invokeOne(function(e){return e!=this&&e.getDependency&&e.getDependency(t,n)}),!i)throw new Error("Unknown type: "+t);break}this.cache.add(l,i)}return i}getDependencies(t){let n=this.cache.get(t);if(!n){const l=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(i.map(function(e,s){return l.getDependency(t,s)})),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],l=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[N.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,s){l.load(pe.resolveURL(n.uri,i.path),e,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(function(l){const i=n.byteLength||0,e=n.byteOffset||0;return l.slice(e,e+i)})}loadAccessor(t){const n=this,l=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0){const s=Ge[i.type],o=me[i.componentType],r=i.normalized===!0,u=new o(i.count*s);return Promise.resolve(new ge(u,s,r))}const e=[];return i.bufferView!==void 0?e.push(this.getDependency("bufferView",i.bufferView)):e.push(null),i.sparse!==void 0&&(e.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(e).then(function(s){const o=s[0],r=Ge[i.type],u=me[i.componentType],c=u.BYTES_PER_ELEMENT,f=c*r,h=i.byteOffset||0,a=i.bufferView!==void 0?l.bufferViews[i.bufferView].byteStride:void 0,m=i.normalized===!0;let d,p;if(a&&a!==f){const x=Math.floor(h/a),w="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+x+":"+i.count;let T=n.cache.get(w);T||(d=new u(o,x*a,i.count*a/c),T=new pn(d,a/c),n.cache.add(w,T)),p=new In(T,r,h%a/c,m)}else o===null?d=new u(i.count*r):d=new u(o,h,i.count*r),p=new ge(d,r,m);if(i.sparse!==void 0){const x=Ge.SCALAR,w=me[i.sparse.indices.componentType],T=i.sparse.indices.byteOffset||0,M=i.sparse.values.byteOffset||0,g=new w(s[1],T,i.sparse.count*x),y=new u(s[2],M,i.sparse.count*r);o!==null&&(p=new ge(p.array.slice(),p.itemSize,p.normalized));for(let S=0,v=g.length;S<v;S++){const b=g[S];if(p.setX(b,y[S*r]),r>=2&&p.setY(b,y[S*r+1]),r>=3&&p.setZ(b,y[S*r+2]),r>=4&&p.setW(b,y[S*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(t){const n=this.json,l=this.options,e=n.textures[t].source,s=n.images[e];let o=this.textureLoader;if(s.uri){const r=l.manager.getHandler(s.uri);r!==null&&(o=r)}return this.loadTextureImage(t,e,o)}loadTextureImage(t,n,l){const i=this,e=this.json,s=e.textures[t],o=e.images[n],r=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[r])return this.textureCache[r];const u=this.loadImageSource(n,l).then(function(c){c.flipY=!1,c.name=s.name||o.name||"",c.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(c.name=o.uri);const h=(e.samplers||{})[s.sampler]||{};return c.magFilter=At[h.magFilter]||Ot,c.minFilter=At[h.minFilter]||Ft,c.wrapS=St[h.wrapS]||Ze,c.wrapT=St[h.wrapT]||Ze,i.associations.set(c,{textures:t}),c}).catch(function(){return null});return this.textureCache[r]=u,u}loadImageSource(t,n){const l=this,i=this.json,e=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(f=>f.clone());const s=i.images[t],o=self.URL||self.webkitURL;let r=s.uri||"",u=!1;if(s.bufferView!==void 0)r=l.getDependency("bufferView",s.bufferView).then(function(f){u=!0;const h=new Blob([f],{type:s.mimeType});return r=o.createObjectURL(h),r});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(r).then(function(f){return new Promise(function(h,a){let m=h;n.isImageBitmapLoader===!0&&(m=function(d){const p=new mt(d);p.needsUpdate=!0,h(p)}),n.load(pe.resolveURL(f,e.path),m,void 0,a)})}).then(function(f){return u===!0&&o.revokeObjectURL(r),se(f,s),f.userData.mimeType=s.mimeType||Cs(s.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),f});return this.sourceCache[t]=c,c}assignTexture(t,n,l,i){const e=this;return this.getDependency("texture",l.index).then(function(s){if(!s)return null;if(l.texCoord!==void 0&&l.texCoord>0&&(s=s.clone(),s.channel=l.texCoord),e.extensions[N.KHR_TEXTURE_TRANSFORM]){const o=l.extensions!==void 0?l.extensions[N.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const r=e.associations.get(s);s=e.extensions[N.KHR_TEXTURE_TRANSFORM].extendTexture(s,o),e.associations.set(s,r)}}return i!==void 0&&(s.colorSpace=i),t[n]=s,s})}assignFinalMaterial(t){const n=t.geometry;let l=t.material;const i=n.attributes.tangent===void 0,e=n.attributes.color!==void 0,s=n.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+l.uuid;let r=this.cache.get(o);r||(r=new Nt,Ue.prototype.copy.call(r,l),r.color.copy(l.color),r.map=l.map,r.sizeAttenuation=!1,this.cache.add(o,r)),l=r}else if(t.isLine){const o="LineBasicMaterial:"+l.uuid;let r=this.cache.get(o);r||(r=new Je,Ue.prototype.copy.call(r,l),r.color.copy(l.color),r.map=l.map,this.cache.add(o,r)),l=r}if(i||e||s){let o="ClonedMaterial:"+l.uuid+":";i&&(o+="derivative-tangents:"),e&&(o+="vertex-colors:"),s&&(o+="flat-shading:");let r=this.cache.get(o);r||(r=l.clone(),e&&(r.vertexColors=!0),s&&(r.flatShading=!0),i&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(o,r),this.associations.set(r,this.associations.get(l))),l=r}t.material=l}getMaterialType(){return et}loadMaterial(t){const n=this,l=this.json,i=this.extensions,e=l.materials[t];let s;const o={},r=e.extensions||{},u=[];if(r[N.KHR_MATERIALS_UNLIT]){const f=i[N.KHR_MATERIALS_UNLIT];s=f.getMaterialType(),u.push(f.extendParams(o,e,n))}else{const f=e.pbrMetallicRoughness||{};if(o.color=new ce(1,1,1),o.opacity=1,Array.isArray(f.baseColorFactor)){const h=f.baseColorFactor;o.color.setRGB(h[0],h[1],h[2],re),o.opacity=h[3]}f.baseColorTexture!==void 0&&u.push(n.assignTexture(o,"map",f.baseColorTexture,ye)),o.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,o.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(u.push(n.assignTexture(o,"metalnessMap",f.metallicRoughnessTexture)),u.push(n.assignTexture(o,"roughnessMap",f.metallicRoughnessTexture))),s=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(t)}),u.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(t,o)})))}e.doubleSided===!0&&(o.side=Ht);const c=e.alphaMode||We.OPAQUE;if(c===We.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===We.MASK&&(o.alphaTest=e.alphaCutoff!==void 0?e.alphaCutoff:.5)),e.normalTexture!==void 0&&s!==he&&(u.push(n.assignTexture(o,"normalMap",e.normalTexture)),o.normalScale=new we(1,1),e.normalTexture.scale!==void 0)){const f=e.normalTexture.scale;o.normalScale.set(f,f)}if(e.occlusionTexture!==void 0&&s!==he&&(u.push(n.assignTexture(o,"aoMap",e.occlusionTexture)),e.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=e.occlusionTexture.strength)),e.emissiveFactor!==void 0&&s!==he){const f=e.emissiveFactor;o.emissive=new ce().setRGB(f[0],f[1],f[2],re)}return e.emissiveTexture!==void 0&&s!==he&&u.push(n.assignTexture(o,"emissiveMap",e.emissiveTexture,ye)),Promise.all(u).then(function(){const f=new s(o);return e.name&&(f.name=e.name),se(f,e),n.associations.set(f,{materials:t}),e.extensions&&ae(i,f,e),f})}createUniqueName(t){const n=gn.sanitizeNodeName(t||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(t){const n=this,l=this.extensions,i=this.primitiveCache;function e(o){return l[N.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,n).then(function(r){return Tt(r,o,n)})}const s=[];for(let o=0,r=t.length;o<r;o++){const u=t[o],c=Ms(u),f=i[c];if(f)s.push(f.promise);else{let h;u.extensions&&u.extensions[N.KHR_DRACO_MESH_COMPRESSION]?h=e(u):h=Tt(new De,u,n),i[c]={primitive:u,promise:h},s.push(h)}}return Promise.all(s)}loadMesh(t){const n=this,l=this.json,i=this.extensions,e=l.meshes[t],s=e.primitives,o=[];for(let r=0,u=s.length;r<u;r++){const c=s[r].material===void 0?As(this.cache):this.getDependency("material",s[r].material);o.push(c)}return o.push(n.loadGeometries(s)),Promise.all(o).then(function(r){const u=r.slice(0,r.length-1),c=r[r.length-1],f=[];for(let a=0,m=c.length;a<m;a++){const d=c[a],p=s[a];let x;const w=u[a];if(p.mode===q.TRIANGLES||p.mode===q.TRIANGLE_STRIP||p.mode===q.TRIANGLE_FAN||p.mode===void 0)x=e.isSkinnedMesh===!0?new xn(d,w):new Ie(d,w),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),p.mode===q.TRIANGLE_STRIP?x.geometry=vt(x.geometry,Dt):p.mode===q.TRIANGLE_FAN&&(x.geometry=vt(x.geometry,Ye));else if(p.mode===q.LINES)x=new _t(d,w);else if(p.mode===q.LINE_STRIP)x=new Ut(d,w);else if(p.mode===q.LINE_LOOP)x=new yn(d,w);else if(p.mode===q.POINTS)x=new zt(d,w);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(x.geometry.morphAttributes).length>0&&Ts(x,e),x.name=n.createUniqueName(e.name||"mesh_"+t),se(x,e),p.extensions&&ae(i,x,p),n.assignFinalMaterial(x),f.push(x)}for(let a=0,m=f.length;a<m;a++)n.associations.set(f[a],{meshes:t,primitives:a});if(f.length===1)return e.extensions&&ae(i,f[0],e),f[0];const h=new ze;e.extensions&&ae(i,h,e),n.associations.set(h,{meshes:t});for(let a=0,m=f.length;a<m;a++)h.add(f[a]);return h})}loadCamera(t){let n;const l=this.json.cameras[t],i=l[l.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return l.type==="perspective"?n=new vn(Gt.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):l.type==="orthographic"&&(n=new wn(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),l.name&&(n.name=this.createUniqueName(l.name)),se(n,l),Promise.resolve(n)}loadSkin(t){const n=this.json.skins[t],l=[];for(let i=0,e=n.joints.length;i<e;i++)l.push(this._loadNodeShallow(n.joints[i]));return n.inverseBindMatrices!==void 0?l.push(this.getDependency("accessor",n.inverseBindMatrices)):l.push(null),Promise.all(l).then(function(i){const e=i.pop(),s=i,o=[],r=[];for(let u=0,c=s.length;u<c;u++){const f=s[u];if(f){o.push(f);const h=new Q;e!==null&&h.fromArray(e.array,u*16),r.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[u])}return new An(o,r)})}loadAnimation(t){const n=this.json,l=this,i=n.animations[t],e=i.name?i.name:"animation_"+t,s=[],o=[],r=[],u=[],c=[];for(let f=0,h=i.channels.length;f<h;f++){const a=i.channels[f],m=i.samplers[a.sampler],d=a.target,p=d.node,x=i.parameters!==void 0?i.parameters[m.input]:m.input,w=i.parameters!==void 0?i.parameters[m.output]:m.output;d.node!==void 0&&(s.push(this.getDependency("node",p)),o.push(this.getDependency("accessor",x)),r.push(this.getDependency("accessor",w)),u.push(m),c.push(d))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(r),Promise.all(u),Promise.all(c)]).then(function(f){const h=f[0],a=f[1],m=f[2],d=f[3],p=f[4],x=[];for(let w=0,T=h.length;w<T;w++){const M=h[w],g=a[w],y=m[w],S=d[w],v=p[w];if(M===void 0)continue;M.updateMatrix&&M.updateMatrix();const b=l._createAnimationTracks(M,g,y,S,v);if(b)for(let C=0;C<b.length;C++)x.push(b[C])}return new Sn(e,void 0,x)})}createNodeMesh(t){const n=this.json,l=this,i=n.nodes[t];return i.mesh===void 0?null:l.getDependency("mesh",i.mesh).then(function(e){const s=l._getNodeRef(l.meshCache,i.mesh,e);return i.weights!==void 0&&s.traverse(function(o){if(o.isMesh)for(let r=0,u=i.weights.length;r<u;r++)o.morphTargetInfluences[r]=i.weights[r]}),s})}loadNode(t){const n=this.json,l=this,i=n.nodes[t],e=l._loadNodeShallow(t),s=[],o=i.children||[];for(let u=0,c=o.length;u<c;u++)s.push(l.getDependency("node",o[u]));const r=i.skin===void 0?Promise.resolve(null):l.getDependency("skin",i.skin);return Promise.all([e,Promise.all(s),r]).then(function(u){const c=u[0],f=u[1],h=u[2];h!==null&&c.traverse(function(a){a.isSkinnedMesh&&a.bind(h,bs)});for(let a=0,m=f.length;a<m;a++)c.add(f[a]);return c})}_loadNodeShallow(t){const n=this.json,l=this.extensions,i=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const e=n.nodes[t],s=e.name?i.createUniqueName(e.name):"",o=[],r=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(t)});return r&&o.push(r),e.camera!==void 0&&o.push(i.getDependency("camera",e.camera).then(function(u){return i._getNodeRef(i.cameraCache,e.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(t)}).forEach(function(u){o.push(u)}),this.nodeCache[t]=Promise.all(o).then(function(u){let c;if(e.isBone===!0?c=new Tn:u.length>1?c=new ze:u.length===1?c=u[0]:c=new kt,c!==u[0])for(let f=0,h=u.length;f<h;f++)c.add(u[f]);if(e.name&&(c.userData.name=e.name,c.name=s),se(c,e),e.extensions&&ae(l,c,e),e.matrix!==void 0){const f=new Q;f.fromArray(e.matrix),c.applyMatrix4(f)}else e.translation!==void 0&&c.position.fromArray(e.translation),e.rotation!==void 0&&c.quaternion.fromArray(e.rotation),e.scale!==void 0&&c.scale.fromArray(e.scale);return i.associations.has(c)||i.associations.set(c,{}),i.associations.get(c).nodes=t,c}),this.nodeCache[t]}loadScene(t){const n=this.extensions,l=this.json.scenes[t],i=this,e=new ze;l.name&&(e.name=i.createUniqueName(l.name)),se(e,l),l.extensions&&ae(n,e,l);const s=l.nodes||[],o=[];for(let r=0,u=s.length;r<u;r++)o.push(i.getDependency("node",s[r]));return Promise.all(o).then(function(r){for(let c=0,f=r.length;c<f;c++)e.add(r[c]);const u=c=>{const f=new Map;for(const[h,a]of i.associations)(h instanceof Ue||h instanceof mt)&&f.set(h,a);return c.traverse(h=>{const a=i.associations.get(h);a!=null&&f.set(h,a)}),f};return i.associations=u(e),e})}_createAnimationTracks(t,n,l,i,e){const s=[],o=t.name?t.name:t.uuid,r=[];oe[e.path]===oe.weights?t.traverse(function(h){h.morphTargetInfluences&&r.push(h.name?h.name:h.uuid)}):r.push(o);let u;switch(oe[e.path]){case oe.weights:u=pt;break;case oe.rotation:u=gt;break;case oe.position:case oe.scale:u=dt;break;default:switch(l.itemSize){case 1:u=pt;break;case 2:case 3:default:u=dt;break}break}const c=i.interpolation!==void 0?ws[i.interpolation]:Wt,f=this._getArrayFromAccessor(l);for(let h=0,a=r.length;h<a;h++){const m=new u(r[h]+"."+oe[e.path],n.array,f,c);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),s.push(m)}return s}_getArrayFromAccessor(t){let n=t.array;if(t.normalized){const l=qe(n.constructor),i=new Float32Array(n.length);for(let e=0,s=n.length;e<s;e++)i[e]=n[e]*l;n=i}return n}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(l){const i=this instanceof gt?vs:Yt;return new i(this.times,this.values,this.getValueSize()/3,l)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ps(A,t,n){const l=t.attributes,i=new tt;if(l.POSITION!==void 0){const o=n.json.accessors[l.POSITION],r=o.min,u=o.max;if(r!==void 0&&u!==void 0){if(i.set(new B(r[0],r[1],r[2]),new B(u[0],u[1],u[2])),o.normalized){const c=qe(me[o.componentType]);i.min.multiplyScalar(c),i.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const e=t.targets;if(e!==void 0){const o=new B,r=new B;for(let u=0,c=e.length;u<c;u++){const f=e[u];if(f.POSITION!==void 0){const h=n.json.accessors[f.POSITION],a=h.min,m=h.max;if(a!==void 0&&m!==void 0){if(r.setX(Math.max(Math.abs(a[0]),Math.abs(m[0]))),r.setY(Math.max(Math.abs(a[1]),Math.abs(m[1]))),r.setZ(Math.max(Math.abs(a[2]),Math.abs(m[2]))),h.normalized){const d=qe(me[h.componentType]);r.multiplyScalar(d)}o.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(o)}A.boundingBox=i;const s=new Dn;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,A.boundingSphere=s}function Tt(A,t,n){const l=t.attributes,i=[];function e(s,o){return n.getDependency("accessor",s).then(function(r){A.setAttribute(o,r)})}for(const s in l){const o=$e[s]||s.toLowerCase();o in A.attributes||i.push(e(l[s],o))}if(t.indices!==void 0&&!A.index){const s=n.getDependency("accessor",t.indices).then(function(o){A.setIndex(o)});i.push(s)}return ht.workingColorSpace!==re&&"COLOR_0"in l&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ht.workingColorSpace}" not supported.`),se(A,t),Ps(A,t,n),Promise.all(i).then(function(){return t.targets!==void 0?Ss(A,t.targets,n):A})}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Rs extends Ie{constructor(t,n){super(t,n),this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new B,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}const Ee=new Map,Ls=5,ie=(A,t=!1)=>{if(!Ee.has(A))Ee.set(A,1);else{const n=Ee.get(A);if(typeof n>"u"||n>=Ls)return;Ee.set(A,n+1)}t?console.error(`%c [enable3d] ${A} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${A} `,"background: #222; color: #bada55")};class Zt{constructor(){this._defaultMaterial=new Kt({color:13421772})}get(){return this._defaultMaterial}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Vs{constructor(t){this.scene=t,this.isHeadless=t==="headless",this.defaultMaterial=new Zt}get make(){return{plane:(t={},n={})=>this.makePlane(t,n),box:(t={},n={})=>this.makeBox(t,n),sphere:(t={},n={})=>this.makeSphere(t,n),capsule:(t={},n={})=>this.makeCapsule(t,n),cylinder:(t={},n={})=>this.makeCylinder(t,n),cone:(t={},n={})=>this.makeCone(t,n),torus:(t={},n={})=>this.makeTorus(t,n),extrude:(t,n={})=>this.makeExtrude(t,n)}}get add(){return{mesh:t=>this.addMesh(t),existing:t=>this.addExisting(t),plane:(t={},n={})=>this.addPlane(t,n),box:(t={},n={})=>this.addBox(t,n),ground:(t,n={})=>this.addGround(t,n),sphere:(t={},n={})=>this.addSphere(t,n),capsule:(t={},n={})=>this.addCapsule(t,n),cylinder:(t={},n={})=>this.addCylinder(t,n),cone:(t={},n={})=>this.addCone(t,n),torus:(t={},n={})=>this.addTorus(t,n),extrude:(t,n={})=>this.addExtrude(t,n),material:(t={})=>this.addMaterial(t)}}addExisting(...t){this.scene!=="headless"&&this.scene.add(...t)}addMesh(t){if(Array.isArray(t))for(let n=0;n<t.length;n++)this.addExisting(t[n]);else this.addExisting(t);return this}createMesh(t,n,l){const{x:i=0,y:e=0,z:s=0}=l;let o;switch(!Array.isArray(n)&&n.type){case"LineBasicMaterial":o=new Ut(t,n);break;case"PointsMaterial":o=new zt(t,n);break;default:o=new Rs(t,n);break}return o.position.set(i,e,s),o.castShadow=o.receiveShadow=!0,o}makeExtrude(t,n){const{x:l,y:i,z:e,name:s,shape:o,autoCenter:r=!0,breakable:u=!1,...c}=t,{depth:f=1,bevelEnabled:h=!1}=c,a=new kn(o,{depth:f,bevelEnabled:h,...c}),m=this.addMaterial(n),d=this.createMesh(a,m,{x:l,y:i,z:e});return r&&d.geometry.center(),d.name=s||`body_id_${d.id}`,d.shape="extrude",d}addExtrude(t,n={}){const l=this.makeExtrude(t,n);return this.addExisting(l),l}makePlane(t,n){const{x:l,y:i,z:e,name:s,breakable:o=!1,...r}=t,u=new On(r.width||1,r.height||1,r.widthSegments||1,r.heightSegments||1),c=this.addMaterial(n);c.side=Ht;const f=this.createMesh(u,c,{x:l,y:i,z:e});return f.name=s||`body_id_${f.id}`,f.shape="plane",f}addPlane(t,n){const l=this.makePlane(t,n);return this.addExisting(l),l}makeSphere(t,n){const{x:l,y:i,z:e,name:s,breakable:o=!1,...r}=t,u=new Fn(r.radius||1,r.widthSegments||16,r.heightSegments||12,r.phiStart||void 0,r.phiLength||void 0,r.thetaStart||void 0,r.thetaLength||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:l,y:i,z:e});return f.name=s||`body_id_${f.id}`,f.shape="sphere",f}addSphere(t={},n={}){const l=this.makeSphere(t,n);return this.addExisting(l),l}makeBox(t,n){const{x:l,y:i,z:e,name:s,breakable:o=!1,...r}=t,u=new Nn(r.width||1,r.height||1,r.depth||1,r.widthSegments||void 0,r.heightSegments||void 0,r.depthSegments||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:l,y:i,z:e});return f.name=s||`body_id_${f.id}`,f.shape="box",f}addBox(t={},n={}){const l=this.makeBox(t,n);return this.addExisting(l),l}addGround(t,n={}){const l=this.makeBox(t,n);return l.rotateX(Gt.degToRad(90)),this.addExisting(l),l}makeCapsule(t={},n={}){const{x:l,y:i,z:e,name:s,breakable:o=!1,...r}=t,u=new Hn(r.radius||.5,r.length||1,r.capSegments||4,r.radialSegments||16),c=this.addMaterial(n),f=this.createMesh(u,c,{x:l,y:i,z:e});return f.name=s||`body_id_${f.id}`,f.shape="capsule",f}addCapsule(t={},n={}){const l=this.makeCapsule(t,n);return this.addExisting(l),l}makeCylinder(t={},n={}){const{x:l,y:i,z:e,name:s,breakable:o=!1,...r}=t,u=new _n(r.radiusTop||1,r.radiusBottom||1,r.height||1,r.radiusSegments||void 0,r.heightSegments||void 0,r.openEnded||void 0,r.thetaStart||void 0,r.thetaLength||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:l,y:i,z:e});return f.name=s||`body_id_${f.id}`,f.shape="cylinder",f}addCylinder(t={},n={}){const l=this.makeCylinder(t,n);return this.addExisting(l),l}makeCone(t={},n={}){const{x:l,y:i,z:e,name:s,breakable:o=!1,...r}=t,u=new Un(r.radius||1,r.height||1,r.radiusSegments||8,r.heightSegments||1,r.openEnded||!1,r.thetaStart||0,r.thetaLength||2*Math.PI),c=this.addMaterial(n),f=this.createMesh(u,c,{x:l,y:i,z:e});return f.name=s||`body_id_${f.id}`,f.shape="cone",f}addCone(t={},n={}){const l=this.makeCone(t,n);return this.addExisting(l),l}makeTorus(t={},n={}){const{x:l,y:i,z:e,name:s,breakable:o=!1,...r}=t,u=new zn(r.radius||void 0,r.tube||void 0,r.radialSegments||void 0,r.tubularSegments||void 0,r.arc||void 0),c=this.addMaterial(n),f=this.createMesh(u,c,{x:l,y:i,z:e});return f.name=s||`body_id_${f.id}`,f.shape="torus",f}addTorus(t={},n={}){const l=this.makeTorus(t,n);return this.addExisting(l),l}addMaterial(t={}){const n=Object.keys(t)[0];let l;if(this.scene==="headless")return this.defaultMaterial.get();switch(n){case"basic":l=new he(t.basic);break;case"normal":l=new Kn(t.normal);break;case"standard":l=new et(t.standard);break;case"lambert":l=new Kt(t.lambert);break;case"phong":l=new Wn(t.phong);break;case"physical":typeof t.physical<"u"?l=new ee(t.physical):(ie("You need to pass parameters to the physical material. (Fallback to default material)"),l=this.defaultMaterial.get());break;case"toon":l=new Gn(t.toon);break;case"line":l=new Je(t.line);break;case"points":l=new Nt(t.points);break;case"custom":l=t.custom||this.defaultMaterial.get();break;default:l=this.defaultMaterial.get();break}return l}}var xe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},st={},Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.VERSION=void 0;Be.VERSION="0.0.5";/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */var Mt=xe&&xe.__spreadArray||function(A,t){for(var n=0,l=t.length,i=A.length;n<l;n++,i++)A[i]=t[n];return A};Object.defineProperty(st,"__esModule",{value:!0});var ve=st.Events=void 0,Is=Be,Ds=function(){function A(t,n,l){l===void 0&&(l=!1),this.fn=t,this.context=n,this.once=l}return A}(),Ct=function(A,t,n,l,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var e=new Ds(n,l||A,i);return A._events.has(t)?A._events.get(t).fn?A._events.set(t,[A._events.get(t),e]):A._events.get(t).push(e):(A._events.set(t,e),A._eventsCount++),A},Pe=function(A,t){--A._eventsCount===0?A._events=new Map:A._events.delete(t)},Bs=function(){function A(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(A,"VERSION",{get:function(){return Is.VERSION},enumerable:!1,configurable:!0}),A.prototype.eventNames=function(){return Array.from(this._events.keys())},A.prototype.listeners=function(t){var n=this._events.get(t);if(!n)return[];if(n.fn)return[n.fn];for(var l=0,i=n.length,e=new Array(i);l<i;l++)e[l]=n[l].fn;return e},A.prototype.listenerCount=function(t){var n=this._events.get(t);return n?n.fn?1:n.length:0},A.prototype.emit=function(t){for(var n,l,i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];if(!this._events.has(t))return!1;var s=this._events.get(t),o;if(s.fn)return s.once&&this.removeListener(t,s.fn,void 0,!0),(n=s.fn).call.apply(n,Mt([s.context],i)),!0;var r=s.length;for(o=0;o<r;o++)s[o].once&&this.removeListener(t,s[o].fn,void 0,!0),(l=s[o].fn).call.apply(l,Mt([s[o].context],i));return!0},A.prototype.on=function(t,n,l){return Ct(this,t,n,l,!1)},A.prototype.once=function(t,n,l){return Ct(this,t,n,l,!0)},A.prototype.removeListener=function(t,n,l,i){if(!this._events.has(t))return this;if(!n)return Pe(this,t),this;var e=this._events.get(t);if(e.fn)e.fn===n&&(!i||e.once)&&(!l||e.context===l)&&Pe(this,t);else{for(var s=0,o=[],r=e.length;s<r;s++)(e[s].fn!==n||i&&!e[s].once||l&&e[s].context!==l)&&o.push(e[s]);o.length?this._events.set(t,o.length===1?o[0]:o):Pe(this,t)}return this},A.prototype.removeAllListeners=function(t){return t?this._events.delete(t)&&Pe(this,t):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(A.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),A}();ve=st.Events=Bs;/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class ks{constructor(t,n){this.physics=t,this.ammo=n,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.impact=[],this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new nt,this.tmpQuaternion=new le,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new ve,this.name=n.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){typeof this.eventEmitter>"u"&&(this.eventEmitter=new ve)}get needUpdate(){return this._needUpdate}set needUpdate(t){!t&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=t}onUpdateEvent(t,n=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,n?this.eventEmitter.once("update",()=>{t()}):this.eventEmitter.on("update",()=>{t()})}get on(){return{update:t=>this.onUpdateEvent(t),collision:t=>this.onCollision(t)}}get once(){return{update:t=>this.onUpdateEvent(t,!0)}}onCollision(t){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",n=>{const{bodies:l,event:i}=n;l[0].name===this.name?t(l[1],i):l[1].name===this.name&&t(l[0],i)})}transform(){const t=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(t)}refresh(){const t=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(t)}setRotation(t,n,l){const i=this.tmpEuler.set(t,n,l),e=this.tmpQuaternion.set(0,0,0,1);e.setFromEuler(i),this.tmpBtQuaternion.setValue(0,0,0,1);const s=this.tmpBtQuaternion;s.setValue(e.x,e.y,e.z,e.w),this.physics.worldTransform.setRotation(s)}get rotation(){let t,n,l;const e=this.physics.worldTransform.getRotation();let s=this.tmpQuaternion.set(e.x(),e.y(),e.z(),e.w());s.w>1&&(s=s.normalize());const o=2*Math.acos(s.w),r=Math.sqrt(1-s.w*s.w);return r<.001?(t=s.x,n=s.y,l=s.z):(t=s.x/r,n=s.y/r,l=s.z/r),{x:t*o,y:n*o,z:l*o}}get quaternion(){const n=this.physics.worldTransform.getRotation();return{x:n.x(),y:n.y(),z:n.z(),w:n.w()}}setPosition(t,n,l){this.physics.worldTransform.getOrigin().setValue(t,n,l)}get position(){const t=this.physics.worldTransform;return{x:t.getOrigin().x(),y:t.getOrigin().y(),z:t.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(t){this.tmpBtVector3.setValue(t,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(t){this.tmpBtVector3.setValue(this.velocity.x,t,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(t){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,t),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(t){this.tmpBtVector3.setValue(t,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(t){this.tmpBtVector3.setValue(this.angularVelocity.x,t,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(t){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,t),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(t){this.tmpBtVector3.setValue(t,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(t){this.tmpBtVector3.setValue(0,t,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(t){this.tmpBtVector3.setValue(0,0,t),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(t,n){this.tmpBtVector3.setValue(t.x||0,t.y||0,t.z||0),this.tmpBtVector3_1.setValue(n.x||0,n.y||0,n.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(t){this.ammo.setCollisionFlags(t)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(t){this.ammo.setRestitution(t)}setBounciness(t){this.setRestitution(t)}setFriction(t){this.ammo.setFriction(t)}setDamping(t,n){this.ammo.setDamping(t,n)}setGravity(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(t,n,l){this.tmpBtVector3.setValue(t,n,l),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(t){this.ammo.setCcdMotionThreshold(t)}setCcdSweptSphereRadius(t){this.ammo.setCcdSweptSphereRadius(t)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Os{constructor(t,n){this.factory=t,this.addExisting=n}addPlane(t={},n={}){const l=this.factory.add.plane(t,n);return this.addExisting(l,t),l}addSphere(t={},n={}){const l=this.factory.add.sphere(t,n);return this.addExisting(l,t),l}addBox(t={},n={}){const l=this.factory.add.box(t,n);return this.addExisting(l,t),l}addGround(t,n={}){const l=this.factory.add.ground(t,n),i={...t,mass:0,collisionFlags:1};return this.addExisting(l,i),l}addCapsule(t={},n={}){const l=this.factory.add.capsule(t,n);return this.addExisting(l,t),l}addCylinder(t={},n={}){const l=this.factory.add.cylinder(t,n);return this.addExisting(l,t),l}addCone(t={},n={}){const l=this.factory.add.cone(t,n);return this.addExisting(l,t),l}addTorus(t={},n={}){const l=this.factory.add.torus(t,n);return this.addExisting(l,t),l}addExtrude(t,n={}){const l=this.factory.add.extrude(t,n);return l.translateX(1),this.addExisting(l),l}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Fs{constructor(t,n){this.worldTransform=t,this.physicsWorld=n,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(t,n=0){return new Ammo.btVector3(typeof(t==null?void 0:t.x)<"u"?t.x:n,typeof(t==null?void 0:t.y)<"u"?t.y:n,typeof(t==null?void 0:t.z)<"u"?t.z:n)}get addConstraints(){return{lock:(t,n,l)=>this.lock(t,n,l),fixed:(t,n,l)=>this.fixed(t,n,l),pointToPoint:(t,n,l,i)=>this.pointToPoint(t,n,l,i),hinge:(t,n,l,i)=>this.hinge(t,n,l,i),slider:(t,n,l={},i)=>this.slider(t,n,l,i),spring:(t,n,l={},i)=>this.spring(t,n,l,i),coneTwist:(t,n,l={frameA:{},frameB:{}},i)=>this.coneTwist(t,n,l,i),dof:(t,n,l,i)=>this.dof(t,n,l,i)}}getTransform(t,n,l={x:0,y:0,z:0},i=!1){l={x:0,y:0,z:0,...l};const e=(o,r)=>{var u=(o.x()-r.x())/2+l.x,c=(o.y()-r.y())/2+l.y,f=(o.z()-r.z())/2+l.z;return new Ammo.btVector3(u,c,f)},s=new Ammo.btTransform;if(s.setIdentity(),i){const o=e(t.getWorldTransform().getOrigin(),n.getWorldTransform().getOrigin()),r=new Ammo.btTransform;r.setIdentity(),r.setOrigin(o);const u=t.getCenterOfMassTransform().inverse().op_mul(n.getWorldTransform());return u.op_mul(r),{transformA:u,transformB:r}}else return s.setOrigin(new Ammo.btVector3(l.x,l.y,l.z)),{transformA:t.getCenterOfMassTransform().inverse().op_mul(n.getWorldTransform()).op_mul(s),transformB:s}}lock(t,n,l=!0){const i={x:0,y:0,z:0};return this.dof(t,n,{angularLowerLimit:i,angularUpperLimit:i},l)}fixed(t,n,l=!0){const i=this.getTransform(t.ammo,n.ammo);i.transformA.setRotation(t.ammo.getWorldTransform().getRotation()),i.transformB.setRotation(n.ammo.getWorldTransform().getRotation());const e=new Ammo.btFixedConstraint(t.ammo,n.ammo,i.transformA,i.transformB);return this.physicsWorld.addConstraint(e,l),e}pointToPoint(t,n,l={},i=!0){const{pivotA:e,pivotB:s}=l,o=new Ammo.btVector3((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0),r=new Ammo.btVector3((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),u=new Ammo.btPoint2PointConstraint(t.ammo,n.ammo,o,r);return this.physicsWorld.addConstraint(u,i),u}hinge(t,n,l={},i=!0){const{pivotA:e,pivotB:s,axisA:o,axisB:r}=l,u=new Ammo.btVector3((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0),c=new Ammo.btVector3((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),f=new Ammo.btVector3((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),h=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),a=new Ammo.btHingeConstraint(t.ammo,n.ammo,u,c,f,h,!0);return this.physicsWorld.addConstraint(a,i),a}slider(t,n,l={},i=!0){const e=this.getTransform(t.ammo,n.ammo),{frameA:s={},frameB:o={},linearLowerLimit:r=0,linearUpperLimit:u=0,angularLowerLimit:c=0,angularUpperLimit:f=0}=l,h=e.transformA.getRotation();h.setEulerZYX(s.x||0,s.y||0,s.z||0),e.transformA.setRotation(h);const a=e.transformB.getRotation();a.setEulerZYX(o.x||0,o.y||0,o.z||0),e.transformB.setRotation(a);const m=new Ammo.btSliderConstraint(t.ammo,n.ammo,e.transformA,e.transformB,!0);return m.setLowerLinLimit(r),m.setUpperLinLimit(u),m.setLowerAngLimit(c),m.setUpperAngLimit(f),this.physicsWorld.addConstraint(m,i),m}spring(t,n,l={},i=!0){const{stiffness:e=50,damping:s=.01,angularLock:o=!1,linearLowerLimit:r={},linearUpperLimit:u={},angularLowerLimit:c={},angularUpperLimit:f={},offset:h={},center:a=!1,enableSpring:m=!0}=l,d={x:0,y:0,z:0,...h},p=this.getTransform(t.ammo,n.ammo,d,a),x=new Ammo.btGeneric6DofSpringConstraint(t.ammo,n.ammo,p.transformA,p.transformB,!0);this.tmpBtVector3.setValue(r.x||0,r.y||0,r.z||0),x.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(u.x||0,u.y||0,u.z||0),x.setLinearUpperLimit(this.tmpBtVector3),o?(this.tmpBtVector3.setValue(0,0,0),x.setAngularLowerLimit(this.tmpBtVector3),x.setAngularUpperLimit(this.tmpBtVector3)):(console.log(c,f),x.setAngularLowerLimit(this.toAmmoV3(c,-Math.PI)),x.setAngularUpperLimit(this.toAmmoV3(f,Math.PI)));for(let w=0;w<3;w++)x.enableSpring(w,m),x.setStiffness(w,e),x.setDamping(w,s);return this.physicsWorld.addConstraint(x,i),x}coneTwist(t,n,l,i=!0){const{frameA:e,frameB:s}=l,o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0);const r=new Ammo.btTransform;r.setIdentity(),r.getOrigin().setValue((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),this.getTransform(t.ammo,n.ammo);const u=new Ammo.btConeTwistConstraint(n.ammo,t.ammo,o,r);return u.setAngularOnly(!0),this.physicsWorld.addConstraint(u,i),u}dof(t,n,l={},i=!0){const{offset:e,center:s=!1}=l,o={x:0,y:0,z:0,...e},r=this.getTransform(t.ammo,n.ammo,o,s),u=new Ammo.btGeneric6DofConstraint(t.ammo,n.ammo,r.transformA,r.transformB,!0),{linearLowerLimit:c,linearUpperLimit:f,angularLowerLimit:h,angularUpperLimit:a}=l,m=this.toAmmoV3(c),d=this.toAmmoV3(f),p=this.toAmmoV3(h,-Math.PI),x=this.toAmmoV3(a,Math.PI);return u.setLinearLowerLimit(m),u.setLinearUpperLimit(d),u.setAngularLowerLimit(p),u.setAngularUpperLimit(x),Ammo.destroy(m),Ammo.destroy(d),Ammo.destroy(p),Ammo.destroy(x),this.physicsWorld.addConstraint(u,i),u}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */const Ae={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},Se={ALL:"all",MANUAL:"manual"},Ns=function(){const A=new B,t=new B,n=new Q;return function(l,i,e,s={}){if(s.type=Ae.HULL,ke(s),s.fit===Se.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const o=it(l,i),r=new Ammo.btVector3,u=new Ammo.btConvexHullShape;u.setMargin(s.margin),t.addVectors(o.max,o.min).multiplyScalar(.5);let c=0;for(let m=0;m<l.length;m++)c+=l[m].length/3;const f=s.hullMaxVertices||1e5;c>f&&console.warn(`too many vertices for hull shape; sampling ~${f} from ~${c} vertices`);const h=Math.min(1,f/c);for(let m=0;m<l.length;m++){const d=l[m];n.fromArray(i[m]);for(let p=0;p<d.length;p+=3){const x=m===l.length-1&&p===d.length-3;(Math.random()<=h||x)&&(A.set(d[p],d[p+1],d[p+2]).applyMatrix4(n).sub(t),r.setValue(A.x,A.y,A.z),u.addPoint(r,x))}}let a=u;if(u.getNumVertices()>=100){const m=new Ammo.btShapeHull(u);m.buildHull(s.margin),Ammo.destroy(u),a=new Ammo.btConvexHullShape(Ammo.getPointer(m.getVertexPointer()),m.numVertices()),Ammo.destroy(m)}return Ammo.destroy(r),Oe(a,s,Fe(e,s)),a}}(),Hs=function(){const A=new B,t=new B,n=new Q;return function(l,i,e,s,o={}){if(o.type=Ae.HACD,ke(o),o.fit===Se.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const r=it(l,i);Fe(s,o);let u=0,c=0;t.addVectors(r.max,r.min).multiplyScalar(.5);for(let w=0;w<l.length;w++)u+=l[w].length/3,e&&e[w]?c+=e[w].length/3:c+=l[w].length/9;const f=new Ammo.HACD;o.hasOwnProperty("compacityWeight")&&f.SetCompacityWeight(o.compacityWeight),o.hasOwnProperty("volumeWeight")&&f.SetVolumeWeight(o.volumeWeight),o.hasOwnProperty("nClusters")&&f.SetNClusters(o.nClusters),o.hasOwnProperty("nVerticesPerCH")&&f.SetNVerticesPerCH(o.nVerticesPerCH),o.hasOwnProperty("concavity")&&f.SetConcavity(o.concavity);const h=Ammo._malloc(u*3*8),a=Ammo._malloc(c*3*4);f.SetPoints(h),f.SetTriangles(a),f.SetNPoints(u),f.SetNTriangles(c);let m=h/8,d=a/4;for(let w=0;w<l.length;w++){const T=l[w];n.fromArray(i[w]);for(let M=0;M<T.length;M+=3)A.set(T[M+0],T[M+1],T[M+2]).applyMatrix4(n).sub(t),Ammo.HEAPF64[m+0]=A.x,Ammo.HEAPF64[m+1]=A.y,Ammo.HEAPF64[m+2]=A.z,m+=3;if(e[w]){const M=e[w];for(let g=0;g<M.length;g++)Ammo.HEAP32[d]=M[g],d++}else for(let M=0;M<T.length/3;M++)Ammo.HEAP32[d]=M,d++}f.Compute(),Ammo._free(h),Ammo._free(a);const p=f.GetNClusters(),x=[];for(let w=0;w<p;w++){const T=new Ammo.btConvexHullShape;T.setMargin(o.margin);const M=f.GetNPointsCH(w),g=f.GetNTrianglesCH(w),y=Ammo._malloc(M*3*8),S=Ammo._malloc(g*3*4);f.GetCH(w,y,S);const v=y/8;for(let b=0;b<M;b++){const C=new Ammo.btVector3,E=Ammo.HEAPF64[v+b*3+0],P=Ammo.HEAPF64[v+b*3+1],R=Ammo.HEAPF64[v+b*3+2];C.setValue(E,P,R),T.addPoint(C,b===M-1),Ammo.destroy(C)}Oe(),x.push(T)}return x}}(),_s=function(){const A=new B,t=new B,n=new Q;return function(l,i,e,s,o={}){if(o.type=Ae.VHACD,ke(o),o.fit===Se.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const r=it(l,i);Fe(s,o);let u=0,c=0;t.addVectors(r.max,r.min).multiplyScalar(.5);for(let M=0;M<l.length;M++)u+=l[M].length/3,e&&e[M]?c+=e[M].length/3:c+=l[M].length/9;const f=new Ammo.VHACD,h=new Ammo.Parameters;o.hasOwnProperty("resolution")&&h.set_m_resolution(o.resolution),o.hasOwnProperty("depth")&&h.set_m_depth(o.depth),o.hasOwnProperty("concavity")&&h.set_m_concavity(o.concavity),o.hasOwnProperty("planeDownsampling")&&h.set_m_planeDownsampling(o.planeDownsampling),o.hasOwnProperty("convexhullDownsampling")&&h.set_m_convexhullDownsampling(o.convexhullDownsampling),o.hasOwnProperty("alpha")&&h.set_m_alpha(o.alpha),o.hasOwnProperty("beta")&&h.set_m_beta(o.beta),o.hasOwnProperty("gamma")&&h.set_m_gamma(o.gamma),o.hasOwnProperty("pca")&&h.set_m_pca(o.pca),o.hasOwnProperty("mode")&&h.set_m_mode(o.mode),o.hasOwnProperty("maxNumVerticesPerCH")&&h.set_m_maxNumVerticesPerCH(o.maxNumVerticesPerCH),o.hasOwnProperty("minVolumePerCH")&&h.set_m_minVolumePerCH(o.minVolumePerCH),o.hasOwnProperty("convexhullApproximation")&&h.set_m_convexhullApproximation(o.convexhullApproximation),o.hasOwnProperty("oclAcceleration")&&h.set_m_oclAcceleration(o.oclAcceleration);const a=Ammo._malloc(u*3*8+3),m=Ammo._malloc(c*3*4);let d=a/8,p=m/4;for(let M=0;M<l.length;M++){const g=l[M];n.fromArray(i[M]);for(let y=0;y<g.length;y+=3)A.set(g[y+0],g[y+1],g[y+2]).applyMatrix4(n).sub(t),Ammo.HEAPF64[d+0]=A.x,Ammo.HEAPF64[d+1]=A.y,Ammo.HEAPF64[d+2]=A.z,d+=3;if(e[M]){const y=e[M];for(let S=0;S<y.length;S++)Ammo.HEAP32[p]=y[S],p++}else for(let y=0;y<g.length/3;y++)Ammo.HEAP32[p]=y,p++}f.Compute(a,3,u,m,3,c,h),Ammo._free(a),Ammo._free(m);const x=f.GetNConvexHulls(),w=[],T=new Ammo.ConvexHull;for(let M=0;M<x;M++){f.GetConvexHull(M,T);const g=T.get_m_nPoints();T.get_m_points();const y=new Ammo.btConvexHullShape;y.setMargin(o.margin);for(let S=0;S<g;S++){const v=new Ammo.btVector3,b=T.get_m_points(S*3+0),C=T.get_m_points(S*3+1),E=T.get_m_points(S*3+2);v.setValue(b,C,E),y.addPoint(v,S===g-1),Ammo.destroy(v)}Oe(),w.push(y)}return Ammo.destroy(T),Ammo.destroy(f),w}}(),je=function(){const A=new B,t=new B,n=new B,l=new Q;return function(i,e,s,o,r={}){if(r.type=Ae.MESH,ke(r),r.fit===Se.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const u=Fe(o,r),c=new Ammo.btVector3,f=new Ammo.btVector3,h=new Ammo.btVector3,a=new Ammo.btTriangleMesh(!0,!1);for(let p=0;p<i.length;p++){const x=i[p],w=s[p]?s[p]:null;if(l.fromArray(e[p]),w)for(let T=0;T<w.length;T+=3){const M=w[T]*3,g=w[T+1]*3,y=w[T+2]*3;A.set(x[M],x[M+1],x[M+2]).applyMatrix4(l),t.set(x[g],x[g+1],x[g+2]).applyMatrix4(l),n.set(x[y],x[y+1],x[y+2]).applyMatrix4(l),c.setValue(A.x,A.y,A.z),f.setValue(t.x,t.y,t.z),h.setValue(n.x,n.y,n.z),a.addTriangle(c,f,h,!1)}else for(let T=0;T<x.length;T+=9)A.set(x[T+0],x[T+1],x[T+2]).applyMatrix4(l),t.set(x[T+3],x[T+4],x[T+5]).applyMatrix4(l),n.set(x[T+6],x[T+7],x[T+8]).applyMatrix4(l),c.setValue(A.x,A.y,A.z),f.setValue(t.x,t.y,t.z),h.setValue(n.x,n.y,n.z),a.addTriangle(c,f,h,!1)}const m=new Ammo.btVector3(u.x,u.y,u.z);a.setScaling(m),Ammo.destroy(m);let d;return r.concave?d=new Ammo.btBvhTriangleMeshShape(a,!0,!0):d=new Ammo.btConvexTriangleMeshShape(a,!0),d.resources=[a],Ammo.destroy(c),Ammo.destroy(f),Ammo.destroy(h),Oe(),d}}();function ke(A){A.type=A.type||Ae.HULL,A.margin=A.hasOwnProperty("margin")?A.margin:.01}const Oe=function(A,t,n){},Us=function(){const A=new Q;return function(t,n,l){parseInt(jt)>=123?A.copy(t.matrixWorld).invert():A.getInverse(t.matrixWorld),new B().setFromMatrixScale(t.matrixWorld),t.traverse(e=>{const s=new Q;e.isMesh&&(n.includeInvisible||e.el&&e.el.object3D.visible||e.visible)&&(e===t?s.identity():(e.updateWorldMatrix(!0),s.multiplyMatrices(A,e.matrixWorld)),l(e.geometry.isBufferGeometry?e.geometry.attributes.position.array:e.geometry.vertices,s.elements,e.geometry.index?e.geometry.index.array:null))})}}(),Fe=function(){const A=new Q;return function(t,n={}){const l=new B(1,1,1);return n.fit===Se.ALL&&(A.fromArray(t),l.setFromMatrixScale(A)),l}}();(function(){const A=new B;return function(t,n,l){let i=0,{x:e,y:s,z:o}=l.getCenter(A);return $t(t,n,r=>{const u=e-r.x,c=s-r.y,f=o-r.z;i=Math.max(i,u*u+c*c+f*f)}),Math.sqrt(i)}})();const it=function(A,t){const n=new tt;let l=1/0,i=1/0,e=1/0,s=-1/0,o=-1/0,r=-1/0;return n.min.set(0,0,0),n.max.set(0,0,0),$t(A,t,u=>{u.x<l&&(l=u.x),u.y<i&&(i=u.y),u.z<e&&(e=u.z),u.x>s&&(s=u.x),u.y>o&&(o=u.y),u.z>r&&(r=u.z)}),n.min.set(l,i,e),n.max.set(s,o,r),n},$t=function(){const A=new B,t=new Q;return function(n,l,i){for(let e=0;e<n.length;e++){t.fromArray(l[e]);for(let s=0;s<n[e].length;s+=3)A.set(n[e][s],n[e][s+1],n[e][s+2]).applyMatrix4(t),i(A)}}}();/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */const zs=(A,t)=>{const{radius:n=1,tube:l=.4,tubularSegments:i=8}=A,e=Math.PI,s=i,o=Math.sqrt(2*l*l-2*l*l*Math.cos(2*e/s)),r=new Ammo.btVector3(l,e/s+.5*o,l),u=new Ammo.btCylinderShape(r);u.setMargin(.05);const c=new Ammo.btCompoundShape,f=new Ammo.btVector3(0,0,1),h=new Ammo.btVector3(0,n,0),a=new Ammo.btQuaternion(t.x,t.y,t.z,t.w);for(let m=0;m<s;m++){const d=m*2*e/s,p=h.rotate(f,d),x=new Ammo.btTransform;a.setRotation(f,d+Math.PI/2),x.setIdentity(),x.setOrigin(p),x.setRotation(a),c.addChildShape(x,u)}return c};/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Gs extends ve{addCollider(t,n,l){!t.body||!n.body||(t.body.checkCollisions=!0,n.body.checkCollisions=!0,this.on("collision",i=>{var o,r;const{bodies:e,event:s}=i;(o=e[0])!=null&&o.name&&((r=e[1])!=null&&r.name)&&(t!=null&&t.name)&&(n!=null&&n.name)&&(e[0].name===t.name&&e[1].name===n.name||e[1].name===t.name&&e[0].name===n.name)&&l(s)}))}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */const bt={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295};class Ws{constructor(t,n,l={}){this.scene=t,this.world=n,this.options=l,this.debugDrawMode=l.debugDrawMode||bt.DrawWireframe;const i=this.debugDrawMode&bt.DrawOnTop||!1,e=l.maxBufferSize||1e6;this.geometry=new De;const s=new Float32Array(e*3),o=new Float32Array(e*3);this.geometry.setAttribute("position",new ge(s,3).setUsage(xt)),this.geometry.setAttribute("color",new ge(o,3).setUsage(xt)),this.index=0;const r=new Je({vertexColors:!0,depthTest:!i});this.mesh=new _t(this.geometry,r),i&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){this.enabled&&(this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(t,n,l){const i=Ammo.HEAPF32,e=i[(l+0)/4],s=i[(l+4)/4],o=i[(l+8)/4],r=i[(t+0)/4],u=i[(t+4)/4],c=i[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,r,u,c),this.geometry.attributes.color.setXYZ(this.index++,e,s,o);const f=i[(n+0)/4],h=i[(n+4)/4],a=i[(n+8)/4];this.geometry.attributes.position.setXYZ(this.index,f,h,a),this.geometry.attributes.color.setXYZ(this.index++,e,s,o)}drawContactPoint(t,n,l,i,e){const s=Ammo.HEAPF32,o=s[(e+0)/4],r=s[(e+4)/4],u=s[(e+8)/4],c=s[(t+0)/4],f=s[(t+4)/4],h=s[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,c,f,h),this.geometry.attributes.color.setXYZ(this.index++,o,r,u);const a=s[(n+0)/4]*l,m=s[(n+4)/4]*l,d=s[(n+8)/4]*l;this.geometry.attributes.position.setXYZ(this.index,c+a,f+m,h+d),this.geometry.attributes.color.setXYZ(this.index++,o,r,u)}reportErrorWarning(t){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(t)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(t,n){console.warn("TODO: draw3dText")}setDebugMode(t){this.debugDrawMode=t}getDebugMode(){return this.debugDrawMode}}const Ve=0,Ks=1,js=new B,Et=new Xt,Xe=new Le,Pt=new B,Re=new jn;class Xs{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Rt,this.unassigned=new Rt,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let n=0,l=t.length;n<l;n++)this.vertices.push(new Qs(t[n]));this.compute()}return this}setFromObject(t){const n=[];return t.updateMatrixWorld(!0),t.traverse(function(l){const i=l.geometry;if(i!==void 0){const e=i.attributes.position;if(e!==void 0)for(let s=0,o=e.count;s<o;s++){const r=new B;r.fromBufferAttribute(e,s).applyMatrix4(l.matrixWorld),n.push(r)}}}),this.setFromPoints(n)}containsPoint(t){const n=this.faces;for(let l=0,i=n.length;l<i;l++)if(n[l].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,n){const l=this.faces;let i=-1/0,e=1/0;for(let s=0,o=l.length;s<o;s++){const r=l[s],u=r.distanceToPoint(t.origin),c=r.normal.dot(t.direction);if(u>0&&c>=0)return null;const f=c!==0?-u/c:0;if(!(f<=0)&&(c>0?e=Math.min(f,e):i=Math.max(f,i),i>e))return null}return i!==-1/0?t.at(i,n):t.at(e,n),n}intersectsRay(t){return this.intersectRay(t,js)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,n){return t.face=n,n.outside===null?this.assigned.append(t):this.assigned.insertBefore(n.outside,t),n.outside=t,this}removeVertexFromFace(t,n){return t===n.outside&&(t.next!==null&&t.next.face===n?n.outside=t.next:n.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(t.outside!==null){const n=t.outside;let l=t.outside;for(;l.next!==null&&l.next.face===t;)l=l.next;return this.assigned.removeSubList(n,l),n.prev=l.next=null,t.outside=null,n}}deleteFaceVertices(t,n){const l=this.removeAllVerticesFromFace(t);if(l!==void 0)if(n===void 0)this.unassigned.appendChain(l);else{let i=l;do{const e=i.next;n.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,n):this.unassigned.append(i),i=e}while(i!==null)}return this}resolveUnassignedPoints(t){if(this.unassigned.isEmpty()===!1){let n=this.unassigned.first();do{const l=n.next;let i=this.tolerance,e=null;for(let s=0;s<t.length;s++){const o=t[s];if(o.mark===Ve){const r=o.distanceToPoint(n.point);if(r>i&&(i=r,e=o),i>1e3*this.tolerance)break}}e!==null&&this.addVertexToFace(n,e),n=l}while(n!==null)}return this}computeExtremes(){const t=new B,n=new B,l=[],i=[];for(let e=0;e<3;e++)l[e]=i[e]=this.vertices[0];t.copy(this.vertices[0].point),n.copy(this.vertices[0].point);for(let e=0,s=this.vertices.length;e<s;e++){const o=this.vertices[e],r=o.point;for(let u=0;u<3;u++)r.getComponent(u)<t.getComponent(u)&&(t.setComponent(u,r.getComponent(u)),l[u]=o);for(let u=0;u<3;u++)r.getComponent(u)>n.getComponent(u)&&(n.setComponent(u,r.getComponent(u)),i[u]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(n.x))+Math.max(Math.abs(t.y),Math.abs(n.y))+Math.max(Math.abs(t.z),Math.abs(n.z))),{min:l,max:i}}computeInitialHull(){const t=this.vertices,n=this.computeExtremes(),l=n.min,i=n.max;let e=0,s=0;for(let h=0;h<3;h++){const a=i[h].point.getComponent(h)-l[h].point.getComponent(h);a>e&&(e=a,s=h)}const o=l[s],r=i[s];let u,c;e=0,Et.set(o.point,r.point);for(let h=0,a=this.vertices.length;h<a;h++){const m=t[h];if(m!==o&&m!==r){Et.closestPointToPoint(m.point,!0,Pt);const d=Pt.distanceToSquared(m.point);d>e&&(e=d,u=m)}}e=-1,Xe.setFromCoplanarPoints(o.point,r.point,u.point);for(let h=0,a=this.vertices.length;h<a;h++){const m=t[h];if(m!==o&&m!==r&&m!==u){const d=Math.abs(Xe.distanceToPoint(m.point));d>e&&(e=d,c=m)}}const f=[];if(Xe.distanceToPoint(c.point)<0){f.push(J.create(o,r,u),J.create(c,r,o),J.create(c,u,r),J.create(c,o,u));for(let h=0;h<3;h++){const a=(h+1)%3;f[h+1].getEdge(2).setTwin(f[0].getEdge(a)),f[h+1].getEdge(1).setTwin(f[a+1].getEdge(0))}}else{f.push(J.create(o,u,r),J.create(c,o,r),J.create(c,r,u),J.create(c,u,o));for(let h=0;h<3;h++){const a=(h+1)%3;f[h+1].getEdge(2).setTwin(f[0].getEdge((3-h)%3)),f[h+1].getEdge(0).setTwin(f[a+1].getEdge(1))}}for(let h=0;h<4;h++)this.faces.push(f[h]);for(let h=0,a=t.length;h<a;h++){const m=t[h];if(m!==o&&m!==r&&m!==u&&m!==c){e=this.tolerance;let d=null;for(let p=0;p<4;p++){const x=this.faces[p].distanceToPoint(m.point);x>e&&(e=x,d=this.faces[p])}d!==null&&this.addVertexToFace(m,d)}}return this}reindexFaces(){const t=[];for(let n=0;n<this.faces.length;n++){const l=this.faces[n];l.mark===Ve&&t.push(l)}return this.faces=t,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let t,n=0;const l=this.assigned.first().face;let i=l.outside;do{const e=l.distanceToPoint(i.point);e>n&&(n=e,t=i),i=i.next}while(i!==null&&i.face===l);return t}}computeHorizon(t,n,l,i){this.deleteFaceVertices(l),l.mark=Ks;let e;n===null?e=n=l.getEdge(0):e=n.next;do{const s=e.twin,o=s.face;o.mark===Ve&&(o.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,s,o,i):i.push(e)),e=e.next}while(e!==n);return this}addAdjoiningFace(t,n){const l=J.create(t,n.tail(),n.head());return this.faces.push(l),l.getEdge(-1).setTwin(n.twin),l.getEdge(0)}addNewFaces(t,n){this.newFaces=[];let l=null,i=null;for(let e=0;e<n.length;e++){const s=n[e],o=this.addAdjoiningFace(t,s);l===null?l=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return l.next.setTwin(i),this}addVertexToHull(t){const n=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,n),this.addNewFaces(t,n),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();(t=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class J{constructor(){this.normal=new B,this.midpoint=new B,this.area=0,this.constant=0,this.outside=null,this.mark=Ve,this.edge=null}static create(t,n,l){const i=new J,e=new Qe(t,i),s=new Qe(n,i),o=new Qe(l,i);return e.next=o.prev=s,s.next=e.prev=o,o.next=s.prev=e,i.edge=e,i.compute()}getEdge(t){let n=this.edge;for(;t>0;)n=n.next,t--;for(;t<0;)n=n.prev,t++;return n}compute(){const t=this.edge.tail(),n=this.edge.head(),l=this.edge.next.head();return Re.set(t.point,n.point,l.point),Re.getNormal(this.normal),Re.getMidpoint(this.midpoint),this.area=Re.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class Qe{constructor(t,n){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=n}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),n=this.tail();return n!==null?n.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),n=this.tail();return n!==null?n.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class Qs{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class Rt{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,n){return n.prev=t.prev,n.next=t,n.prev===null?this.head=n:n.prev.next=n,t.prev=n,this}insertAfter(t,n){return n.prev=t,n.next=t.next,n.next===null?this.tail=n:n.next.prev=n,t.next=n,this}append(t){return this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail;t.next!==null;)t=t.next;return this.tail=t,this}remove(t){return t.prev===null?this.head=t.next:t.prev.next=t.next,t.next===null?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,n){return t.prev===null?this.head=n.next:t.prev.next=n.next,n.next===null?this.tail=t.prev:n.next.prev=t.prev,this}isEmpty(){return this.head===null}}class Ys extends De{constructor(t=[]){super();const n=[],l=[],e=new Xs().setFromPoints(t).faces;for(let s=0;s<e.length;s++){const o=e[s];let r=o.edge;do{const u=r.head().point;n.push(u.x,u.y,u.z),l.push(o.normal.x,o.normal.y,o.normal.z),r=r.next}while(r!==o.edge)}this.setAttribute("position",new yt(n,3)),this.setAttribute("normal",new yt(l,3))}}const Lt=A=>{const t=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:Ys;return new t(A)},te=function(A,t){this.minSizeForBreak=A||1.4,this.smallDelta=t||1e-4,this.tempLine1=new Xt,this.tempPlane1=new Le,this.tempPlane2=new Le,this.tempPlane_Cut=new Le,this.tempCM1=new B,this.tempCM2=new B,this.tempVector3=new B,this.tempVector3_2=new B,this.tempVector3_3=new B,this.tempVector3_P0=new B,this.tempVector3_P1=new B,this.tempVector3_P2=new B,this.tempVector3_N0=new B,this.tempVector3_N1=new B,this.tempVector3_AB=new B,this.tempVector3_CB=new B,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var n=30*30,l=0;l<n;l++)this.segments[l]=!1};te.prototype={constructor:te,prepareBreakableObject:function(A,t,n,l,i){A.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),A.userData.ammoPhysicsData={};var e=A.userData.ammoPhysicsData;e.mass=t,e.velocity=n.clone(),e.angularVelocity=l.clone(),e.breakable=i},subdivideByImpact:function(A,t,n,l,i){var e=[],s=this.tempPlane1,o=this.tempPlane2;this.tempVector3.addVectors(t,n),s.setFromCoplanarPoints(t,A.position,this.tempVector3);var r=i+l,u=this;function c(f,h,a,m){if(Math.random()<m*.05||m>r){e.push(f);return}var d=Math.PI;m===0?(o.normal.copy(s.normal),o.constant=s.constant):m<=l?(d=(a-h)*(.2+.6*Math.random())+h,u.tempVector3_2.copy(A.position).sub(t).applyAxisAngle(n,d).add(t),o.setFromCoplanarPoints(t,u.tempVector3,u.tempVector3_2)):(d=(.5*(m&1)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(t).sub(f.position).applyAxisAngle(n,d).add(f.position),u.tempVector3_3.copy(n).add(f.position),o.setFromCoplanarPoints(f.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(f,o,u.tempResultObjects);var p=u.tempResultObjects.object1,x=u.tempResultObjects.object2;p&&c(p,h,d,m+1),x&&c(x,d,a,m+1)}return c(A,0,2*Math.PI,0),e},cutByPlane:function(A,t,n){var l=A.geometry,i=l.attributes.position.array,e=l.attributes.normal.array,s=i.length/3,o=s/3,r=l.getIndex();r&&(r=r.array,o=r.length/3);function u(G,Ne){var Te=G*3+Ne;return r?r[Te]:Te}for(var c=[],f=[],h=this.smallDelta,a=s*s,m=0;m<a;m++)this.segments[m]=!1;for(var d=this.tempVector3_P0,p=this.tempVector3_P1,x=this.tempVector3_N0,w=this.tempVector3_N1,m=0;m<o-1;m++){var T=u(m,0),M=u(m,1),g=u(m,2);x.set(e[T],e[T]+1,e[T]+2);for(var y=m+1;y<o;y++){var S=u(y,0),v=u(y,1),b=u(y,2);w.set(e[S],e[S]+1,e[S]+2);var C=1-x.dot(w)<h;C&&(T===S||T===v||T===b?M===S||M===v||M===b?(this.segments[T*s+M]=!0,this.segments[M*s+T]=!0):(this.segments[g*s+T]=!0,this.segments[T*s+g]=!0):(M===S||M===v||M===b)&&(this.segments[g*s+M]=!0,this.segments[M*s+g]=!0))}}var E=this.tempPlane_Cut;A.updateMatrix(),te.transformPlaneToLocalSpace(t,A.matrix,E);for(var m=0;m<o;m++)for(var P=u(m,0),R=u(m,1),L=u(m,2),V=0;V<3;V++){var D=V===0?P:V===1?R:L,I=V===0?R:V===1?L:P,k=this.segments[D*s+I];if(!k){this.segments[D*s+I]=!0,this.segments[I*s+D]=!0,d.set(i[3*D],i[3*D+1],i[3*D+2]),p.set(i[3*I],i[3*I+1],i[3*I+2]);var F=0,_=E.distanceToPoint(d);_>h?(F=2,f.push(d.clone())):_<-h?(F=1,c.push(d.clone())):(F=3,c.push(d.clone()),f.push(d.clone()));var H=0,_=E.distanceToPoint(p);if(_>h?(H=2,f.push(p.clone())):_<-h?(H=1,c.push(p.clone())):(H=3,c.push(p.clone()),f.push(p.clone())),F===1&&H===2||F===2&&H===1){this.tempLine1.start.copy(d),this.tempLine1.end.copy(p);var U=new B;if(U=E.intersectLine(this.tempLine1,U),U===void 0)return console.error("Internal error: segment does not intersect plane."),n.segmentedObject1=null,n.segmentedObject2=null,0;c.push(U),f.push(U.clone())}}}var W=A.userData.ammoPhysicsData.mass*.5;this.tempCM1.set(0,0,0);var Z=0,K=c.length;if(K>0){for(var m=0;m<K;m++)this.tempCM1.add(c[m]);this.tempCM1.divideScalar(K);for(var m=0;m<K;m++){var O=c[m];O.sub(this.tempCM1),Z=Math.max(Z,O.x,O.y,O.z)}this.tempCM1.add(A.position)}this.tempCM2.set(0,0,0);var X=0,z=f.length;if(z>0){for(var m=0;m<z;m++)this.tempCM2.add(f[m]);this.tempCM2.divideScalar(z);for(var m=0;m<z;m++){var O=f[m];O.sub(this.tempCM2),X=Math.max(X,O.x,O.y,O.z)}this.tempCM2.add(A.position)}var $=null,j=null,Y=0;if(K>4)try{$=new Ie(Lt(c),A.material),$.position.copy(this.tempCM1),$.quaternion.copy(A.quaternion),$.userData=A.userData,this.prepareBreakableObject($,W,A.userData.ammoPhysicsData.velocity,A.userData.ammoPhysicsData.angularVelocity,2*Z>this.minSizeForBreak),Y++}catch(G){ie("Error in ConvexObjectBreaker.ts",!0),ie(G,!0)}if(z>4)try{j=new Ie(Lt(f),A.material),j.position.copy(this.tempCM2),j.quaternion.copy(A.quaternion),j.userData=A.userData,this.prepareBreakableObject(j,W,A.userData.ammoPhysicsData.velocity,A.userData.ammoPhysicsData.angularVelocity,2*X>this.minSizeForBreak),Y++}catch(G){ie("Error in ConvexObjectBreaker.ts",!0),ie(G,!0)}return n.object1=$,n.object2=j,Y}};te.transformFreeVector=function(A,t){var n=A.x,l=A.y,i=A.z,e=t.elements;return A.x=e[0]*n+e[4]*l+e[8]*i,A.y=e[1]*n+e[5]*l+e[9]*i,A.z=e[2]*n+e[6]*l+e[10]*i,A};te.transformFreeVectorInverse=function(A,t){var n=A.x,l=A.y,i=A.z,e=t.elements;return A.x=e[0]*n+e[1]*l+e[2]*i,A.y=e[4]*n+e[5]*l+e[6]*i,A.z=e[8]*n+e[9]*l+e[10]*i,A};te.transformTiedVectorInverse=function(A,t){var n=A.x,l=A.y,i=A.z,e=t.elements;return A.x=e[0]*n+e[1]*l+e[2]*i-e[12],A.y=e[4]*n+e[5]*l+e[6]*i-e[13],A.z=e[8]*n+e[9]*l+e[10]*i-e[14],A};te.transformPlaneToLocalSpace=function(){var A=new B;return function(n,l,i){i.normal.copy(n.normal),i.constant=n.constant;var e=te.transformTiedVectorInverse(n.coplanarPoint(A),l);te.transformFreeVectorInverse(i.normal,l),i.constant=-e.dot(i.normal)}}();const Zs=(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const A=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(A instanceof WebAssembly.Module)return new WebAssembly.Instance(A)instanceof WebAssembly.Instance}}catch(A){A instanceof Error&&console.error(A.message)}return!1})(),Vt=(A,t)=>{var n=document.createElement("script");n.onload=()=>{t()},n.onerror=()=>{throw new Error(`failed to load ${A}`)},n.async=!0,n.src=A,document.head.appendChild(n)},$s=(A,t)=>{Zs?Vt(`${A}/ammo.wasm.js`,()=>t()):Vt(`${A}/ammo.js`,()=>t())},fi=(A,t)=>{typeof window<"u"&&(window.__loadPhysics=!0),$s(A,()=>{Ammo().then(()=>{t()})})};function qt(A,t){t.forEach(n=>{Object.getOwnPropertyNames(n.prototype).forEach(l=>{Object.defineProperty(A.prototype,l,Object.getOwnPropertyDescriptor(n.prototype,l)||Object.create(null))})})}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class qs{constructor(t){this.physics=t}getHitPointWorld(){const t=this._btRayCallback.get_m_hitPointWorld();return{x:t.x(),y:t.y(),z:t.z()}}getHitNormalWorld(){const t=this._btRayCallback.get_m_hitNormalWorld();return{x:t.x(),y:t.y(),z:t.z()}}getCollisionObject(){return Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody).threeObject}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Js{constructor(t){this.physics=t}getHitPointsWorld(){const t=this._btRayCallback.get_m_hitPointWorld(),n=[];for(let l=t.size()-1;l>=0;l--){const i=t.at(l);n.push({x:i.x(),y:i.y(),z:i.z()})}return n}getHitPointWorld(){return ie("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){const t=this._btRayCallback.get_m_hitNormalWorld(),n=[];for(let l=t.size()-1;l>=0;l--){const i=t.at(l);n.push({x:i.x(),y:i.y(),z:i.z()})}return n}getCollisionObjects(){const t=[],n=this._btRayCallback.get_m_collisionObjects();for(let l=n.size()-1;l>=0;l--){const i=Ammo.castObject(n.at(l),Ammo.btRigidBody);t.push(i.threeObject)}return t}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Jt{constructor(t){this.physics=t}setRayFromWorld(t=0,n=0,l=0){this._btRayFrom.setValue(t,n,l)}setRayToWorld(t=0,n=0,l=0){this._btRayTo.setValue(t,n,l)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback),this._btRayCallback=this.type==="closest"?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){typeof this._btRayFrom<"u"&&Ammo.destroy(this._btRayFrom),typeof this._btRayTo<"u"&&Ammo.destroy(this._btRayTo),typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback)}}class en{constructor(t){this.physics=t,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}class tn{constructor(t){this.physics=t,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}qt(en,[Jt,qs]);qt(tn,[Jt,Js]);/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class hi extends ve{constructor(t,n={}){super(),this.scene=t,this.config=n,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=n.gravity||{x:0,y:-9.81,z:0},this.isHeadless=t==="headless",this.tmpEuler=new nt,this.tmpQuaternion=new le,this.tmpVector3=new B,this.tmpVector3a=new B,this.tmpMatrix4=new Q,this.tmpMatrix4a=new Q,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new B,this.impactPoint=new B,this.impactNormal=new B,t!=="headless"&&(this.defaultMaterial=new Zt),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(t){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=t}destroy(t){var e;const n=Object.keys(t).includes("body")?t.body:t;if(typeof(n==null?void 0:n.ammo)>"u")return;let l=n.ammo.threeObject;const i=l.name;if(i&&l&&(e=l==null?void 0:l.body)!=null&&e.ammo){l.body.isSoftBody?this.physicsWorld.removeSoftBody(l.body.ammo):this.physicsWorld.removeRigidBody(l.body.ammo),l.body.destructor(),l.body=void 0,l.hasBody=!1,delete n.ammo.threeObject;for(let s=0;s<this.rigidBodies.length;s++)this.rigidBodies[s].name===i&&(this.rigidBodies.splice(s,1),s--)}this.scene==="headless"&&l&&(l=null)}setup(){if(this.worldTransform=new Ammo.btTransform,typeof this.config.setupPhysicsWorld=="function"?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new te,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let t=0;t<500;t++)this.objectsToRemove[t]=null}this.collisionEvents=new Gs,this.factory=new Vs(this.scene),this.shapes=new Os(this.factory,(t,n)=>this.addExisting(t,n)),this.constraints=new Fs(this.worldTransform,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new Ws(this.scene,this.physicsWorld,{}))}updateDebugger(){this.scene!=="headless"&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){const t=this.gravity,{softBodies:n=!1}=this.config;let l;if(!n){const i=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(i),s=new Ammo.btDbvtBroadphase,o=new Ammo.btSequentialImpulseConstraintSolver;l=new Ammo.btDiscreteDynamicsWorld(e,s,o,i)}if(n){const i=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,e=new Ammo.btCollisionDispatcher(i),s=new Ammo.btDbvtBroadphase,o=new Ammo.btSequentialImpulseConstraintSolver,r=new Ammo.btDefaultSoftBodySolver;l=new Ammo.btSoftRigidDynamicsWorld(e,s,o,i,r)}return l.setGravity(new Ammo.btVector3(t.x,t.y,t.z)),l}createDebrisFromBreakableObject(t,n){this.scene!=="headless"&&(t.material=n.material,t.shape="hull",t.fragmentDepth=n.fragmentDepth+1,t.name=`${n.name}__DEBRIS_${t.id}`,this.scene.add(t),this.addExisting(t,{autoCenter:!0}),t.body.fractureImpulse=n.body.fractureImpulse,t.body.breakable=!1,setTimeout(()=>{t.body.breakable=!0},2500))}removeDebris(t){this.scene!=="headless"&&(this.scene.remove(t),this.destroy(t))}update(t){this.updatePhysics(t),this.detectCollisions()}updatePhysics(t){const n=t/1e3;this.physicsWorld.stepSimulation(n,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let l=0;l<this.rigidBodies.length;l++){const i=this.rigidBodies[l];i.body.impact=[];const s=i.body.ammo.getMotionState();if(s){if(s.getWorldTransform(this.worldTransform),i.body.didUpdate&&(i.body._emitUpdateEvents&&i.body.eventEmitter.emit("update"),i.body.didUpdate=!1),i.body.ammo.isKinematicObject()&&i.body.needUpdate)i.getWorldQuaternion(this.tmpQuaternion),i.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),s.setWorldTransform(this.worldTransform),i.body.needUpdate=!1;else if(!i.body.skipUpdate){if(!i.body.ammo.isStaticObject()){const o=this.worldTransform.getOrigin(),r=this.worldTransform.getRotation(),u=i.body.offset;if(i.body.ignoreScale)this.tmpVector3a.set(i.scale.x,i.scale.y,i.scale.z);else{const c=i.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(c.x(),c.y(),c.z())}this.tmpVector3.set(o.x()+u.x,o.y()+u.y,o.z()+u.z),this.tmpQuaternion.set(r.x(),r.y(),r.z(),r.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),i.parent?parseInt(jt)>=123?this.tmpMatrix4a.copy(i.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(i.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(i.position,i.quaternion,i.scale)}}}}}detectCollisions(){var i,e;const t=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);const n=this.physicsWorld.getDispatcher(),l=n.getNumManifolds();for(let s=0;s<l;s++){const o=n.getManifoldByIndexInternal(s),r=o.getNumContacts(),u=Ammo.castObject(o.getBody0(),Ammo.btRigidBody),c=Ammo.castObject(o.getBody1(),Ammo.btRigidBody),f=u.threeObject,h=c.threeObject;if(!f||!h||u.name===""&&c.name==="")continue;const a=(i=f.body)==null?void 0:i.checkCollisions,m=(e=h.body)==null?void 0:e.checkCollisions,d=f.body.breakable,p=h.body.breakable,x=f.body.fractureImpulse,w=h.body.fractureImpulse,T=a||m,M=d||p;if(typeof f.fragmentDepth>"u"&&(f.fragmentDepth=0),typeof h.fragmentDepth>"u"&&(h.fragmentDepth=0),!T&&!M)continue;let g=!1,y=0,S="start";for(let b=0;b<r;b++){const C=o.getContactPoint(b);if(C.getDistance()<=0){g=!0;const P=C.getAppliedImpulse(),R=C.get_m_positionWorldOnB(),L=C.get_m_normalWorldOnB();if(a||m){const V=[f.uuid,h.uuid].sort(),D=`${V[0]}__${V[1]}`;if(this.earlierDetectedCollisions.find(I=>I.combinedName===D)&&(S="collision"),!t.find(I=>I.combinedName===D)){t.push({combinedName:D,collision:!0});const I={x:R.x(),y:R.y(),z:R.z()},k={x:L.x(),y:L.y(),z:L.z()};f.body.impact.push({impulse:P,point:I,normal:k,name:h.name}),h.body.impact.push({impulse:P,point:I,normal:k,name:f.name}),this.collisionEvents.emit("collision",{bodies:[f,h],event:S})}}P>=y&&(y=P,(d||p)&&(this.impactPoint.set(R.x(),R.y(),R.z()),this.impactNormal.set(L.x(),L.y(),L.z())));break}}if(!g||!M)continue;const v=2;if(this.emptyV3.set(0,0,0),f.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:d,physicsBody:u},h.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:p,physicsBody:c},d&&y>x&&f.fragmentDepth<v){const b=this.convexBreaker.subdivideByImpact(f,this.impactPoint,this.impactNormal,1,2),C=b.length;for(let E=0;E<C;E++){const P=u.getLinearVelocity(),R=u.getAngularVelocity(),L=b[E];L.userData.ammoPhysicsData.velocity.set(P.x(),P.y(),P.z()),L.userData.ammoPhysicsData.angularVelocity.set(R.x(),R.y(),R.z()),this.createDebrisFromBreakableObject(L,f)}this.objectsToRemove[this.numObjectsToRemove++]=f}if(p&&y>w&&h.fragmentDepth<v){const b=this.convexBreaker.subdivideByImpact(h,this.impactPoint,this.impactNormal,1,2),C=b.length;for(let E=0;E<C;E++){const P=c.getLinearVelocity(),R=c.getAngularVelocity(),L=b[E];L.userData.ammoPhysicsData.velocity.set(P.x(),P.y(),P.z()),L.userData.ammoPhysicsData.angularVelocity.set(R.x(),R.y(),R.z()),this.createDebrisFromBreakableObject(L,h)}this.objectsToRemove[this.numObjectsToRemove++]=h}}for(let s=0;s<this.numObjectsToRemove;s++)this.removeDebris(this.objectsToRemove[s]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(s=>{const{combinedName:o}=s;if(!t.find(r=>r.combinedName===o)){const r=o.split("__"),u=this.rigidBodies.find(h=>h.uuid===r[0]),c=this.rigidBodies.find(h=>h.uuid===r[1]);u&&c&&this.collisionEvents.emit("collision",{bodies:[u,c],event:"end"})}}),this.earlierDetectedCollisions=[...t]}setGravity(t=0,n=-9.8,l=0){this.tmpBtVector3.setValue(t,n,l),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(t=1)=>{this.debugDrawer.setDebugMode(t)},disable:()=>{this.debugDrawer.disable()}}}start(){if(typeof Ammo>"u"){ie("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(()=>{this.setup()}):this.setup()}get add(){return{collider:(t,n,l)=>this.collisionEvents.addCollider(t,n,l),constraints:this.constraints.addConstraints,existing:(t,n)=>this.addExisting(t,n),plane:(t={},n={})=>this.shapes.addPlane(t,n),sphere:(t={},n={})=>this.shapes.addSphere(t,n),ground:(t={},n={})=>this.shapes.addGround(t,n),box:(t={},n={})=>this.shapes.addBox(t,n),capsule:(t={},n={})=>this.shapes.addCapsule(t,n),cylinder:(t={},n={})=>this.shapes.addCylinder(t,n),cone:(t={},n={})=>this.shapes.addCone(t,n),torus:(t={},n={})=>this.shapes.addTorus(t,n),extrude:(t,n={})=>this.shapes.addExtrude(t,n),raycaster:(t="closest")=>t==="closest"?new en(this):new tn(this)}}prepareThreeObjectForCollisionShape(t,n={}){var r,u;const{autoCenter:l=!1}=n,i={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6};let e="unknown";const s=((r=t.geometry)==null?void 0:r.type)||"unknown";/box/i.test(s)?e="box":/cone/i.test(s)?e="cone":/cylinder/i.test(s)?e="cylinder":/extrude/i.test(s)?e="extrude":/plane/i.test(s)?e="plane":/sphere/i.test(s)?e="sphere":/torus/i.test(s)&&(e="torus");let o={...i,...(u=t==null?void 0:t.geometry)==null?void 0:u.parameters};if(n.shape?(o={...i,...n},e=n.shape):t.shape&&(e=t.shape),Object.keys(o).forEach(c=>{typeof o[c]>"u"&&i[c]&&(o[c]=i[c])}),l){if(t.isMesh&&t.geometry)t.geometry.center();else if(t.isGroup){const c=new tt,f=new B;c.setFromObject(t).getCenter(f),t.traverse(h=>{h.isMesh&&h.geometry.translate(-f.x,-f.y,-f.z)})}}return e==="cylinder"&&(o.radius=n.radius||o.radiusTop),e==="extrude"&&(e="hacd"),(e==="mesh"||e==="convex")&&(e="convexMesh"),e==="concave"&&(e="concaveMesh"),e==="unknown"&&(ie(`Shape for ${t==null?void 0:t.name} not recognized! Will fallback to box.`),e="box"),{shape:e,params:o,object:t}}createCollisionShape(t,n,l){const i=l!=null&&l.quaternion?l==null?void 0:l.quaternion:new le(0,0,0,1),{axis:e="y"}=n,s=new Ammo.btVector3,o=l==null?void 0:l.geometry;l&&(o!=null&&o.isGeometry)&&(l.geometry=new De().fromGeometry(o));const r=m=>{const d=new Q().elements,p=[],x=[],w=[];return Us(m,{},(T,M,g)=>{p.push(T),x.push(M),w.push(g)}),{vertices:p,matrices:x,indexes:w,matrixWorld:d}};let u={};this.complexShapes.indexOf(t)!==-1&&(u=r(l));let c;switch(t){case"box":s.setValue(n.width/2,n.height/2,n.depth/2),c=new Ammo.btBoxShape(s);break;case"sphere":c=new Ammo.btSphereShape(n.radius);break;case"cylinder":switch(e){case"y":s.setValue(n.radius,n.height/2,n.radius),c=new Ammo.btCylinderShape(s);break;case"x":s.setValue(n.height/2,n.radius,n.radius),c=new Ammo.btCylinderShapeX(s);break;case"z":s.setValue(n.radius,n.radius,n.height/2),c=new Ammo.btCylinderShapeZ(s);break}break;case"cone":switch(e){case"y":c=new Ammo.btConeShape(n.radius,n.height);break;case"x":c=new Ammo.btConeShapeX(n.radius,n.height);break;case"z":c=new Ammo.btConeShapeZ(n.radius,n.height);break}break;case"capsule":switch(e){case"y":c=new Ammo.btCapsuleShape(n.radius,n.height);break;case"x":c=new Ammo.btCapsuleShapeX(n.radius,n.height);break;case"z":c=new Ammo.btCapsuleShapeZ(n.radius,n.height);break}break;case"torus":c=zs(n,i);break;case"plane":c=je(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...n,concave:!1});break;case"hull":c=Ns(u.vertices,u.matrices,u.matrixWorld,n);break;case"hacd":c=Hs(u.vertices,u.matrices,u.indexes,u.matrixWorld,n);break;case"vhacd":c=_s(u.vertices,u.matrices,u.indexes,u.matrixWorld,n);break;case"convexMesh":c=je(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...n,concave:!1});break;case"concaveMesh":c=je(u.vertices,u.matrices,u.indexes,u.matrixWorld,{...n,concave:!0});break}Ammo.destroy(s);const{x:f,y:h,z:a}=n;return(f||h||a)&&(c._compoundOffset={x:f||0,y:h||0,z:a||0}),Array.isArray(c)&&(c=this.mergeCollisionShapesToCompoundShape(c)),c}mergeCollisionShapesToCompoundShape(t){const n=new Ammo.btCompoundShape;return t.forEach(l=>{const{_childOffset:i,_compoundOffset:e}=l;if(i){const{pos:s,quat:o,scale:r,margin:u}=i,c=this.applyPosQuatScaleMargin(l,s,o,r,u);n.addChildShape(c,l)}else if(e){const s=new Ammo.btTransform;s.setIdentity(),s.setOrigin(new Ammo.btVector3(e.x,e.y,e.z)),n.addChildShape(s,l)}else{const s=new Ammo.btTransform;s.setIdentity(),n.addChildShape(s,l)}}),n}addExisting(t,n={}){const{hasBody:l}=t;if(l){ie(`Object "${t.name}" already has a physical body!`);return}const i=new B,e=new le,s=new B;t.getWorldPosition(i),t.getWorldQuaternion(e),t.getWorldScale(s);const o=(n.collisionFlags||0).toString(2).slice(-1)==="1",r=(n.collisionFlags||0).toString(2).slice(-2,-1)==="1",{shape:u="unknown",compound:c=[],mass:f=o||r?0:1,collisionFlags:h=0,collisionGroup:a=1,collisionMask:m=-1,offset:d=void 0,breakable:p=!1,addChildren:x=!0,margin:w=.01,ignoreScale:T=!1,fractureImpulse:M=1}=n;if(T&&s.set(1,1,1),c.length>=1){const b=c.map(R=>this.createCollisionShape(R.shape,R)),C=this.mergeCollisionShapesToCompoundShape(b),E=this.applyPosQuatScaleMargin(C,i,e,s,w),P=this.collisionShapeToRigidBody(C,E,f,r);this.addRigidBodyToWorld(t,P,h,a,m,d),t.body.breakable=p,t.body.fractureImpulse=M,t.body.ignoreScale=T;return}const g=[];if(u!=="unknown"||t.isMesh){const b=this.prepareThreeObjectForCollisionShape(t,n),C=this.createCollisionShape(b.shape,b.params,b.object);g.push(C)}if(u==="unknown"&&x&&t.children.length>=1&&t.children.forEach(b=>{if(b.isMesh){const C=this.prepareThreeObjectForCollisionShape(b),E=this.createCollisionShape(C.shape,C.params,C.object);E._childOffset={pos:b.position.clone(),quat:b.quaternion.clone(),scale:b.scale.clone(),margin:w},g.push(E)}}),g.length===0){const b=this.prepareThreeObjectForCollisionShape(t,n),C=this.createCollisionShape(b.shape,b.params,b.object);g.push(C)}const y=g.length===1?g[0]:this.mergeCollisionShapesToCompoundShape(g),S=this.applyPosQuatScaleMargin(y,i,e,s,w),v=this.collisionShapeToRigidBody(y,S,f,r);this.addRigidBodyToWorld(t,v,h,a,m,d),t.body.breakable=p,t.body.fractureImpulse=M,t.body.ignoreScale=T}addRigidBodyToWorld(t,n,l,i,e,s){this.rigidBodies.push(t),this.physicsWorld.addRigidBody(n,i,e);const o=Object.values(n)[0];t.name||(t.name=`object-${t.id}`),n.name=t.name,t.body=new ks(this,n),t.hasBody=!0,t.ptr=o,n.threeObject=t,s&&(t.body.offset={x:0,y:0,z:0,...s}),t.body.setCollisionFlags(l)}applyPosQuatScaleMargin(t,n=new B,l=new le,i=new B,e=.01){t.setMargin(e);const s=new Ammo.btQuaternion(0,0,0,1);s.setValue(l.x,l.y,l.z,l.w);const o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue(n.x,n.y,n.z),o.setRotation(s),Ammo.destroy(s);const r=new Ammo.btVector3(i.x,i.y,i.z);return t.setLocalScaling(r),Ammo.destroy(r),o}collisionShapeToRigidBody(t,n,l,i){const e=new Ammo.btDefaultMotionState(n),s=new Ammo.btVector3(0,0,0);l>0&&t.calculateLocalInertia(l,s);const o=new Ammo.btRigidBodyConstructionInfo(l,e,t,s),r=new Ammo.btRigidBody(o);return(l>0||i)&&r.setActivationState(4),r}}const ei="0.25.4",ti=`Powered by enable3d v${ei}`;console.log(`%c %c %c %c %c ${ti} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */document.createElement("canvas");new Xn;new we;new we;new we;var ni={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(A,t){(function(l,i){A.exports=i()})(xe,function(){return function(n){var l={};function i(e){if(l[e])return l[e].exports;var s=l[e]={i:e,l:!1,exports:{}};return n[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=n,i.c=l,i.d=function(e,s,o){i.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:o})},i.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,s){if(s&1&&(e=i(e)),s&8||s&4&&typeof e=="object"&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),s&2&&typeof e!="string")for(var r in e)i.d(o,r,(function(u){return e[u]}).bind(null,r));return o},i.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(s,"a",s),s},i.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},i.p="",i(i.s=20)}([function(n,l){var i={};n.exports=i,function(){i._baseDelta=1e3/60,i._nextId=0,i._seed=0,i._nowStartTime=+new Date,i._warnedOnce={},i._decomp=null,i.extend=function(s,o){var r,u;typeof o=="boolean"?(r=2,u=o):(r=1,u=!0);for(var c=r;c<arguments.length;c++){var f=arguments[c];if(f)for(var h in f)u&&f[h]&&f[h].constructor===Object&&(!s[h]||s[h].constructor===Object)?(s[h]=s[h]||{},i.extend(s[h],u,f[h])):s[h]=f[h]}return s},i.clone=function(s,o){return i.extend({},o,s)},i.keys=function(s){if(Object.keys)return Object.keys(s);var o=[];for(var r in s)o.push(r);return o},i.values=function(s){var o=[];if(Object.keys){for(var r=Object.keys(s),u=0;u<r.length;u++)o.push(s[r[u]]);return o}for(var c in s)o.push(s[c]);return o},i.get=function(s,o,r,u){o=o.split(".").slice(r,u);for(var c=0;c<o.length;c+=1)s=s[o[c]];return s},i.set=function(s,o,r,u,c){var f=o.split(".").slice(u,c);return i.get(s,o,0,-1)[f[f.length-1]]=r,r},i.shuffle=function(s){for(var o=s.length-1;o>0;o--){var r=Math.floor(i.random()*(o+1)),u=s[o];s[o]=s[r],s[r]=u}return s},i.choose=function(s){return s[Math.floor(i.random()*s.length)]},i.isElement=function(s){return typeof HTMLElement<"u"?s instanceof HTMLElement:!!(s&&s.nodeType&&s.nodeName)},i.isArray=function(s){return Object.prototype.toString.call(s)==="[object Array]"},i.isFunction=function(s){return typeof s=="function"},i.isPlainObject=function(s){return typeof s=="object"&&s.constructor===Object},i.isString=function(s){return toString.call(s)==="[object String]"},i.clamp=function(s,o,r){return s<o?o:s>r?r:s},i.sign=function(s){return s<0?-1:1},i.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-i._nowStartTime},i.random=function(s,o){return s=typeof s<"u"?s:0,o=typeof o<"u"?o:1,s+e()*(o-s)};var e=function(){return i._seed=(i._seed*9301+49297)%233280,i._seed/233280};i.colorToNumber=function(s){return s=s.replace("#",""),s.length==3&&(s=s.charAt(0)+s.charAt(0)+s.charAt(1)+s.charAt(1)+s.charAt(2)+s.charAt(2)),parseInt(s,16)},i.logLevel=1,i.log=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.info=function(){console&&i.logLevel>0&&i.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warn=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warnOnce=function(){var s=Array.prototype.slice.call(arguments).join(" ");i._warnedOnce[s]||(i.warn(s),i._warnedOnce[s]=!0)},i.deprecated=function(s,o,r){s[o]=i.chain(function(){i.warnOnce(" deprecated ",r)},s[o])},i.nextId=function(){return i._nextId++},i.indexOf=function(s,o){if(s.indexOf)return s.indexOf(o);for(var r=0;r<s.length;r++)if(s[r]===o)return r;return-1},i.map=function(s,o){if(s.map)return s.map(o);for(var r=[],u=0;u<s.length;u+=1)r.push(o(s[u]));return r},i.topologicalSort=function(s){var o=[],r=[],u=[];for(var c in s)!r[c]&&!u[c]&&i._topologicalSort(c,r,u,s,o);return o},i._topologicalSort=function(s,o,r,u,c){var f=u[s]||[];r[s]=!0;for(var h=0;h<f.length;h+=1){var a=f[h];r[a]||o[a]||i._topologicalSort(a,o,r,u,c)}r[s]=!1,o[s]=!0,c.push(s)},i.chain=function(){for(var s=[],o=0;o<arguments.length;o+=1){var r=arguments[o];r._chained?s.push.apply(s,r._chained):s.push(r)}var u=function(){for(var c,f=new Array(arguments.length),h=0,a=arguments.length;h<a;h++)f[h]=arguments[h];for(h=0;h<s.length;h+=1){var m=s[h].apply(c,f);typeof m<"u"&&(c=m)}return c};return u._chained=s,u},i.chainPathBefore=function(s,o,r){return i.set(s,o,i.chain(r,i.get(s,o)))},i.chainPathAfter=function(s,o,r){return i.set(s,o,i.chain(i.get(s,o),r))},i.setDecomp=function(s){i._decomp=s},i.getDecomp=function(){var s=i._decomp;try{!s&&typeof window<"u"&&(s=window.decomp),!s&&typeof xe<"u"&&(s=xe.decomp)}catch{s=null}return s}}()},function(n,l){var i={};n.exports=i,function(){i.create=function(e){var s={min:{x:0,y:0},max:{x:0,y:0}};return e&&i.update(s,e),s},i.update=function(e,s,o){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var r=0;r<s.length;r++){var u=s[r];u.x>e.max.x&&(e.max.x=u.x),u.x<e.min.x&&(e.min.x=u.x),u.y>e.max.y&&(e.max.y=u.y),u.y<e.min.y&&(e.min.y=u.y)}o&&(o.x>0?e.max.x+=o.x:e.min.x+=o.x,o.y>0?e.max.y+=o.y:e.min.y+=o.y)},i.contains=function(e,s){return s.x>=e.min.x&&s.x<=e.max.x&&s.y>=e.min.y&&s.y<=e.max.y},i.overlaps=function(e,s){return e.min.x<=s.max.x&&e.max.x>=s.min.x&&e.max.y>=s.min.y&&e.min.y<=s.max.y},i.translate=function(e,s){e.min.x+=s.x,e.max.x+=s.x,e.min.y+=s.y,e.max.y+=s.y},i.shift=function(e,s){var o=e.max.x-e.min.x,r=e.max.y-e.min.y;e.min.x=s.x,e.max.x=s.x+o,e.min.y=s.y,e.max.y=s.y+r}}()},function(n,l){var i={};n.exports=i,function(){i.create=function(e,s){return{x:e||0,y:s||0}},i.clone=function(e){return{x:e.x,y:e.y}},i.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},i.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},i.rotate=function(e,s,o){var r=Math.cos(s),u=Math.sin(s);o||(o={});var c=e.x*r-e.y*u;return o.y=e.x*u+e.y*r,o.x=c,o},i.rotateAbout=function(e,s,o,r){var u=Math.cos(s),c=Math.sin(s);r||(r={});var f=o.x+((e.x-o.x)*u-(e.y-o.y)*c);return r.y=o.y+((e.x-o.x)*c+(e.y-o.y)*u),r.x=f,r},i.normalise=function(e){var s=i.magnitude(e);return s===0?{x:0,y:0}:{x:e.x/s,y:e.y/s}},i.dot=function(e,s){return e.x*s.x+e.y*s.y},i.cross=function(e,s){return e.x*s.y-e.y*s.x},i.cross3=function(e,s,o){return(s.x-e.x)*(o.y-e.y)-(s.y-e.y)*(o.x-e.x)},i.add=function(e,s,o){return o||(o={}),o.x=e.x+s.x,o.y=e.y+s.y,o},i.sub=function(e,s,o){return o||(o={}),o.x=e.x-s.x,o.y=e.y-s.y,o},i.mult=function(e,s){return{x:e.x*s,y:e.y*s}},i.div=function(e,s){return{x:e.x/s,y:e.y/s}},i.perp=function(e,s){return s=s===!0?-1:1,{x:s*-e.y,y:s*e.x}},i.neg=function(e){return{x:-e.x,y:-e.y}},i.angle=function(e,s){return Math.atan2(s.y-e.y,s.x-e.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]}()},function(n,l,i){var e={};n.exports=e;var s=i(2),o=i(0);(function(){e.create=function(r,u){for(var c=[],f=0;f<r.length;f++){var h=r[f],a={x:h.x,y:h.y,index:f,body:u,isInternal:!1};c.push(a)}return c},e.fromPath=function(r,u){var c=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,f=[];return r.replace(c,function(h,a,m){f.push({x:parseFloat(a),y:parseFloat(m)})}),e.create(f,u)},e.centre=function(r){for(var u=e.area(r,!0),c={x:0,y:0},f,h,a,m=0;m<r.length;m++)a=(m+1)%r.length,f=s.cross(r[m],r[a]),h=s.mult(s.add(r[m],r[a]),f),c=s.add(c,h);return s.div(c,6*u)},e.mean=function(r){for(var u={x:0,y:0},c=0;c<r.length;c++)u.x+=r[c].x,u.y+=r[c].y;return s.div(u,r.length)},e.area=function(r,u){for(var c=0,f=r.length-1,h=0;h<r.length;h++)c+=(r[f].x-r[h].x)*(r[f].y+r[h].y),f=h;return u?c/2:Math.abs(c)/2},e.inertia=function(r,u){for(var c=0,f=0,h=r,a,m,d=0;d<h.length;d++)m=(d+1)%h.length,a=Math.abs(s.cross(h[m],h[d])),c+=a*(s.dot(h[m],h[m])+s.dot(h[m],h[d])+s.dot(h[d],h[d])),f+=a;return u/6*(c/f)},e.translate=function(r,u,c){c=typeof c<"u"?c:1;var f=r.length,h=u.x*c,a=u.y*c,m;for(m=0;m<f;m++)r[m].x+=h,r[m].y+=a;return r},e.rotate=function(r,u,c){if(u!==0){var f=Math.cos(u),h=Math.sin(u),a=c.x,m=c.y,d=r.length,p,x,w,T;for(T=0;T<d;T++)p=r[T],x=p.x-a,w=p.y-m,p.x=a+(x*f-w*h),p.y=m+(x*h+w*f);return r}},e.contains=function(r,u){for(var c=u.x,f=u.y,h=r.length,a=r[h-1],m,d=0;d<h;d++){if(m=r[d],(c-a.x)*(m.y-a.y)+(f-a.y)*(a.x-m.x)>0)return!1;a=m}return!0},e.scale=function(r,u,c,f){if(u===1&&c===1)return r;f=f||e.centre(r);for(var h,a,m=0;m<r.length;m++)h=r[m],a=s.sub(h,f),r[m].x=f.x+a.x*u,r[m].y=f.y+a.y*c;return r},e.chamfer=function(r,u,c,f,h){typeof u=="number"?u=[u]:u=u||[8],c=typeof c<"u"?c:-1,f=f||2,h=h||14;for(var a=[],m=0;m<r.length;m++){var d=r[m-1>=0?m-1:r.length-1],p=r[m],x=r[(m+1)%r.length],w=u[m<u.length?m:u.length-1];if(w===0){a.push(p);continue}var T=s.normalise({x:p.y-d.y,y:d.x-p.x}),M=s.normalise({x:x.y-p.y,y:p.x-x.x}),g=Math.sqrt(2*Math.pow(w,2)),y=s.mult(o.clone(T),w),S=s.normalise(s.mult(s.add(T,M),.5)),v=s.sub(p,s.mult(S,g)),b=c;c===-1&&(b=Math.pow(w,.32)*1.75),b=o.clamp(b,f,h),b%2===1&&(b+=1);for(var C=Math.acos(s.dot(T,M)),E=C/b,P=0;P<b;P++)a.push(s.add(s.rotate(y,E*P),v))}return a},e.clockwiseSort=function(r){var u=e.mean(r);return r.sort(function(c,f){return s.angle(u,c)-s.angle(u,f)}),r},e.isConvex=function(r){var u=0,c=r.length,f,h,a,m;if(c<3)return null;for(f=0;f<c;f++)if(h=(f+1)%c,a=(f+2)%c,m=(r[h].x-r[f].x)*(r[a].y-r[h].y),m-=(r[h].y-r[f].y)*(r[a].x-r[h].x),m<0?u|=1:m>0&&(u|=2),u===3)return!1;return u!==0?!0:null},e.hull=function(r){var u=[],c=[],f,h;for(r=r.slice(0),r.sort(function(a,m){var d=a.x-m.x;return d!==0?d:a.y-m.y}),h=0;h<r.length;h+=1){for(f=r[h];c.length>=2&&s.cross3(c[c.length-2],c[c.length-1],f)<=0;)c.pop();c.push(f)}for(h=r.length-1;h>=0;h-=1){for(f=r[h];u.length>=2&&s.cross3(u[u.length-2],u[u.length-1],f)<=0;)u.pop();u.push(f)}return u.pop(),c.pop(),u.concat(c)}})()},function(n,l,i){var e={};n.exports=e;var s=i(3),o=i(2),r=i(7),u=i(0),c=i(1),f=i(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(a){var m={id:u.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:s.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},d=u.extend(m,a);return h(d,a),d},e.nextGroup=function(a){return a?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var h=function(a,m){m=m||{},e.set(a,{bounds:a.bounds||c.create(a.vertices),positionPrev:a.positionPrev||o.clone(a.position),anglePrev:a.anglePrev||a.angle,vertices:a.vertices,parts:a.parts||[a],isStatic:a.isStatic,isSleeping:a.isSleeping,parent:a.parent||a}),s.rotate(a.vertices,a.angle,a.position),f.rotate(a.axes,a.angle),c.update(a.bounds,a.vertices,a.velocity),e.set(a,{axes:m.axes||a.axes,area:m.area||a.area,mass:m.mass||a.mass,inertia:m.inertia||a.inertia});var d=a.isStatic?"#14151f":u.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),p=a.isStatic?"#555":"#ccc",x=a.isStatic&&a.render.fillStyle===null?1:0;a.render.fillStyle=a.render.fillStyle||d,a.render.strokeStyle=a.render.strokeStyle||p,a.render.lineWidth=a.render.lineWidth||x,a.render.sprite.xOffset+=-(a.bounds.min.x-a.position.x)/(a.bounds.max.x-a.bounds.min.x),a.render.sprite.yOffset+=-(a.bounds.min.y-a.position.y)/(a.bounds.max.y-a.bounds.min.y)};e.set=function(a,m,d){var p;typeof m=="string"&&(p=m,m={},m[p]=d);for(p in m)if(Object.prototype.hasOwnProperty.call(m,p))switch(d=m[p],p){case"isStatic":e.setStatic(a,d);break;case"isSleeping":r.set(a,d);break;case"mass":e.setMass(a,d);break;case"density":e.setDensity(a,d);break;case"inertia":e.setInertia(a,d);break;case"vertices":e.setVertices(a,d);break;case"position":e.setPosition(a,d);break;case"angle":e.setAngle(a,d);break;case"velocity":e.setVelocity(a,d);break;case"angularVelocity":e.setAngularVelocity(a,d);break;case"speed":e.setSpeed(a,d);break;case"angularSpeed":e.setAngularSpeed(a,d);break;case"parts":e.setParts(a,d);break;case"centre":e.setCentre(a,d);break;default:a[p]=d}},e.setStatic=function(a,m){for(var d=0;d<a.parts.length;d++){var p=a.parts[d];m?(p.isStatic||(p._original={restitution:p.restitution,friction:p.friction,mass:p.mass,inertia:p.inertia,density:p.density,inverseMass:p.inverseMass,inverseInertia:p.inverseInertia}),p.restitution=0,p.friction=1,p.mass=p.inertia=p.density=1/0,p.inverseMass=p.inverseInertia=0,p.positionPrev.x=p.position.x,p.positionPrev.y=p.position.y,p.anglePrev=p.angle,p.angularVelocity=0,p.speed=0,p.angularSpeed=0,p.motion=0):p._original&&(p.restitution=p._original.restitution,p.friction=p._original.friction,p.mass=p._original.mass,p.inertia=p._original.inertia,p.density=p._original.density,p.inverseMass=p._original.inverseMass,p.inverseInertia=p._original.inverseInertia,p._original=null),p.isStatic=m}},e.setMass=function(a,m){var d=a.inertia/(a.mass/6);a.inertia=d*(m/6),a.inverseInertia=1/a.inertia,a.mass=m,a.inverseMass=1/a.mass,a.density=a.mass/a.area},e.setDensity=function(a,m){e.setMass(a,m*a.area),a.density=m},e.setInertia=function(a,m){a.inertia=m,a.inverseInertia=1/a.inertia},e.setVertices=function(a,m){m[0].body===a?a.vertices=m:a.vertices=s.create(m,a),a.axes=f.fromVertices(a.vertices),a.area=s.area(a.vertices),e.setMass(a,a.density*a.area);var d=s.centre(a.vertices);s.translate(a.vertices,d,-1),e.setInertia(a,e._inertiaScale*s.inertia(a.vertices,a.mass)),s.translate(a.vertices,a.position),c.update(a.bounds,a.vertices,a.velocity)},e.setParts=function(a,m,d){var p;for(m=m.slice(0),a.parts.length=0,a.parts.push(a),a.parent=a,p=0;p<m.length;p++){var x=m[p];x!==a&&(x.parent=a,a.parts.push(x))}if(a.parts.length!==1){if(d=typeof d<"u"?d:!0,d){var w=[];for(p=0;p<m.length;p++)w=w.concat(m[p].vertices);s.clockwiseSort(w);var T=s.hull(w),M=s.centre(T);e.setVertices(a,T),s.translate(a.vertices,M)}var g=e._totalProperties(a);a.area=g.area,a.parent=a,a.position.x=g.centre.x,a.position.y=g.centre.y,a.positionPrev.x=g.centre.x,a.positionPrev.y=g.centre.y,e.setMass(a,g.mass),e.setInertia(a,g.inertia),e.setPosition(a,g.centre)}},e.setCentre=function(a,m,d){d?(a.positionPrev.x+=m.x,a.positionPrev.y+=m.y,a.position.x+=m.x,a.position.y+=m.y):(a.positionPrev.x=m.x-(a.position.x-a.positionPrev.x),a.positionPrev.y=m.y-(a.position.y-a.positionPrev.y),a.position.x=m.x,a.position.y=m.y)},e.setPosition=function(a,m,d){var p=o.sub(m,a.position);d?(a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.velocity.x=p.x,a.velocity.y=p.y,a.speed=o.magnitude(p)):(a.positionPrev.x+=p.x,a.positionPrev.y+=p.y);for(var x=0;x<a.parts.length;x++){var w=a.parts[x];w.position.x+=p.x,w.position.y+=p.y,s.translate(w.vertices,p),c.update(w.bounds,w.vertices,a.velocity)}},e.setAngle=function(a,m,d){var p=m-a.angle;d?(a.anglePrev=a.angle,a.angularVelocity=p,a.angularSpeed=Math.abs(p)):a.anglePrev+=p;for(var x=0;x<a.parts.length;x++){var w=a.parts[x];w.angle+=p,s.rotate(w.vertices,p,a.position),f.rotate(w.axes,p),c.update(w.bounds,w.vertices,a.velocity),x>0&&o.rotateAbout(w.position,p,a.position,w.position)}},e.setVelocity=function(a,m){var d=a.deltaTime/e._baseDelta;a.positionPrev.x=a.position.x-m.x*d,a.positionPrev.y=a.position.y-m.y*d,a.velocity.x=(a.position.x-a.positionPrev.x)/d,a.velocity.y=(a.position.y-a.positionPrev.y)/d,a.speed=o.magnitude(a.velocity)},e.getVelocity=function(a){var m=e._baseDelta/a.deltaTime;return{x:(a.position.x-a.positionPrev.x)*m,y:(a.position.y-a.positionPrev.y)*m}},e.getSpeed=function(a){return o.magnitude(e.getVelocity(a))},e.setSpeed=function(a,m){e.setVelocity(a,o.mult(o.normalise(e.getVelocity(a)),m))},e.setAngularVelocity=function(a,m){var d=a.deltaTime/e._baseDelta;a.anglePrev=a.angle-m*d,a.angularVelocity=(a.angle-a.anglePrev)/d,a.angularSpeed=Math.abs(a.angularVelocity)},e.getAngularVelocity=function(a){return(a.angle-a.anglePrev)*e._baseDelta/a.deltaTime},e.getAngularSpeed=function(a){return Math.abs(e.getAngularVelocity(a))},e.setAngularSpeed=function(a,m){e.setAngularVelocity(a,u.sign(e.getAngularVelocity(a))*m)},e.translate=function(a,m,d){e.setPosition(a,o.add(a.position,m),d)},e.rotate=function(a,m,d,p){if(!d)e.setAngle(a,a.angle+m,p);else{var x=Math.cos(m),w=Math.sin(m),T=a.position.x-d.x,M=a.position.y-d.y;e.setPosition(a,{x:d.x+(T*x-M*w),y:d.y+(T*w+M*x)},p),e.setAngle(a,a.angle+m,p)}},e.scale=function(a,m,d,p){var x=0,w=0;p=p||a.position;for(var T=0;T<a.parts.length;T++){var M=a.parts[T];s.scale(M.vertices,m,d,p),M.axes=f.fromVertices(M.vertices),M.area=s.area(M.vertices),e.setMass(M,a.density*M.area),s.translate(M.vertices,{x:-M.position.x,y:-M.position.y}),e.setInertia(M,e._inertiaScale*s.inertia(M.vertices,M.mass)),s.translate(M.vertices,{x:M.position.x,y:M.position.y}),T>0&&(x+=M.area,w+=M.inertia),M.position.x=p.x+(M.position.x-p.x)*m,M.position.y=p.y+(M.position.y-p.y)*d,c.update(M.bounds,M.vertices,a.velocity)}a.parts.length>1&&(a.area=x,a.isStatic||(e.setMass(a,a.density*x),e.setInertia(a,w))),a.circleRadius&&(m===d?a.circleRadius*=m:a.circleRadius=null)},e.update=function(a,m){m=(typeof m<"u"?m:1e3/60)*a.timeScale;var d=m*m,p=e._timeCorrection?m/(a.deltaTime||m):1,x=1-a.frictionAir*(m/u._baseDelta),w=(a.position.x-a.positionPrev.x)*p,T=(a.position.y-a.positionPrev.y)*p;a.velocity.x=w*x+a.force.x/a.mass*d,a.velocity.y=T*x+a.force.y/a.mass*d,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.position.x+=a.velocity.x,a.position.y+=a.velocity.y,a.deltaTime=m,a.angularVelocity=(a.angle-a.anglePrev)*x*p+a.torque/a.inertia*d,a.anglePrev=a.angle,a.angle+=a.angularVelocity;for(var M=0;M<a.parts.length;M++){var g=a.parts[M];s.translate(g.vertices,a.velocity),M>0&&(g.position.x+=a.velocity.x,g.position.y+=a.velocity.y),a.angularVelocity!==0&&(s.rotate(g.vertices,a.angularVelocity,a.position),f.rotate(g.axes,a.angularVelocity),M>0&&o.rotateAbout(g.position,a.angularVelocity,a.position,g.position)),c.update(g.bounds,g.vertices,a.velocity)}},e.updateVelocities=function(a){var m=e._baseDelta/a.deltaTime,d=a.velocity;d.x=(a.position.x-a.positionPrev.x)*m,d.y=(a.position.y-a.positionPrev.y)*m,a.speed=Math.sqrt(d.x*d.x+d.y*d.y),a.angularVelocity=(a.angle-a.anglePrev)*m,a.angularSpeed=Math.abs(a.angularVelocity)},e.applyForce=function(a,m,d){var p={x:m.x-a.position.x,y:m.y-a.position.y};a.force.x+=d.x,a.force.y+=d.y,a.torque+=p.x*d.y-p.y*d.x},e._totalProperties=function(a){for(var m={mass:0,area:0,inertia:0,centre:{x:0,y:0}},d=a.parts.length===1?0:1;d<a.parts.length;d++){var p=a.parts[d],x=p.mass!==1/0?p.mass:1;m.mass+=x,m.area+=p.area,m.inertia+=p.inertia,m.centre=o.add(m.centre,o.mult(p.position,x))}return m.centre=o.div(m.centre,m.mass),m}})()},function(n,l,i){var e={};n.exports=e;var s=i(0);(function(){e.on=function(o,r,u){for(var c=r.split(" "),f,h=0;h<c.length;h++)f=c[h],o.events=o.events||{},o.events[f]=o.events[f]||[],o.events[f].push(u);return u},e.off=function(o,r,u){if(!r){o.events={};return}typeof r=="function"&&(u=r,r=s.keys(o.events).join(" "));for(var c=r.split(" "),f=0;f<c.length;f++){var h=o.events[c[f]],a=[];if(u&&h)for(var m=0;m<h.length;m++)h[m]!==u&&a.push(h[m]);o.events[c[f]]=a}},e.trigger=function(o,r,u){var c,f,h,a,m=o.events;if(m&&s.keys(m).length>0){u||(u={}),c=r.split(" ");for(var d=0;d<c.length;d++)if(f=c[d],h=m[f],h){a=s.clone(u,!1),a.name=f,a.source=o;for(var p=0;p<h.length;p++)h[p].apply(o,[a])}}}})()},function(n,l,i){var e={};n.exports=e;var s=i(5),o=i(0),r=i(1),u=i(4);(function(){e.create=function(c){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},c)},e.setModified=function(c,f,h,a){if(c.isModified=f,f&&c.cache&&(c.cache.allBodies=null,c.cache.allConstraints=null,c.cache.allComposites=null),h&&c.parent&&e.setModified(c.parent,f,h,a),a)for(var m=0;m<c.composites.length;m++){var d=c.composites[m];e.setModified(d,f,h,a)}},e.add=function(c,f){var h=[].concat(f);s.trigger(c,"beforeAdd",{object:f});for(var a=0;a<h.length;a++){var m=h[a];switch(m.type){case"body":if(m.parent!==m){o.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(c,m);break;case"constraint":e.addConstraint(c,m);break;case"composite":e.addComposite(c,m);break;case"mouseConstraint":e.addConstraint(c,m.constraint);break}}return s.trigger(c,"afterAdd",{object:f}),c},e.remove=function(c,f,h){var a=[].concat(f);s.trigger(c,"beforeRemove",{object:f});for(var m=0;m<a.length;m++){var d=a[m];switch(d.type){case"body":e.removeBody(c,d,h);break;case"constraint":e.removeConstraint(c,d,h);break;case"composite":e.removeComposite(c,d,h);break;case"mouseConstraint":e.removeConstraint(c,d.constraint);break}}return s.trigger(c,"afterRemove",{object:f}),c},e.addComposite=function(c,f){return c.composites.push(f),f.parent=c,e.setModified(c,!0,!0,!1),c},e.removeComposite=function(c,f,h){var a=o.indexOf(c.composites,f);if(a!==-1){var m=e.allBodies(f);e.removeCompositeAt(c,a);for(var d=0;d<m.length;d++)m[d].sleepCounter=0}if(h)for(var d=0;d<c.composites.length;d++)e.removeComposite(c.composites[d],f,!0);return c},e.removeCompositeAt=function(c,f){return c.composites.splice(f,1),e.setModified(c,!0,!0,!1),c},e.addBody=function(c,f){return c.bodies.push(f),e.setModified(c,!0,!0,!1),c},e.removeBody=function(c,f,h){var a=o.indexOf(c.bodies,f);if(a!==-1&&(e.removeBodyAt(c,a),f.sleepCounter=0),h)for(var m=0;m<c.composites.length;m++)e.removeBody(c.composites[m],f,!0);return c},e.removeBodyAt=function(c,f){return c.bodies.splice(f,1),e.setModified(c,!0,!0,!1),c},e.addConstraint=function(c,f){return c.constraints.push(f),e.setModified(c,!0,!0,!1),c},e.removeConstraint=function(c,f,h){var a=o.indexOf(c.constraints,f);if(a!==-1&&e.removeConstraintAt(c,a),h)for(var m=0;m<c.composites.length;m++)e.removeConstraint(c.composites[m],f,!0);return c},e.removeConstraintAt=function(c,f){return c.constraints.splice(f,1),e.setModified(c,!0,!0,!1),c},e.clear=function(c,f,h){if(h)for(var a=0;a<c.composites.length;a++)e.clear(c.composites[a],f,!0);return f?c.bodies=c.bodies.filter(function(m){return m.isStatic}):c.bodies.length=0,c.constraints.length=0,c.composites.length=0,e.setModified(c,!0,!0,!1),c},e.allBodies=function(c){if(c.cache&&c.cache.allBodies)return c.cache.allBodies;for(var f=[].concat(c.bodies),h=0;h<c.composites.length;h++)f=f.concat(e.allBodies(c.composites[h]));return c.cache&&(c.cache.allBodies=f),f},e.allConstraints=function(c){if(c.cache&&c.cache.allConstraints)return c.cache.allConstraints;for(var f=[].concat(c.constraints),h=0;h<c.composites.length;h++)f=f.concat(e.allConstraints(c.composites[h]));return c.cache&&(c.cache.allConstraints=f),f},e.allComposites=function(c){if(c.cache&&c.cache.allComposites)return c.cache.allComposites;for(var f=[].concat(c.composites),h=0;h<c.composites.length;h++)f=f.concat(e.allComposites(c.composites[h]));return c.cache&&(c.cache.allComposites=f),f},e.get=function(c,f,h){var a,m;switch(h){case"body":a=e.allBodies(c);break;case"constraint":a=e.allConstraints(c);break;case"composite":a=e.allComposites(c).concat(c);break}return a?(m=a.filter(function(d){return d.id.toString()===f.toString()}),m.length===0?null:m[0]):null},e.move=function(c,f,h){return e.remove(c,f),e.add(h,f),c},e.rebase=function(c){for(var f=e.allBodies(c).concat(e.allConstraints(c)).concat(e.allComposites(c)),h=0;h<f.length;h++)f[h].id=o.nextId();return c},e.translate=function(c,f,h){for(var a=h?e.allBodies(c):c.bodies,m=0;m<a.length;m++)u.translate(a[m],f);return c},e.rotate=function(c,f,h,a){for(var m=Math.cos(f),d=Math.sin(f),p=a?e.allBodies(c):c.bodies,x=0;x<p.length;x++){var w=p[x],T=w.position.x-h.x,M=w.position.y-h.y;u.setPosition(w,{x:h.x+(T*m-M*d),y:h.y+(T*d+M*m)}),u.rotate(w,f)}return c},e.scale=function(c,f,h,a,m){for(var d=m?e.allBodies(c):c.bodies,p=0;p<d.length;p++){var x=d[p],w=x.position.x-a.x,T=x.position.y-a.y;u.setPosition(x,{x:a.x+w*f,y:a.y+T*h}),u.scale(x,f,h)}return c},e.bounds=function(c){for(var f=e.allBodies(c),h=[],a=0;a<f.length;a+=1){var m=f[a];h.push(m.bounds.min,m.bounds.max)}return r.create(h)}})()},function(n,l,i){var e={};n.exports=e;var s=i(4),o=i(5),r=i(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(u,c){for(var f=c/r._baseDelta,h=e._motionSleepThreshold,a=0;a<u.length;a++){var m=u[a],d=s.getSpeed(m),p=s.getAngularSpeed(m),x=d*d+p*p;if(m.force.x!==0||m.force.y!==0){e.set(m,!1);continue}var w=Math.min(m.motion,x),T=Math.max(m.motion,x);m.motion=e._minBias*w+(1-e._minBias)*T,m.sleepThreshold>0&&m.motion<h?(m.sleepCounter+=1,m.sleepCounter>=m.sleepThreshold/f&&e.set(m,!0)):m.sleepCounter>0&&(m.sleepCounter-=1)}},e.afterCollisions=function(u){for(var c=e._motionSleepThreshold,f=0;f<u.length;f++){var h=u[f];if(h.isActive){var a=h.collision,m=a.bodyA.parent,d=a.bodyB.parent;if(!(m.isSleeping&&d.isSleeping||m.isStatic||d.isStatic)&&(m.isSleeping||d.isSleeping)){var p=m.isSleeping&&!m.isStatic?m:d,x=p===m?d:m;!p.isStatic&&x.motion>c&&e.set(p,!1)}}}},e.set=function(u,c){var f=u.isSleeping;c?(u.isSleeping=!0,u.sleepCounter=u.sleepThreshold,u.positionImpulse.x=0,u.positionImpulse.y=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.speed=0,u.angularSpeed=0,u.motion=0,f||o.trigger(u,"sleepStart")):(u.isSleeping=!1,u.sleepCounter=0,f&&o.trigger(u,"sleepEnd"))}})()},function(n,l,i){var e={};n.exports=e;var s=i(3),o=i(9);(function(){var r=[],u={overlap:0,axis:null},c={overlap:0,axis:null};e.create=function(f,h){return{pair:null,collided:!1,bodyA:f,bodyB:h,parentA:f.parent,parentB:h.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},e.collides=function(f,h,a){if(e._overlapAxes(u,f.vertices,h.vertices,f.axes),u.overlap<=0||(e._overlapAxes(c,h.vertices,f.vertices,h.axes),c.overlap<=0))return null;var m=a&&a.table[o.id(f,h)],d;m?d=m.collision:(d=e.create(f,h),d.collided=!0,d.bodyA=f.id<h.id?f:h,d.bodyB=f.id<h.id?h:f,d.parentA=d.bodyA.parent,d.parentB=d.bodyB.parent),f=d.bodyA,h=d.bodyB;var p;u.overlap<c.overlap?p=u:p=c;var x=d.normal,w=d.tangent,T=d.penetration,M=d.supports,g=p.overlap,y=p.axis,S=y.x,v=y.y,b=h.position.x-f.position.x,C=h.position.y-f.position.y;S*b+v*C>=0&&(S=-S,v=-v),x.x=S,x.y=v,w.x=-v,w.y=S,T.x=S*g,T.y=v*g,d.depth=g;var E=e._findSupports(f,h,x,1),P=0;if(s.contains(f.vertices,E[0])&&(M[P++]=E[0]),s.contains(f.vertices,E[1])&&(M[P++]=E[1]),P<2){var R=e._findSupports(h,f,x,-1);s.contains(h.vertices,R[0])&&(M[P++]=R[0]),P<2&&s.contains(h.vertices,R[1])&&(M[P++]=R[1])}return P===0&&(M[P++]=E[0]),d.supportCount=P,d},e._overlapAxes=function(f,h,a,m){var d=h.length,p=a.length,x=h[0].x,w=h[0].y,T=a[0].x,M=a[0].y,g=m.length,y=Number.MAX_VALUE,S=0,v,b,C,E,P,R;for(P=0;P<g;P++){var L=m[P],V=L.x,D=L.y,I=x*V+w*D,k=T*V+M*D,F=I,H=k;for(R=1;R<d;R+=1)E=h[R].x*V+h[R].y*D,E>F?F=E:E<I&&(I=E);for(R=1;R<p;R+=1)E=a[R].x*V+a[R].y*D,E>H?H=E:E<k&&(k=E);if(b=F-k,C=H-I,v=b<C?b:C,v<y&&(y=v,S=P,v<=0))break}f.axis=m[S],f.overlap=y},e._findSupports=function(f,h,a,m){var d=h.vertices,p=d.length,x=f.position.x,w=f.position.y,T=a.x*m,M=a.y*m,g=d[0],y=g,S=T*(x-y.x)+M*(w-y.y),v,b,C;for(C=1;C<p;C+=1)y=d[C],b=T*(x-y.x)+M*(w-y.y),b<S&&(S=b,g=y);return v=d[(p+g.index-1)%p],S=T*(x-v.x)+M*(w-v.y),y=d[(g.index+1)%p],T*(x-y.x)+M*(w-y.y)<S?(r[0]=g,r[1]=y,r):(r[0]=g,r[1]=v,r)}})()},function(n,l,i){var e={};n.exports=e;var s=i(16);(function(){e.create=function(o,r){var u=o.bodyA,c=o.bodyB,f={id:e.id(u,c),bodyA:u,bodyB:c,collision:o,contacts:[s.create(),s.create()],contactCount:0,separation:0,isActive:!0,isSensor:u.isSensor||c.isSensor,timeCreated:r,timeUpdated:r,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(f,o,r),f},e.update=function(o,r,u){var c=r.supports,f=r.supportCount,h=o.contacts,a=r.parentA,m=r.parentB;o.isActive=!0,o.timeUpdated=u,o.collision=r,o.separation=r.depth,o.inverseMass=a.inverseMass+m.inverseMass,o.friction=a.friction<m.friction?a.friction:m.friction,o.frictionStatic=a.frictionStatic>m.frictionStatic?a.frictionStatic:m.frictionStatic,o.restitution=a.restitution>m.restitution?a.restitution:m.restitution,o.slop=a.slop>m.slop?a.slop:m.slop,o.contactCount=f,r.pair=o;var d=c[0],p=h[0],x=c[1],w=h[1];(w.vertex===d||p.vertex===x)&&(h[1]=p,h[0]=p=w,w=h[1]),p.vertex=d,w.vertex=x},e.setActive=function(o,r,u){r?(o.isActive=!0,o.timeUpdated=u):(o.isActive=!1,o.contactCount=0)},e.id=function(o,r){return o.id<r.id?o.id.toString(36)+":"+r.id.toString(36):r.id.toString(36)+":"+o.id.toString(36)}})()},function(n,l,i){var e={};n.exports=e;var s=i(3),o=i(2),r=i(7),u=i(1),c=i(11),f=i(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(h){var a=h;a.bodyA&&!a.pointA&&(a.pointA={x:0,y:0}),a.bodyB&&!a.pointB&&(a.pointB={x:0,y:0});var m=a.bodyA?o.add(a.bodyA.position,a.pointA):a.pointA,d=a.bodyB?o.add(a.bodyB.position,a.pointB):a.pointB,p=o.magnitude(o.sub(m,d));a.length=typeof a.length<"u"?a.length:p,a.id=a.id||f.nextId(),a.label=a.label||"Constraint",a.type="constraint",a.stiffness=a.stiffness||(a.length>0?1:.7),a.damping=a.damping||0,a.angularStiffness=a.angularStiffness||0,a.angleA=a.bodyA?a.bodyA.angle:a.angleA,a.angleB=a.bodyB?a.bodyB.angle:a.angleB,a.plugin={};var x={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return a.length===0&&a.stiffness>.1?(x.type="pin",x.anchors=!1):a.stiffness<.9&&(x.type="spring"),a.render=f.extend(x,a.render),a},e.preSolveAll=function(h){for(var a=0;a<h.length;a+=1){var m=h[a],d=m.constraintImpulse;m.isStatic||d.x===0&&d.y===0&&d.angle===0||(m.position.x+=d.x,m.position.y+=d.y,m.angle+=d.angle)}},e.solveAll=function(h,a){for(var m=f.clamp(a/f._baseDelta,0,1),d=0;d<h.length;d+=1){var p=h[d],x=!p.bodyA||p.bodyA&&p.bodyA.isStatic,w=!p.bodyB||p.bodyB&&p.bodyB.isStatic;(x||w)&&e.solve(h[d],m)}for(d=0;d<h.length;d+=1)p=h[d],x=!p.bodyA||p.bodyA&&p.bodyA.isStatic,w=!p.bodyB||p.bodyB&&p.bodyB.isStatic,!x&&!w&&e.solve(h[d],m)},e.solve=function(h,a){var m=h.bodyA,d=h.bodyB,p=h.pointA,x=h.pointB;if(!(!m&&!d)){m&&!m.isStatic&&(o.rotate(p,m.angle-h.angleA,p),h.angleA=m.angle),d&&!d.isStatic&&(o.rotate(x,d.angle-h.angleB,x),h.angleB=d.angle);var w=p,T=x;if(m&&(w=o.add(m.position,p)),d&&(T=o.add(d.position,x)),!(!w||!T)){var M=o.sub(w,T),g=o.magnitude(M);g<e._minLength&&(g=e._minLength);var y=(g-h.length)/g,S=h.stiffness>=1||h.length===0,v=S?h.stiffness*a:h.stiffness*a*a,b=h.damping*a,C=o.mult(M,y*v),E=(m?m.inverseMass:0)+(d?d.inverseMass:0),P=(m?m.inverseInertia:0)+(d?d.inverseInertia:0),R=E+P,L,V,D,I,k;if(b>0){var F=o.create();D=o.div(M,g),k=o.sub(d&&o.sub(d.position,d.positionPrev)||F,m&&o.sub(m.position,m.positionPrev)||F),I=o.dot(D,k)}m&&!m.isStatic&&(V=m.inverseMass/E,m.constraintImpulse.x-=C.x*V,m.constraintImpulse.y-=C.y*V,m.position.x-=C.x*V,m.position.y-=C.y*V,b>0&&(m.positionPrev.x-=b*D.x*I*V,m.positionPrev.y-=b*D.y*I*V),L=o.cross(p,C)/R*e._torqueDampen*m.inverseInertia*(1-h.angularStiffness),m.constraintImpulse.angle-=L,m.angle-=L),d&&!d.isStatic&&(V=d.inverseMass/E,d.constraintImpulse.x+=C.x*V,d.constraintImpulse.y+=C.y*V,d.position.x+=C.x*V,d.position.y+=C.y*V,b>0&&(d.positionPrev.x+=b*D.x*I*V,d.positionPrev.y+=b*D.y*I*V),L=o.cross(x,C)/R*e._torqueDampen*d.inverseInertia*(1-h.angularStiffness),d.constraintImpulse.angle+=L,d.angle+=L)}}},e.postSolveAll=function(h){for(var a=0;a<h.length;a++){var m=h[a],d=m.constraintImpulse;if(!(m.isStatic||d.x===0&&d.y===0&&d.angle===0)){r.set(m,!1);for(var p=0;p<m.parts.length;p++){var x=m.parts[p];s.translate(x.vertices,d),p>0&&(x.position.x+=d.x,x.position.y+=d.y),d.angle!==0&&(s.rotate(x.vertices,d.angle,m.position),c.rotate(x.axes,d.angle),p>0&&o.rotateAbout(x.position,d.angle,m.position,x.position)),u.update(x.bounds,x.vertices,m.velocity)}d.angle*=e._warming,d.x*=e._warming,d.y*=e._warming}}},e.pointAWorld=function(h){return{x:(h.bodyA?h.bodyA.position.x:0)+(h.pointA?h.pointA.x:0),y:(h.bodyA?h.bodyA.position.y:0)+(h.pointA?h.pointA.y:0)}},e.pointBWorld=function(h){return{x:(h.bodyB?h.bodyB.position.x:0)+(h.pointB?h.pointB.x:0),y:(h.bodyB?h.bodyB.position.y:0)+(h.pointB?h.pointB.y:0)}},e.currentLength=function(h){var a=(h.bodyA?h.bodyA.position.x:0)+(h.pointA?h.pointA.x:0),m=(h.bodyA?h.bodyA.position.y:0)+(h.pointA?h.pointA.y:0),d=(h.bodyB?h.bodyB.position.x:0)+(h.pointB?h.pointB.x:0),p=(h.bodyB?h.bodyB.position.y:0)+(h.pointB?h.pointB.y:0),x=a-d,w=m-p;return Math.sqrt(x*x+w*w)}})()},function(n,l,i){var e={};n.exports=e;var s=i(2),o=i(0);(function(){e.fromVertices=function(r){for(var u={},c=0;c<r.length;c++){var f=(c+1)%r.length,h=s.normalise({x:r[f].y-r[c].y,y:r[c].x-r[f].x}),a=h.y===0?1/0:h.x/h.y;a=a.toFixed(3).toString(),u[a]=h}return o.values(u)},e.rotate=function(r,u){if(u!==0)for(var c=Math.cos(u),f=Math.sin(u),h=0;h<r.length;h++){var a=r[h],m;m=a.x*c-a.y*f,a.y=a.x*f+a.y*c,a.x=m}}})()},function(n,l,i){var e={};n.exports=e;var s=i(3),o=i(0),r=i(4),u=i(1),c=i(2);(function(){e.rectangle=function(f,h,a,m,d){d=d||{};var p={label:"Rectangle Body",position:{x:f,y:h},vertices:s.fromPath("L 0 0 L "+a+" 0 L "+a+" "+m+" L 0 "+m)};if(d.chamfer){var x=d.chamfer;p.vertices=s.chamfer(p.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete d.chamfer}return r.create(o.extend({},p,d))},e.trapezoid=function(f,h,a,m,d,p){p=p||{},d>=1&&o.warn("Bodies.trapezoid: slope parameter must be < 1."),d*=.5;var x=(1-d*2)*a,w=a*d,T=w+x,M=T+w,g;d<.5?g="L 0 0 L "+w+" "+-m+" L "+T+" "+-m+" L "+M+" 0":g="L 0 0 L "+T+" "+-m+" L "+M+" 0";var y={label:"Trapezoid Body",position:{x:f,y:h},vertices:s.fromPath(g)};if(p.chamfer){var S=p.chamfer;y.vertices=s.chamfer(y.vertices,S.radius,S.quality,S.qualityMin,S.qualityMax),delete p.chamfer}return r.create(o.extend({},y,p))},e.circle=function(f,h,a,m,d){m=m||{};var p={label:"Circle Body",circleRadius:a};d=d||25;var x=Math.ceil(Math.max(10,Math.min(d,a)));return x%2===1&&(x+=1),e.polygon(f,h,x,a,o.extend({},p,m))},e.polygon=function(f,h,a,m,d){if(d=d||{},a<3)return e.circle(f,h,m,d);for(var p=2*Math.PI/a,x="",w=p*.5,T=0;T<a;T+=1){var M=w+T*p,g=Math.cos(M)*m,y=Math.sin(M)*m;x+="L "+g.toFixed(3)+" "+y.toFixed(3)+" "}var S={label:"Polygon Body",position:{x:f,y:h},vertices:s.fromPath(x)};if(d.chamfer){var v=d.chamfer;S.vertices=s.chamfer(S.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete d.chamfer}return r.create(o.extend({},S,d))},e.fromVertices=function(f,h,a,m,d,p,x,w){var T=o.getDecomp(),M,g,y,S,v,b,C,E,P,R,L;for(M=!!(T&&T.quickDecomp),m=m||{},y=[],d=typeof d<"u"?d:!1,p=typeof p<"u"?p:.01,x=typeof x<"u"?x:10,w=typeof w<"u"?w:.01,o.isArray(a[0])||(a=[a]),R=0;R<a.length;R+=1)if(b=a[R],S=s.isConvex(b),v=!S,v&&!M&&o.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),S||!M)S?b=s.clockwiseSort(b):b=s.hull(b),y.push({position:{x:f,y:h},vertices:b});else{var V=b.map(function(O){return[O.x,O.y]});T.makeCCW(V),p!==!1&&T.removeCollinearPoints(V,p),w!==!1&&T.removeDuplicatePoints&&T.removeDuplicatePoints(V,w);var D=T.quickDecomp(V);for(C=0;C<D.length;C++){var I=D[C],k=I.map(function(O){return{x:O[0],y:O[1]}});x>0&&s.area(k)<x||y.push({position:s.centre(k),vertices:k})}}for(C=0;C<y.length;C++)y[C]=r.create(o.extend(y[C],m));if(d){var F=5;for(C=0;C<y.length;C++){var H=y[C];for(E=C+1;E<y.length;E++){var _=y[E];if(u.overlaps(H.bounds,_.bounds)){var U=H.vertices,W=_.vertices;for(P=0;P<H.vertices.length;P++)for(L=0;L<_.vertices.length;L++){var Z=c.magnitudeSquared(c.sub(U[(P+1)%U.length],W[L])),K=c.magnitudeSquared(c.sub(U[P],W[(L+1)%W.length]));Z<F&&K<F&&(U[P].isInternal=!0,W[L].isInternal=!0)}}}}}return y.length>1?(g=r.create(o.extend({parts:y.slice(0)},m)),r.setPosition(g,{x:f,y:h}),g):y[0]}})()},function(n,l,i){var e={};n.exports=e;var s=i(0),o=i(8);(function(){e.create=function(r){var u={bodies:[],collisions:[],pairs:null};return s.extend(u,r)},e.setBodies=function(r,u){r.bodies=u.slice(0)},e.clear=function(r){r.bodies=[],r.collisions=[]},e.collisions=function(r){var u=r.pairs,c=r.bodies,f=c.length,h=e.canCollide,a=o.collides,m=r.collisions,d=0,p,x;for(c.sort(e._compareBoundsX),p=0;p<f;p++){var w=c[p],T=w.bounds,M=w.bounds.max.x,g=w.bounds.max.y,y=w.bounds.min.y,S=w.isStatic||w.isSleeping,v=w.parts.length,b=v===1;for(x=p+1;x<f;x++){var C=c[x],E=C.bounds;if(E.min.x>M)break;if(!(g<E.min.y||y>E.max.y)&&!(S&&(C.isStatic||C.isSleeping))&&h(w.collisionFilter,C.collisionFilter)){var P=C.parts.length;if(b&&P===1){var R=a(w,C,u);R&&(m[d++]=R)}else for(var L=v>1?1:0,V=P>1?1:0,D=L;D<v;D++)for(var I=w.parts[D],T=I.bounds,k=V;k<P;k++){var F=C.parts[k],E=F.bounds;if(!(T.min.x>E.max.x||T.max.x<E.min.x||T.max.y<E.min.y||T.min.y>E.max.y)){var R=a(I,F,u);R&&(m[d++]=R)}}}}}return m.length!==d&&(m.length=d),m},e.canCollide=function(r,u){return r.group===u.group&&r.group!==0?r.group>0:(r.mask&u.category)!==0&&(u.mask&r.category)!==0},e._compareBoundsX=function(r,u){return r.bounds.min.x-u.bounds.min.x}})()},function(n,l,i){var e={};n.exports=e;var s=i(0);(function(){e.create=function(o){var r={};return o||s.log("Mouse.create: element was undefined, defaulting to document.body","warn"),r.element=o||document.body,r.absolute={x:0,y:0},r.position={x:0,y:0},r.mousedownPosition={x:0,y:0},r.mouseupPosition={x:0,y:0},r.offset={x:0,y:0},r.scale={x:1,y:1},r.wheelDelta=0,r.button=-1,r.pixelRatio=parseInt(r.element.getAttribute("data-pixel-ratio"),10)||1,r.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},r.mousemove=function(u){var c=e._getRelativeMousePosition(u,r.element,r.pixelRatio),f=u.changedTouches;f&&(r.button=0,u.preventDefault()),r.absolute.x=c.x,r.absolute.y=c.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y,r.sourceEvents.mousemove=u},r.mousedown=function(u){var c=e._getRelativeMousePosition(u,r.element,r.pixelRatio),f=u.changedTouches;f?(r.button=0,u.preventDefault()):r.button=u.button,r.absolute.x=c.x,r.absolute.y=c.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y,r.mousedownPosition.x=r.position.x,r.mousedownPosition.y=r.position.y,r.sourceEvents.mousedown=u},r.mouseup=function(u){var c=e._getRelativeMousePosition(u,r.element,r.pixelRatio),f=u.changedTouches;f&&u.preventDefault(),r.button=-1,r.absolute.x=c.x,r.absolute.y=c.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y,r.mouseupPosition.x=r.position.x,r.mouseupPosition.y=r.position.y,r.sourceEvents.mouseup=u},r.mousewheel=function(u){r.wheelDelta=Math.max(-1,Math.min(1,u.wheelDelta||-u.detail)),u.preventDefault(),r.sourceEvents.mousewheel=u},e.setElement(r,r.element),r},e.setElement=function(o,r){o.element=r,r.addEventListener("mousemove",o.mousemove,{passive:!0}),r.addEventListener("mousedown",o.mousedown,{passive:!0}),r.addEventListener("mouseup",o.mouseup,{passive:!0}),r.addEventListener("wheel",o.mousewheel,{passive:!1}),r.addEventListener("touchmove",o.mousemove,{passive:!1}),r.addEventListener("touchstart",o.mousedown,{passive:!1}),r.addEventListener("touchend",o.mouseup,{passive:!1})},e.clearSourceEvents=function(o){o.sourceEvents.mousemove=null,o.sourceEvents.mousedown=null,o.sourceEvents.mouseup=null,o.sourceEvents.mousewheel=null,o.wheelDelta=0},e.setOffset=function(o,r){o.offset.x=r.x,o.offset.y=r.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y},e.setScale=function(o,r){o.scale.x=r.x,o.scale.y=r.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y},e._getRelativeMousePosition=function(o,r,u){var c=r.getBoundingClientRect(),f=document.documentElement||document.body.parentNode||document.body,h=window.pageXOffset!==void 0?window.pageXOffset:f.scrollLeft,a=window.pageYOffset!==void 0?window.pageYOffset:f.scrollTop,m=o.changedTouches,d,p;return m?(d=m[0].pageX-c.left-h,p=m[0].pageY-c.top-a):(d=o.pageX-c.left-h,p=o.pageY-c.top-a),{x:d/(r.clientWidth/(r.width||r.clientWidth)*u),y:p/(r.clientHeight/(r.height||r.clientHeight)*u)}}})()},function(n,l,i){var e={};n.exports=e;var s=i(0);(function(){e._registry={},e.register=function(o){if(e.isPlugin(o)||s.warn("Plugin.register:",e.toString(o),"does not implement all required fields."),o.name in e._registry){var r=e._registry[o.name],u=e.versionParse(o.version).number,c=e.versionParse(r.version).number;u>c?(s.warn("Plugin.register:",e.toString(r),"was upgraded to",e.toString(o)),e._registry[o.name]=o):u<c?s.warn("Plugin.register:",e.toString(r),"can not be downgraded to",e.toString(o)):o!==r&&s.warn("Plugin.register:",e.toString(o),"is already registered to different plugin object")}else e._registry[o.name]=o;return o},e.resolve=function(o){return e._registry[e.dependencyParse(o).name]},e.toString=function(o){return typeof o=="string"?o:(o.name||"anonymous")+"@"+(o.version||o.range||"0.0.0")},e.isPlugin=function(o){return o&&o.name&&o.version&&o.install},e.isUsed=function(o,r){return o.used.indexOf(r)>-1},e.isFor=function(o,r){var u=o.for&&e.dependencyParse(o.for);return!o.for||r.name===u.name&&e.versionSatisfies(r.version,u.range)},e.use=function(o,r){if(o.uses=(o.uses||[]).concat(r||[]),o.uses.length===0){s.warn("Plugin.use:",e.toString(o),"does not specify any dependencies to install.");return}for(var u=e.dependencies(o),c=s.topologicalSort(u),f=[],h=0;h<c.length;h+=1)if(c[h]!==o.name){var a=e.resolve(c[h]);if(!a){f.push(" "+c[h]);continue}e.isUsed(o,a.name)||(e.isFor(a,o)||(s.warn("Plugin.use:",e.toString(a),"is for",a.for,"but installed on",e.toString(o)+"."),a._warned=!0),a.install?a.install(o):(s.warn("Plugin.use:",e.toString(a),"does not specify an install function."),a._warned=!0),a._warned?(f.push(" "+e.toString(a)),delete a._warned):f.push(" "+e.toString(a)),o.used.push(a.name))}f.length>0&&s.info(f.join("  "))},e.dependencies=function(o,r){var u=e.dependencyParse(o),c=u.name;if(r=r||{},!(c in r)){o=e.resolve(o)||o,r[c]=s.map(o.uses||[],function(h){e.isPlugin(h)&&e.register(h);var a=e.dependencyParse(h),m=e.resolve(h);return m&&!e.versionSatisfies(m.version,a.range)?(s.warn("Plugin.dependencies:",e.toString(m),"does not satisfy",e.toString(a),"used by",e.toString(u)+"."),m._warned=!0,o._warned=!0):m||(s.warn("Plugin.dependencies:",e.toString(h),"used by",e.toString(u),"could not be resolved."),o._warned=!0),a.name});for(var f=0;f<r[c].length;f+=1)e.dependencies(r[c][f],r);return r}},e.dependencyParse=function(o){if(s.isString(o)){var r=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return r.test(o)||s.warn("Plugin.dependencyParse:",o,"is not a valid dependency string."),{name:o.split("@")[0],range:o.split("@")[1]||"*"}}return{name:o.name,range:o.range||o.version}},e.versionParse=function(o){var r=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;r.test(o)||s.warn("Plugin.versionParse:",o,"is not a valid version or range.");var u=r.exec(o),c=Number(u[4]),f=Number(u[5]),h=Number(u[6]);return{isRange:!!(u[1]||u[2]),version:u[3],range:o,operator:u[1]||u[2]||"",major:c,minor:f,patch:h,parts:[c,f,h],prerelease:u[7],number:c*1e8+f*1e4+h}},e.versionSatisfies=function(o,r){r=r||"*";var u=e.versionParse(r),c=e.versionParse(o);if(u.isRange){if(u.operator==="*"||o==="*")return!0;if(u.operator===">")return c.number>u.number;if(u.operator===">=")return c.number>=u.number;if(u.operator==="~")return c.major===u.major&&c.minor===u.minor&&c.patch>=u.patch;if(u.operator==="^")return u.major>0?c.major===u.major&&c.number>=u.number:u.minor>0?c.minor===u.minor&&c.patch>=u.patch:c.patch===u.patch}return o===r||o==="*"}})()},function(n,l){var i={};n.exports=i,function(){i.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}}()},function(n,l,i){var e={};n.exports=e;var s=i(7),o=i(18),r=i(13),u=i(19),c=i(5),f=i(6),h=i(10),a=i(0),m=i(4);(function(){e._deltaMax=1e3/60,e.create=function(d){d=d||{};var p={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},x=a.extend(p,d);return x.world=d.world||f.create({label:"World"}),x.pairs=d.pairs||u.create(),x.detector=d.detector||r.create(),x.detector.pairs=x.pairs,x.grid={buckets:[]},x.world.gravity=x.gravity,x.broadphase=x.grid,x.metrics={},x},e.update=function(d,p){var x=a.now(),w=d.world,T=d.detector,M=d.pairs,g=d.timing,y=g.timestamp,S;p>e._deltaMax&&a.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",e._deltaMax.toFixed(3),"ms."),p=typeof p<"u"?p:a._baseDelta,p*=g.timeScale,g.timestamp+=p,g.lastDelta=p;var v={timestamp:g.timestamp,delta:p};c.trigger(d,"beforeUpdate",v);var b=f.allBodies(w),C=f.allConstraints(w);for(w.isModified&&(r.setBodies(T,b),f.setModified(w,!1,!1,!0)),d.enableSleeping&&s.update(b,p),e._bodiesApplyGravity(b,d.gravity),p>0&&e._bodiesUpdate(b,p),c.trigger(d,"beforeSolve",v),h.preSolveAll(b),S=0;S<d.constraintIterations;S++)h.solveAll(C,p);h.postSolveAll(b);var E=r.collisions(T);u.update(M,E,y),d.enableSleeping&&s.afterCollisions(M.list),M.collisionStart.length>0&&c.trigger(d,"collisionStart",{pairs:M.collisionStart,timestamp:g.timestamp,delta:p});var P=a.clamp(20/d.positionIterations,0,1);for(o.preSolvePosition(M.list),S=0;S<d.positionIterations;S++)o.solvePosition(M.list,p,P);for(o.postSolvePosition(b),h.preSolveAll(b),S=0;S<d.constraintIterations;S++)h.solveAll(C,p);for(h.postSolveAll(b),o.preSolveVelocity(M.list),S=0;S<d.velocityIterations;S++)o.solveVelocity(M.list,p);return e._bodiesUpdateVelocities(b),M.collisionActive.length>0&&c.trigger(d,"collisionActive",{pairs:M.collisionActive,timestamp:g.timestamp,delta:p}),M.collisionEnd.length>0&&c.trigger(d,"collisionEnd",{pairs:M.collisionEnd,timestamp:g.timestamp,delta:p}),e._bodiesClearForces(b),c.trigger(d,"afterUpdate",v),d.timing.lastElapsed=a.now()-x,d},e.merge=function(d,p){if(a.extend(d,p),p.world){d.world=p.world,e.clear(d);for(var x=f.allBodies(d.world),w=0;w<x.length;w++){var T=x[w];s.set(T,!1),T.id=a.nextId()}}},e.clear=function(d){u.clear(d.pairs),r.clear(d.detector)},e._bodiesClearForces=function(d){for(var p=d.length,x=0;x<p;x++){var w=d[x];w.force.x=0,w.force.y=0,w.torque=0}},e._bodiesApplyGravity=function(d,p){var x=typeof p.scale<"u"?p.scale:.001,w=d.length;if(!(p.x===0&&p.y===0||x===0))for(var T=0;T<w;T++){var M=d[T];M.isStatic||M.isSleeping||(M.force.y+=M.mass*p.y*x,M.force.x+=M.mass*p.x*x)}},e._bodiesUpdate=function(d,p){for(var x=d.length,w=0;w<x;w++){var T=d[w];T.isStatic||T.isSleeping||m.update(T,p)}},e._bodiesUpdateVelocities=function(d){for(var p=d.length,x=0;x<p;x++)m.updateVelocities(d[x])}})()},function(n,l,i){var e={};n.exports=e;var s=i(3),o=i(0),r=i(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(u){var c,f,h,a=u.length;for(c=0;c<a;c++)f=u[c],f.isActive&&(h=f.contactCount,f.collision.parentA.totalContacts+=h,f.collision.parentB.totalContacts+=h)},e.solvePosition=function(u,c,f){var h,a,m,d,p,x,w,T,M=e._positionDampen*(f||1),g=o.clamp(c/o._baseDelta,0,1),y=u.length;for(h=0;h<y;h++)a=u[h],!(!a.isActive||a.isSensor)&&(m=a.collision,d=m.parentA,p=m.parentB,x=m.normal,a.separation=m.depth+x.x*(p.positionImpulse.x-d.positionImpulse.x)+x.y*(p.positionImpulse.y-d.positionImpulse.y));for(h=0;h<y;h++)a=u[h],!(!a.isActive||a.isSensor)&&(m=a.collision,d=m.parentA,p=m.parentB,x=m.normal,T=a.separation-a.slop*g,(d.isStatic||p.isStatic)&&(T*=2),d.isStatic||d.isSleeping||(w=M/d.totalContacts,d.positionImpulse.x+=x.x*T*w,d.positionImpulse.y+=x.y*T*w),p.isStatic||p.isSleeping||(w=M/p.totalContacts,p.positionImpulse.x-=x.x*T*w,p.positionImpulse.y-=x.y*T*w))},e.postSolvePosition=function(u){for(var c=e._positionWarming,f=u.length,h=s.translate,a=r.update,m=0;m<f;m++){var d=u[m],p=d.positionImpulse,x=p.x,w=p.y,T=d.velocity;if(d.totalContacts=0,x!==0||w!==0){for(var M=0;M<d.parts.length;M++){var g=d.parts[M];h(g.vertices,p),a(g.bounds,g.vertices,T),g.position.x+=x,g.position.y+=w}d.positionPrev.x+=x,d.positionPrev.y+=w,x*T.x+w*T.y<0?(p.x=0,p.y=0):(p.x*=c,p.y*=c)}}},e.preSolveVelocity=function(u){var c=u.length,f,h;for(f=0;f<c;f++){var a=u[f];if(!(!a.isActive||a.isSensor)){var m=a.contacts,d=a.contactCount,p=a.collision,x=p.parentA,w=p.parentB,T=p.normal,M=p.tangent;for(h=0;h<d;h++){var g=m[h],y=g.vertex,S=g.normalImpulse,v=g.tangentImpulse;if(S!==0||v!==0){var b=T.x*S+M.x*v,C=T.y*S+M.y*v;x.isStatic||x.isSleeping||(x.positionPrev.x+=b*x.inverseMass,x.positionPrev.y+=C*x.inverseMass,x.anglePrev+=x.inverseInertia*((y.x-x.position.x)*C-(y.y-x.position.y)*b)),w.isStatic||w.isSleeping||(w.positionPrev.x-=b*w.inverseMass,w.positionPrev.y-=C*w.inverseMass,w.anglePrev-=w.inverseInertia*((y.x-w.position.x)*C-(y.y-w.position.y)*b))}}}}},e.solveVelocity=function(u,c){var f=c/o._baseDelta,h=f*f,a=h*f,m=-e._restingThresh*f,d=e._restingThreshTangent,p=e._frictionNormalMultiplier*f,x=e._frictionMaxStatic,w=u.length,T,M,g,y;for(g=0;g<w;g++){var S=u[g];if(!(!S.isActive||S.isSensor)){var v=S.collision,b=v.parentA,C=v.parentB,E=v.normal.x,P=v.normal.y,R=v.tangent.x,L=v.tangent.y,V=S.inverseMass,D=S.friction*S.frictionStatic*p,I=S.contacts,k=S.contactCount,F=1/k,H=b.position.x-b.positionPrev.x,_=b.position.y-b.positionPrev.y,U=b.angle-b.anglePrev,W=C.position.x-C.positionPrev.x,Z=C.position.y-C.positionPrev.y,K=C.angle-C.anglePrev;for(y=0;y<k;y++){var O=I[y],X=O.vertex,z=X.x-b.position.x,$=X.y-b.position.y,j=X.x-C.position.x,Y=X.y-C.position.y,G=H-$*U,Ne=_+z*U,Te=W-Y*K,nn=Z+j*K,rt=G-Te,ot=Ne-nn,He=E*rt+P*ot,ne=R*rt+L*ot,at=S.separation+He,_e=Math.min(at,1);_e=at<0?0:_e;var lt=_e*D;ne<-lt||ne>lt?(M=ne>0?ne:-ne,T=S.friction*(ne>0?1:-1)*a,T<-M?T=-M:T>M&&(T=M)):(T=ne,M=x);var ct=z*P-$*E,ut=j*P-Y*E,ft=F/(V+b.inverseInertia*ct*ct+C.inverseInertia*ut*ut),Me=(1+S.restitution)*He*ft;if(T*=ft,He<m)O.normalImpulse=0;else{var sn=O.normalImpulse;O.normalImpulse+=Me,O.normalImpulse>0&&(O.normalImpulse=0),Me=O.normalImpulse-sn}if(ne<-d||ne>d)O.tangentImpulse=0;else{var rn=O.tangentImpulse;O.tangentImpulse+=T,O.tangentImpulse<-M&&(O.tangentImpulse=-M),O.tangentImpulse>M&&(O.tangentImpulse=M),T=O.tangentImpulse-rn}var Ce=E*Me+R*T,be=P*Me+L*T;b.isStatic||b.isSleeping||(b.positionPrev.x+=Ce*b.inverseMass,b.positionPrev.y+=be*b.inverseMass,b.anglePrev+=(z*be-$*Ce)*b.inverseInertia),C.isStatic||C.isSleeping||(C.positionPrev.x-=Ce*C.inverseMass,C.positionPrev.y-=be*C.inverseMass,C.anglePrev-=(j*be-Y*Ce)*C.inverseInertia)}}}}})()},function(n,l,i){var e={};n.exports=e;var s=i(9),o=i(0);(function(){e.create=function(r){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},r)},e.update=function(r,u,c){var f=s.update,h=s.create,a=s.setActive,m=r.table,d=r.list,p=d.length,x=p,w=r.collisionStart,T=r.collisionEnd,M=r.collisionActive,g=u.length,y=0,S=0,v=0,b,C,E;for(E=0;E<g;E++)b=u[E],C=b.pair,C?(C.isActive&&(M[v++]=C),f(C,b,c)):(C=h(b,c),m[C.id]=C,w[y++]=C,d[x++]=C);for(x=0,p=d.length,E=0;E<p;E++)C=d[E],C.timeUpdated>=c?d[x++]=C:(a(C,!1,c),C.collision.bodyA.sleepCounter>0&&C.collision.bodyB.sleepCounter>0?d[x++]=C:(T[S++]=C,delete m[C.id]));d.length!==x&&(d.length=x),w.length!==y&&(w.length=y),T.length!==S&&(T.length=S),M.length!==v&&(M.length=v)},e.clear=function(r){return r.table={},r.list.length=0,r.collisionStart.length=0,r.collisionActive.length=0,r.collisionEnd.length=0,r}})()},function(n,l,i){var e=n.exports=i(21);e.Axes=i(11),e.Bodies=i(12),e.Body=i(4),e.Bounds=i(1),e.Collision=i(8),e.Common=i(0),e.Composite=i(6),e.Composites=i(22),e.Constraint=i(10),e.Contact=i(16),e.Detector=i(13),e.Engine=i(17),e.Events=i(5),e.Grid=i(23),e.Mouse=i(14),e.MouseConstraint=i(24),e.Pair=i(9),e.Pairs=i(19),e.Plugin=i(15),e.Query=i(25),e.Render=i(26),e.Resolver=i(18),e.Runner=i(27),e.SAT=i(28),e.Sleeping=i(7),e.Svg=i(29),e.Vector=i(2),e.Vertices=i(3),e.World=i(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(n,l,i){var e={};n.exports=e;var s=i(15),o=i(0);(function(){e.name="matter-js",e.version="0.20.0",e.uses=[],e.used=[],e.use=function(){s.use(e,Array.prototype.slice.call(arguments))},e.before=function(r,u){return r=r.replace(/^Matter./,""),o.chainPathBefore(e,r,u)},e.after=function(r,u){return r=r.replace(/^Matter./,""),o.chainPathAfter(e,r,u)}})()},function(n,l,i){var e={};n.exports=e;var s=i(6),o=i(10),r=i(0),u=i(4),c=i(12),f=r.deprecated;(function(){e.stack=function(h,a,m,d,p,x,w){for(var T=s.create({label:"Stack"}),M=h,g=a,y,S=0,v=0;v<d;v++){for(var b=0,C=0;C<m;C++){var E=w(M,g,C,v,y,S);if(E){var P=E.bounds.max.y-E.bounds.min.y,R=E.bounds.max.x-E.bounds.min.x;P>b&&(b=P),u.translate(E,{x:R*.5,y:P*.5}),M=E.bounds.max.x+p,s.addBody(T,E),y=E,S+=1}else M+=p}g+=b+x,M=h}return T},e.chain=function(h,a,m,d,p,x){for(var w=h.bodies,T=1;T<w.length;T++){var M=w[T-1],g=w[T],y=M.bounds.max.y-M.bounds.min.y,S=M.bounds.max.x-M.bounds.min.x,v=g.bounds.max.y-g.bounds.min.y,b=g.bounds.max.x-g.bounds.min.x,C={bodyA:M,pointA:{x:S*a,y:y*m},bodyB:g,pointB:{x:b*d,y:v*p}},E=r.extend(C,x);s.addConstraint(h,o.create(E))}return h.label+=" Chain",h},e.mesh=function(h,a,m,d,p){var x=h.bodies,w,T,M,g,y;for(w=0;w<m;w++){for(T=1;T<a;T++)M=x[T-1+w*a],g=x[T+w*a],s.addConstraint(h,o.create(r.extend({bodyA:M,bodyB:g},p)));if(w>0)for(T=0;T<a;T++)M=x[T+(w-1)*a],g=x[T+w*a],s.addConstraint(h,o.create(r.extend({bodyA:M,bodyB:g},p))),d&&T>0&&(y=x[T-1+(w-1)*a],s.addConstraint(h,o.create(r.extend({bodyA:y,bodyB:g},p)))),d&&T<a-1&&(y=x[T+1+(w-1)*a],s.addConstraint(h,o.create(r.extend({bodyA:y,bodyB:g},p))))}return h.label+=" Mesh",h},e.pyramid=function(h,a,m,d,p,x,w){return e.stack(h,a,m,d,p,x,function(T,M,g,y,S,v){var b=Math.min(d,Math.ceil(m/2)),C=S?S.bounds.max.x-S.bounds.min.x:0;if(!(y>b)){y=b-y;var E=y,P=m-1-y;if(!(g<E||g>P)){v===1&&u.translate(S,{x:(g+(m%2===1?1:-1))*C,y:0});var R=S?g*C:0;return w(h+R+g*p,M,g,y,S,v)}}})},e.newtonsCradle=function(h,a,m,d,p){for(var x=s.create({label:"Newtons Cradle"}),w=0;w<m;w++){var T=1.9,M=c.circle(h+w*(d*T),a+p,d,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),g=o.create({pointA:{x:h+w*(d*T),y:a},bodyB:M});s.addBody(x,M),s.addConstraint(x,g)}return x},f(e,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),e.car=function(h,a,m,d,p){var x=u.nextGroup(!0),w=20,T=-m*.5+w,M=m*.5-w,g=0,y=s.create({label:"Car"}),S=c.rectangle(h,a,m,d,{collisionFilter:{group:x},chamfer:{radius:d*.5},density:2e-4}),v=c.circle(h+T,a+g,p,{collisionFilter:{group:x},friction:.8}),b=c.circle(h+M,a+g,p,{collisionFilter:{group:x},friction:.8}),C=o.create({bodyB:S,pointB:{x:T,y:g},bodyA:v,stiffness:1,length:0}),E=o.create({bodyB:S,pointB:{x:M,y:g},bodyA:b,stiffness:1,length:0});return s.addBody(y,S),s.addBody(y,v),s.addBody(y,b),s.addConstraint(y,C),s.addConstraint(y,E),y},f(e,"car","Composites.car  moved to car example"),e.softBody=function(h,a,m,d,p,x,w,T,M,g){M=r.extend({inertia:1/0},M),g=r.extend({stiffness:.2,render:{type:"line",anchors:!1}},g);var y=e.stack(h,a,m,d,p,x,function(S,v){return c.circle(S,v,T,M)});return e.mesh(y,m,d,w,g),y.label="Soft Body",y},f(e,"softBody","Composites.softBody  moved to softBody and cloth examples")})()},function(n,l,i){var e={};n.exports=e;var s=i(9),o=i(0),r=o.deprecated;(function(){e.create=function(u){var c={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return o.extend(c,u)},e.update=function(u,c,f,h){var a,m,d,p=f.world,x=u.buckets,w,T,M=!1;for(a=0;a<c.length;a++){var g=c[a];if(!(g.isSleeping&&!h)&&!(p.bounds&&(g.bounds.max.x<p.bounds.min.x||g.bounds.min.x>p.bounds.max.x||g.bounds.max.y<p.bounds.min.y||g.bounds.min.y>p.bounds.max.y))){var y=e._getRegion(u,g);if(!g.region||y.id!==g.region.id||h){(!g.region||h)&&(g.region=y);var S=e._regionUnion(y,g.region);for(m=S.startCol;m<=S.endCol;m++)for(d=S.startRow;d<=S.endRow;d++){T=e._getBucketId(m,d),w=x[T];var v=m>=y.startCol&&m<=y.endCol&&d>=y.startRow&&d<=y.endRow,b=m>=g.region.startCol&&m<=g.region.endCol&&d>=g.region.startRow&&d<=g.region.endRow;!v&&b&&b&&w&&e._bucketRemoveBody(u,w,g),(g.region===y||v&&!b||h)&&(w||(w=e._createBucket(x,T)),e._bucketAddBody(u,w,g))}g.region=y,M=!0}}}M&&(u.pairsList=e._createActivePairsList(u))},r(e,"update","Grid.update  replaced by Matter.Detector"),e.clear=function(u){u.buckets={},u.pairs={},u.pairsList=[]},r(e,"clear","Grid.clear  replaced by Matter.Detector"),e._regionUnion=function(u,c){var f=Math.min(u.startCol,c.startCol),h=Math.max(u.endCol,c.endCol),a=Math.min(u.startRow,c.startRow),m=Math.max(u.endRow,c.endRow);return e._createRegion(f,h,a,m)},e._getRegion=function(u,c){var f=c.bounds,h=Math.floor(f.min.x/u.bucketWidth),a=Math.floor(f.max.x/u.bucketWidth),m=Math.floor(f.min.y/u.bucketHeight),d=Math.floor(f.max.y/u.bucketHeight);return e._createRegion(h,a,m,d)},e._createRegion=function(u,c,f,h){return{id:u+","+c+","+f+","+h,startCol:u,endCol:c,startRow:f,endRow:h}},e._getBucketId=function(u,c){return"C"+u+"R"+c},e._createBucket=function(u,c){var f=u[c]=[];return f},e._bucketAddBody=function(u,c,f){var h=u.pairs,a=s.id,m=c.length,d;for(d=0;d<m;d++){var p=c[d];if(!(f.id===p.id||f.isStatic&&p.isStatic)){var x=a(f,p),w=h[x];w?w[2]+=1:h[x]=[f,p,1]}}c.push(f)},e._bucketRemoveBody=function(u,c,f){var h=u.pairs,a=s.id,m;c.splice(o.indexOf(c,f),1);var d=c.length;for(m=0;m<d;m++){var p=h[a(f,c[m])];p&&(p[2]-=1)}},e._createActivePairsList=function(u){var c,f=u.pairs,h=o.keys(f),a=h.length,m=[],d;for(d=0;d<a;d++)c=f[h[d]],c[2]>0?m.push(c):delete f[h[d]];return m}})()},function(n,l,i){var e={};n.exports=e;var s=i(3),o=i(7),r=i(14),u=i(5),c=i(13),f=i(10),h=i(6),a=i(0),m=i(1);(function(){e.create=function(d,p){var x=(d?d.mouse:null)||(p?p.mouse:null);x||(d&&d.render&&d.render.canvas?x=r.create(d.render.canvas):p&&p.element?x=r.create(p.element):(x=r.create(),a.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var w=f.create({label:"Mouse Constraint",pointA:x.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),T={type:"mouseConstraint",mouse:x,element:null,body:null,constraint:w,collisionFilter:{category:1,mask:4294967295,group:0}},M=a.extend(T,p);return u.on(d,"beforeUpdate",function(){var g=h.allBodies(d.world);e.update(M,g),e._triggerEvents(M)}),M},e.update=function(d,p){var x=d.mouse,w=d.constraint,T=d.body;if(x.button===0){if(w.bodyB)o.set(w.bodyB,!1),w.pointA=x.position;else for(var M=0;M<p.length;M++)if(T=p[M],m.contains(T.bounds,x.position)&&c.canCollide(T.collisionFilter,d.collisionFilter))for(var g=T.parts.length>1?1:0;g<T.parts.length;g++){var y=T.parts[g];if(s.contains(y.vertices,x.position)){w.pointA=x.position,w.bodyB=d.body=T,w.pointB={x:x.position.x-T.position.x,y:x.position.y-T.position.y},w.angleB=T.angle,o.set(T,!1),u.trigger(d,"startdrag",{mouse:x,body:T});break}}}else w.bodyB=d.body=null,w.pointB=null,T&&u.trigger(d,"enddrag",{mouse:x,body:T})},e._triggerEvents=function(d){var p=d.mouse,x=p.sourceEvents;x.mousemove&&u.trigger(d,"mousemove",{mouse:p}),x.mousedown&&u.trigger(d,"mousedown",{mouse:p}),x.mouseup&&u.trigger(d,"mouseup",{mouse:p}),r.clearSourceEvents(p)}})()},function(n,l,i){var e={};n.exports=e;var s=i(2),o=i(8),r=i(1),u=i(12),c=i(3);(function(){e.collides=function(f,h){for(var a=[],m=h.length,d=f.bounds,p=o.collides,x=r.overlaps,w=0;w<m;w++){var T=h[w],M=T.parts.length,g=M===1?0:1;if(x(T.bounds,d))for(var y=g;y<M;y++){var S=T.parts[y];if(x(S.bounds,d)){var v=p(S,f);if(v){a.push(v);break}}}}return a},e.ray=function(f,h,a,m){m=m||1e-100;for(var d=s.angle(h,a),p=s.magnitude(s.sub(h,a)),x=(a.x+h.x)*.5,w=(a.y+h.y)*.5,T=u.rectangle(x,w,p,m,{angle:d}),M=e.collides(T,f),g=0;g<M.length;g+=1){var y=M[g];y.body=y.bodyB=y.bodyA}return M},e.region=function(f,h,a){for(var m=[],d=0;d<f.length;d++){var p=f[d],x=r.overlaps(p.bounds,h);(x&&!a||!x&&a)&&m.push(p)}return m},e.point=function(f,h){for(var a=[],m=0;m<f.length;m++){var d=f[m];if(r.contains(d.bounds,h))for(var p=d.parts.length===1?0:1;p<d.parts.length;p++){var x=d.parts[p];if(r.contains(x.bounds,h)&&c.contains(x.vertices,h)){a.push(d);break}}}return a}})()},function(n,l,i){var e={};n.exports=e;var s=i(4),o=i(0),r=i(6),u=i(1),c=i(5),f=i(2),h=i(14);(function(){var a,m;typeof window<"u"&&(a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(g){window.setTimeout(function(){g(o.now())},1e3/60)},m=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(g){var y={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!g.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},S=o.extend(y,g);return S.canvas&&(S.canvas.width=S.options.width||S.canvas.width,S.canvas.height=S.options.height||S.canvas.height),S.mouse=g.mouse,S.engine=g.engine,S.canvas=S.canvas||x(S.options.width,S.options.height),S.context=S.canvas.getContext("2d"),S.textures={},S.bounds=S.bounds||{min:{x:0,y:0},max:{x:S.canvas.width,y:S.canvas.height}},S.controller=e,S.options.showBroadphase=!1,S.options.pixelRatio!==1&&e.setPixelRatio(S,S.options.pixelRatio),o.isElement(S.element)&&S.element.appendChild(S.canvas),S},e.run=function(g){(function y(S){g.frameRequestId=a(y),d(g,S),e.world(g,S),g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0),(g.options.showStats||g.options.showDebug)&&e.stats(g,g.context,S),(g.options.showPerformance||g.options.showDebug)&&e.performance(g,g.context,S),g.context.setTransform(1,0,0,1,0,0)})()},e.stop=function(g){m(g.frameRequestId)},e.setPixelRatio=function(g,y){var S=g.options,v=g.canvas;y==="auto"&&(y=w(v)),S.pixelRatio=y,v.setAttribute("data-pixel-ratio",y),v.width=S.width*y,v.height=S.height*y,v.style.width=S.width+"px",v.style.height=S.height+"px"},e.setSize=function(g,y,S){g.options.width=y,g.options.height=S,g.bounds.max.x=g.bounds.min.x+y,g.bounds.max.y=g.bounds.min.y+S,g.options.pixelRatio!==1?e.setPixelRatio(g,g.options.pixelRatio):(g.canvas.width=y,g.canvas.height=S)},e.lookAt=function(g,y,S,v){v=typeof v<"u"?v:!0,y=o.isArray(y)?y:[y],S=S||{x:0,y:0};for(var b={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},C=0;C<y.length;C+=1){var E=y[C],P=E.bounds?E.bounds.min:E.min||E.position||E,R=E.bounds?E.bounds.max:E.max||E.position||E;P&&R&&(P.x<b.min.x&&(b.min.x=P.x),R.x>b.max.x&&(b.max.x=R.x),P.y<b.min.y&&(b.min.y=P.y),R.y>b.max.y&&(b.max.y=R.y))}var L=b.max.x-b.min.x+2*S.x,V=b.max.y-b.min.y+2*S.y,D=g.canvas.height,I=g.canvas.width,k=I/D,F=L/V,H=1,_=1;F>k?_=F/k:H=k/F,g.options.hasBounds=!0,g.bounds.min.x=b.min.x,g.bounds.max.x=b.min.x+L*H,g.bounds.min.y=b.min.y,g.bounds.max.y=b.min.y+V*_,v&&(g.bounds.min.x+=L*.5-L*H*.5,g.bounds.max.x+=L*.5-L*H*.5,g.bounds.min.y+=V*.5-V*_*.5,g.bounds.max.y+=V*.5-V*_*.5),g.bounds.min.x-=S.x,g.bounds.max.x-=S.x,g.bounds.min.y-=S.y,g.bounds.max.y-=S.y,g.mouse&&(h.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.canvas.width,y:(g.bounds.max.y-g.bounds.min.y)/g.canvas.height}),h.setOffset(g.mouse,g.bounds.min))},e.startViewTransform=function(g){var y=g.bounds.max.x-g.bounds.min.x,S=g.bounds.max.y-g.bounds.min.y,v=y/g.options.width,b=S/g.options.height;g.context.setTransform(g.options.pixelRatio/v,0,0,g.options.pixelRatio/b,0,0),g.context.translate(-g.bounds.min.x,-g.bounds.min.y)},e.endViewTransform=function(g){g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0)},e.world=function(g,y){var S=o.now(),v=g.engine,b=v.world,C=g.canvas,E=g.context,P=g.options,R=g.timing,L=r.allBodies(b),V=r.allConstraints(b),D=P.wireframes?P.wireframeBackground:P.background,I=[],k=[],F,H={timestamp:v.timing.timestamp};if(c.trigger(g,"beforeRender",H),g.currentBackground!==D&&M(g,D),E.globalCompositeOperation="source-in",E.fillStyle="transparent",E.fillRect(0,0,C.width,C.height),E.globalCompositeOperation="source-over",P.hasBounds){for(F=0;F<L.length;F++){var _=L[F];u.overlaps(_.bounds,g.bounds)&&I.push(_)}for(F=0;F<V.length;F++){var U=V[F],W=U.bodyA,Z=U.bodyB,K=U.pointA,O=U.pointB;W&&(K=f.add(W.position,U.pointA)),Z&&(O=f.add(Z.position,U.pointB)),!(!K||!O)&&(u.contains(g.bounds,K)||u.contains(g.bounds,O))&&k.push(U)}e.startViewTransform(g),g.mouse&&(h.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.options.width,y:(g.bounds.max.y-g.bounds.min.y)/g.options.height}),h.setOffset(g.mouse,g.bounds.min))}else k=V,I=L,g.options.pixelRatio!==1&&g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0);!P.wireframes||v.enableSleeping&&P.showSleeping?e.bodies(g,I,E):(P.showConvexHulls&&e.bodyConvexHulls(g,I,E),e.bodyWireframes(g,I,E)),P.showBounds&&e.bodyBounds(g,I,E),(P.showAxes||P.showAngleIndicator)&&e.bodyAxes(g,I,E),P.showPositions&&e.bodyPositions(g,I,E),P.showVelocity&&e.bodyVelocity(g,I,E),P.showIds&&e.bodyIds(g,I,E),P.showSeparations&&e.separations(g,v.pairs.list,E),P.showCollisions&&e.collisions(g,v.pairs.list,E),P.showVertexNumbers&&e.vertexNumbers(g,I,E),P.showMousePosition&&e.mousePosition(g,g.mouse,E),e.constraints(k,E),P.hasBounds&&e.endViewTransform(g),c.trigger(g,"afterRender",H),R.lastElapsed=o.now()-S},e.stats=function(g,y,S){for(var v=g.engine,b=v.world,C=r.allBodies(b),E=0,P=55,R=44,L=0,V=0,D=0;D<C.length;D+=1)E+=C[D].parts.length;var I={Part:E,Body:C.length,Cons:r.allConstraints(b).length,Comp:r.allComposites(b).length,Pair:v.pairs.list.length};y.fillStyle="#0e0f19",y.fillRect(L,V,P*5.5,R),y.font="12px Arial",y.textBaseline="top",y.textAlign="right";for(var k in I){var F=I[k];y.fillStyle="#aaa",y.fillText(k,L+P,V+8),y.fillStyle="#eee",y.fillText(F,L+P,V+26),L+=P}},e.performance=function(g,y){var S=g.engine,v=g.timing,b=v.deltaHistory,C=v.elapsedHistory,E=v.timestampElapsedHistory,P=v.engineDeltaHistory,R=v.engineUpdatesHistory,L=v.engineElapsedHistory,V=S.timing.lastUpdatesPerFrame,D=S.timing.lastDelta,I=p(b),k=p(C),F=p(P),H=p(R),_=p(L),U=p(E),W=U/I||0,Z=Math.round(I/D),K=1e3/I||0,O=4,X=12,z=60,$=34,j=10,Y=69;y.fillStyle="#0e0f19",y.fillRect(0,50,X*5+z*6+22,$),e.status(y,j,Y,z,O,b.length,Math.round(K)+" fps",K/e._goodFps,function(G){return b[G]/I-1}),e.status(y,j+X+z,Y,z,O,P.length,D.toFixed(2)+" dt",e._goodDelta/D,function(G){return P[G]/F-1}),e.status(y,j+(X+z)*2,Y,z,O,R.length,V+" upf",Math.pow(o.clamp(H/Z||1,0,1),4),function(G){return R[G]/H-1}),e.status(y,j+(X+z)*3,Y,z,O,L.length,_.toFixed(2)+" ut",1-V*_/e._goodFps,function(G){return L[G]/_-1}),e.status(y,j+(X+z)*4,Y,z,O,C.length,k.toFixed(2)+" rt",1-k/e._goodFps,function(G){return C[G]/k-1}),e.status(y,j+(X+z)*5,Y,z,O,E.length,W.toFixed(2)+" x",W*W*W,function(G){return(E[G]/b[G]/W||0)-1})},e.status=function(g,y,S,v,b,C,E,P,R){g.strokeStyle="#888",g.fillStyle="#444",g.lineWidth=1,g.fillRect(y,S+7,v,1),g.beginPath(),g.moveTo(y,S+7-b*o.clamp(.4*R(0),-2,2));for(var L=0;L<v;L+=1)g.lineTo(y+L,S+7-(L<C?b*o.clamp(.4*R(L),-2,2):0));g.stroke(),g.fillStyle="hsl("+o.clamp(25+95*P,0,120)+",100%,60%)",g.fillRect(y,S-7,4,4),g.font="12px Arial",g.textBaseline="middle",g.textAlign="right",g.fillStyle="#eee",g.fillText(E,y+v,S-5)},e.constraints=function(g,y){for(var S=y,v=0;v<g.length;v++){var b=g[v];if(!(!b.render.visible||!b.pointA||!b.pointB)){var C=b.bodyA,E=b.bodyB,P,R;if(C?P=f.add(C.position,b.pointA):P=b.pointA,b.render.type==="pin")S.beginPath(),S.arc(P.x,P.y,3,0,2*Math.PI),S.closePath();else{if(E?R=f.add(E.position,b.pointB):R=b.pointB,S.beginPath(),S.moveTo(P.x,P.y),b.render.type==="spring")for(var L=f.sub(R,P),V=f.perp(f.normalise(L)),D=Math.ceil(o.clamp(b.length/5,12,20)),I,k=1;k<D;k+=1)I=k%2===0?1:-1,S.lineTo(P.x+L.x*(k/D)+V.x*I*4,P.y+L.y*(k/D)+V.y*I*4);S.lineTo(R.x,R.y)}b.render.lineWidth&&(S.lineWidth=b.render.lineWidth,S.strokeStyle=b.render.strokeStyle,S.stroke()),b.render.anchors&&(S.fillStyle=b.render.strokeStyle,S.beginPath(),S.arc(P.x,P.y,3,0,2*Math.PI),S.arc(R.x,R.y,3,0,2*Math.PI),S.closePath(),S.fill())}}},e.bodies=function(g,y,S){var v=S;g.engine;var b=g.options,C=b.showInternalEdges||!b.wireframes,E,P,R,L;for(R=0;R<y.length;R++)if(E=y[R],!!E.render.visible){for(L=E.parts.length>1?1:0;L<E.parts.length;L++)if(P=E.parts[L],!!P.render.visible){if(b.showSleeping&&E.isSleeping?v.globalAlpha=.5*P.render.opacity:P.render.opacity!==1&&(v.globalAlpha=P.render.opacity),P.render.sprite&&P.render.sprite.texture&&!b.wireframes){var V=P.render.sprite,D=T(g,V.texture);v.translate(P.position.x,P.position.y),v.rotate(P.angle),v.drawImage(D,D.width*-V.xOffset*V.xScale,D.height*-V.yOffset*V.yScale,D.width*V.xScale,D.height*V.yScale),v.rotate(-P.angle),v.translate(-P.position.x,-P.position.y)}else{if(P.circleRadius)v.beginPath(),v.arc(P.position.x,P.position.y,P.circleRadius,0,2*Math.PI);else{v.beginPath(),v.moveTo(P.vertices[0].x,P.vertices[0].y);for(var I=1;I<P.vertices.length;I++)!P.vertices[I-1].isInternal||C?v.lineTo(P.vertices[I].x,P.vertices[I].y):v.moveTo(P.vertices[I].x,P.vertices[I].y),P.vertices[I].isInternal&&!C&&v.moveTo(P.vertices[(I+1)%P.vertices.length].x,P.vertices[(I+1)%P.vertices.length].y);v.lineTo(P.vertices[0].x,P.vertices[0].y),v.closePath()}b.wireframes?(v.lineWidth=1,v.strokeStyle=g.options.wireframeStrokeStyle,v.stroke()):(v.fillStyle=P.render.fillStyle,P.render.lineWidth&&(v.lineWidth=P.render.lineWidth,v.strokeStyle=P.render.strokeStyle,v.stroke()),v.fill())}v.globalAlpha=1}}},e.bodyWireframes=function(g,y,S){var v=S,b=g.options.showInternalEdges,C,E,P,R,L;for(v.beginPath(),P=0;P<y.length;P++)if(C=y[P],!!C.render.visible)for(L=C.parts.length>1?1:0;L<C.parts.length;L++){for(E=C.parts[L],v.moveTo(E.vertices[0].x,E.vertices[0].y),R=1;R<E.vertices.length;R++)!E.vertices[R-1].isInternal||b?v.lineTo(E.vertices[R].x,E.vertices[R].y):v.moveTo(E.vertices[R].x,E.vertices[R].y),E.vertices[R].isInternal&&!b&&v.moveTo(E.vertices[(R+1)%E.vertices.length].x,E.vertices[(R+1)%E.vertices.length].y);v.lineTo(E.vertices[0].x,E.vertices[0].y)}v.lineWidth=1,v.strokeStyle=g.options.wireframeStrokeStyle,v.stroke()},e.bodyConvexHulls=function(g,y,S){var v=S,b,C,E;for(v.beginPath(),C=0;C<y.length;C++)if(b=y[C],!(!b.render.visible||b.parts.length===1)){for(v.moveTo(b.vertices[0].x,b.vertices[0].y),E=1;E<b.vertices.length;E++)v.lineTo(b.vertices[E].x,b.vertices[E].y);v.lineTo(b.vertices[0].x,b.vertices[0].y)}v.lineWidth=1,v.strokeStyle="rgba(255,255,255,0.2)",v.stroke()},e.vertexNumbers=function(g,y,S){var v=S,b,C,E;for(b=0;b<y.length;b++){var P=y[b].parts;for(E=P.length>1?1:0;E<P.length;E++){var R=P[E];for(C=0;C<R.vertices.length;C++)v.fillStyle="rgba(255,255,255,0.2)",v.fillText(b+"_"+C,R.position.x+(R.vertices[C].x-R.position.x)*.8,R.position.y+(R.vertices[C].y-R.position.y)*.8)}}},e.mousePosition=function(g,y,S){var v=S;v.fillStyle="rgba(255,255,255,0.8)",v.fillText(y.position.x+"  "+y.position.y,y.position.x+5,y.position.y-5)},e.bodyBounds=function(g,y,S){var v=S;g.engine;var b=g.options;v.beginPath();for(var C=0;C<y.length;C++){var E=y[C];if(E.render.visible)for(var P=y[C].parts,R=P.length>1?1:0;R<P.length;R++){var L=P[R];v.rect(L.bounds.min.x,L.bounds.min.y,L.bounds.max.x-L.bounds.min.x,L.bounds.max.y-L.bounds.min.y)}}b.wireframes?v.strokeStyle="rgba(255,255,255,0.08)":v.strokeStyle="rgba(0,0,0,0.1)",v.lineWidth=1,v.stroke()},e.bodyAxes=function(g,y,S){var v=S;g.engine;var b=g.options,C,E,P,R;for(v.beginPath(),E=0;E<y.length;E++){var L=y[E],V=L.parts;if(L.render.visible)if(b.showAxes)for(P=V.length>1?1:0;P<V.length;P++)for(C=V[P],R=0;R<C.axes.length;R++){var D=C.axes[R];v.moveTo(C.position.x,C.position.y),v.lineTo(C.position.x+D.x*20,C.position.y+D.y*20)}else for(P=V.length>1?1:0;P<V.length;P++)for(C=V[P],R=0;R<C.axes.length;R++)v.moveTo(C.position.x,C.position.y),v.lineTo((C.vertices[0].x+C.vertices[C.vertices.length-1].x)/2,(C.vertices[0].y+C.vertices[C.vertices.length-1].y)/2)}b.wireframes?(v.strokeStyle="indianred",v.lineWidth=1):(v.strokeStyle="rgba(255, 255, 255, 0.4)",v.globalCompositeOperation="overlay",v.lineWidth=2),v.stroke(),v.globalCompositeOperation="source-over"},e.bodyPositions=function(g,y,S){var v=S;g.engine;var b=g.options,C,E,P,R;for(v.beginPath(),P=0;P<y.length;P++)if(C=y[P],!!C.render.visible)for(R=0;R<C.parts.length;R++)E=C.parts[R],v.arc(E.position.x,E.position.y,3,0,2*Math.PI,!1),v.closePath();for(b.wireframes?v.fillStyle="indianred":v.fillStyle="rgba(0,0,0,0.5)",v.fill(),v.beginPath(),P=0;P<y.length;P++)C=y[P],C.render.visible&&(v.arc(C.positionPrev.x,C.positionPrev.y,2,0,2*Math.PI,!1),v.closePath());v.fillStyle="rgba(255,165,0,0.8)",v.fill()},e.bodyVelocity=function(g,y,S){var v=S;v.beginPath();for(var b=0;b<y.length;b++){var C=y[b];if(C.render.visible){var E=s.getVelocity(C);v.moveTo(C.position.x,C.position.y),v.lineTo(C.position.x+E.x,C.position.y+E.y)}}v.lineWidth=3,v.strokeStyle="cornflowerblue",v.stroke()},e.bodyIds=function(g,y,S){var v=S,b,C;for(b=0;b<y.length;b++)if(y[b].render.visible){var E=y[b].parts;for(C=E.length>1?1:0;C<E.length;C++){var P=E[C];v.font="12px Arial",v.fillStyle="rgba(255,255,255,0.5)",v.fillText(P.id,P.position.x+10,P.position.y-10)}}},e.collisions=function(g,y,S){var v=S,b=g.options,C,E,P,R;for(v.beginPath(),P=0;P<y.length;P++)if(C=y[P],!!C.isActive)for(E=C.collision,R=0;R<C.contactCount;R++){var L=C.contacts[R],V=L.vertex;v.rect(V.x-1.5,V.y-1.5,3.5,3.5)}for(b.wireframes?v.fillStyle="rgba(255,255,255,0.7)":v.fillStyle="orange",v.fill(),v.beginPath(),P=0;P<y.length;P++)if(C=y[P],!!C.isActive&&(E=C.collision,C.contactCount>0)){var D=C.contacts[0].vertex.x,I=C.contacts[0].vertex.y;C.contactCount===2&&(D=(C.contacts[0].vertex.x+C.contacts[1].vertex.x)/2,I=(C.contacts[0].vertex.y+C.contacts[1].vertex.y)/2),E.bodyB===E.supports[0].body||E.bodyA.isStatic===!0?v.moveTo(D-E.normal.x*8,I-E.normal.y*8):v.moveTo(D+E.normal.x*8,I+E.normal.y*8),v.lineTo(D,I)}b.wireframes?v.strokeStyle="rgba(255,165,0,0.7)":v.strokeStyle="orange",v.lineWidth=1,v.stroke()},e.separations=function(g,y,S){var v=S,b=g.options,C,E,P,R,L;for(v.beginPath(),L=0;L<y.length;L++)if(C=y[L],!!C.isActive){E=C.collision,P=E.bodyA,R=E.bodyB;var V=1;!R.isStatic&&!P.isStatic&&(V=.5),R.isStatic&&(V=0),v.moveTo(R.position.x,R.position.y),v.lineTo(R.position.x-E.penetration.x*V,R.position.y-E.penetration.y*V),V=1,!R.isStatic&&!P.isStatic&&(V=.5),P.isStatic&&(V=0),v.moveTo(P.position.x,P.position.y),v.lineTo(P.position.x+E.penetration.x*V,P.position.y+E.penetration.y*V)}b.wireframes?v.strokeStyle="rgba(255,165,0,0.5)":v.strokeStyle="orange",v.stroke()},e.inspector=function(g,y){g.engine;var S=g.selected,v=g.render,b=v.options,C;if(b.hasBounds){var E=v.bounds.max.x-v.bounds.min.x,P=v.bounds.max.y-v.bounds.min.y,R=E/v.options.width,L=P/v.options.height;y.scale(1/R,1/L),y.translate(-v.bounds.min.x,-v.bounds.min.y)}for(var V=0;V<S.length;V++){var D=S[V].data;switch(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.9)",y.setLineDash([1,2]),D.type){case"body":C=D.bounds,y.beginPath(),y.rect(Math.floor(C.min.x-3),Math.floor(C.min.y-3),Math.floor(C.max.x-C.min.x+6),Math.floor(C.max.y-C.min.y+6)),y.closePath(),y.stroke();break;case"constraint":var I=D.pointA;D.bodyA&&(I=D.pointB),y.beginPath(),y.arc(I.x,I.y,10,0,2*Math.PI),y.closePath(),y.stroke();break}y.setLineDash([]),y.translate(-.5,-.5)}g.selectStart!==null&&(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.6)",y.fillStyle="rgba(255,165,0,0.1)",C=g.selectBounds,y.beginPath(),y.rect(Math.floor(C.min.x),Math.floor(C.min.y),Math.floor(C.max.x-C.min.x),Math.floor(C.max.y-C.min.y)),y.closePath(),y.stroke(),y.fill(),y.translate(-.5,-.5)),b.hasBounds&&y.setTransform(1,0,0,1,0,0)};var d=function(g,y){var S=g.engine,v=g.timing,b=v.historySize,C=S.timing.timestamp;v.delta=y-v.lastTime||e._goodDelta,v.lastTime=y,v.timestampElapsed=C-v.lastTimestamp||0,v.lastTimestamp=C,v.deltaHistory.unshift(v.delta),v.deltaHistory.length=Math.min(v.deltaHistory.length,b),v.engineDeltaHistory.unshift(S.timing.lastDelta),v.engineDeltaHistory.length=Math.min(v.engineDeltaHistory.length,b),v.timestampElapsedHistory.unshift(v.timestampElapsed),v.timestampElapsedHistory.length=Math.min(v.timestampElapsedHistory.length,b),v.engineUpdatesHistory.unshift(S.timing.lastUpdatesPerFrame),v.engineUpdatesHistory.length=Math.min(v.engineUpdatesHistory.length,b),v.engineElapsedHistory.unshift(S.timing.lastElapsed),v.engineElapsedHistory.length=Math.min(v.engineElapsedHistory.length,b),v.elapsedHistory.unshift(v.lastElapsed),v.elapsedHistory.length=Math.min(v.elapsedHistory.length,b)},p=function(g){for(var y=0,S=0;S<g.length;S+=1)y+=g[S];return y/g.length||0},x=function(g,y){var S=document.createElement("canvas");return S.width=g,S.height=y,S.oncontextmenu=function(){return!1},S.onselectstart=function(){return!1},S},w=function(g){var y=g.getContext("2d"),S=window.devicePixelRatio||1,v=y.webkitBackingStorePixelRatio||y.mozBackingStorePixelRatio||y.msBackingStorePixelRatio||y.oBackingStorePixelRatio||y.backingStorePixelRatio||1;return S/v},T=function(g,y){var S=g.textures[y];return S||(S=g.textures[y]=new Image,S.src=y,S)},M=function(g,y){var S=y;/(jpg|gif|png)$/.test(y)&&(S="url("+y+")"),g.canvas.style.background=S,g.canvas.style.backgroundSize="contain",g.currentBackground=y}})()},function(n,l,i){var e={};n.exports=e;var s=i(5),o=i(17),r=i(0);(function(){e._maxFrameDelta=1e3/15,e._frameDeltaFallback=1e3/60,e._timeBufferMargin=1.5,e._elapsedNextEstimate=1,e._smoothingLowerBound=.1,e._smoothingUpperBound=.9,e.create=function(c){var f={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},h=r.extend(f,c);return h.fps=0,h},e.run=function(c,f){return c.timeBuffer=e._frameDeltaFallback,function h(a){c.frameRequestId=e._onNextFrame(c,h),a&&c.enabled&&e.tick(c,f,a)}(),c},e.tick=function(c,f,h){var a=r.now(),m=c.delta,d=0,p=h-c.timeLastTick;if((!p||!c.timeLastTick||p>Math.max(e._maxFrameDelta,c.maxFrameTime))&&(p=c.frameDelta||e._frameDeltaFallback),c.frameDeltaSmoothing){c.frameDeltaHistory.push(p),c.frameDeltaHistory=c.frameDeltaHistory.slice(-c.frameDeltaHistorySize);var x=c.frameDeltaHistory.slice(0).sort(),w=c.frameDeltaHistory.slice(x.length*e._smoothingLowerBound,x.length*e._smoothingUpperBound),T=u(w);p=T||p}c.frameDeltaSnapping&&(p=1e3/Math.round(1e3/p)),c.frameDelta=p,c.timeLastTick=h,c.timeBuffer+=c.frameDelta,c.timeBuffer=r.clamp(c.timeBuffer,0,c.frameDelta+m*e._timeBufferMargin),c.lastUpdatesDeferred=0;var M=c.maxUpdates||Math.ceil(c.maxFrameTime/m),g={timestamp:f.timing.timestamp};s.trigger(c,"beforeTick",g),s.trigger(c,"tick",g);for(var y=r.now();m>0&&c.timeBuffer>=m*e._timeBufferMargin;){s.trigger(c,"beforeUpdate",g),o.update(f,m),s.trigger(c,"afterUpdate",g),c.timeBuffer-=m,d+=1;var S=r.now()-a,v=r.now()-y,b=S+e._elapsedNextEstimate*v/d;if(d>=M||b>c.maxFrameTime){c.lastUpdatesDeferred=Math.round(Math.max(0,c.timeBuffer/m-e._timeBufferMargin));break}}f.timing.lastUpdatesPerFrame=d,s.trigger(c,"afterTick",g),c.frameDeltaHistory.length>=100&&(c.lastUpdatesDeferred&&Math.round(c.frameDelta/m)>M?r.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):c.lastUpdatesDeferred&&r.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof c.isFixed<"u"&&r.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(c.deltaMin||c.deltaMax)&&r.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),c.fps!==0&&r.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},e.stop=function(c){e._cancelNextFrame(c)},e._onNextFrame=function(c,f){if(typeof window<"u"&&window.requestAnimationFrame)c.frameRequestId=window.requestAnimationFrame(f);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return c.frameRequestId},e._cancelNextFrame=function(c){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(c.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var u=function(c){for(var f=0,h=c.length,a=0;a<h;a+=1)f+=c[a];return f/h||0}})()},function(n,l,i){var e={};n.exports=e;var s=i(8),o=i(0),r=o.deprecated;(function(){e.collides=function(u,c){return s.collides(u,c)},r(e,"collides","SAT.collides  replaced by Collision.collides")})()},function(n,l,i){var e={};n.exports=e,i(1);var s=i(0);(function(){e.pathToVertices=function(o,r){typeof window<"u"&&!("SVGPathSeg"in window)&&s.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var u,c,f,h,a,m,d,p,x,w,T=[],M,g,y=0,S=0,v=0;r=r||15;var b=function(E,P,R){var L=R%2===1&&R>1;if(!x||E!=x.x||P!=x.y){x&&L?(M=x.x,g=x.y):(M=0,g=0);var V={x:M+E,y:g+P};(L||!x)&&(x=V),T.push(V),S=M+E,v=g+P}},C=function(E){var P=E.pathSegTypeAsLetter.toUpperCase();if(P!=="Z"){switch(P){case"M":case"L":case"T":case"C":case"S":case"Q":S=E.x,v=E.y;break;case"H":S=E.x;break;case"V":v=E.y;break}b(S,v,E.pathSegType)}};for(e._svgPathToAbsolute(o),f=o.getTotalLength(),m=[],u=0;u<o.pathSegList.numberOfItems;u+=1)m.push(o.pathSegList.getItem(u));for(d=m.concat();y<f;){if(w=o.getPathSegAtLength(y),a=m[w],a!=p){for(;d.length&&d[0]!=a;)C(d.shift());p=a}switch(a.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":h=o.getPointAtLength(y),b(h.x,h.y,0);break}y+=r}for(u=0,c=d.length;u<c;++u)C(d[u]);return T},e._svgPathToAbsolute=function(o){for(var r,u,c,f,h,a,m=o.pathSegList,d=0,p=0,x=m.numberOfItems,w=0;w<x;++w){var T=m.getItem(w),M=T.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(M))"x"in T&&(d=T.x),"y"in T&&(p=T.y);else switch("x1"in T&&(c=d+T.x1),"x2"in T&&(h=d+T.x2),"y1"in T&&(f=p+T.y1),"y2"in T&&(a=p+T.y2),"x"in T&&(d+=T.x),"y"in T&&(p+=T.y),M){case"m":m.replaceItem(o.createSVGPathSegMovetoAbs(d,p),w);break;case"l":m.replaceItem(o.createSVGPathSegLinetoAbs(d,p),w);break;case"h":m.replaceItem(o.createSVGPathSegLinetoHorizontalAbs(d),w);break;case"v":m.replaceItem(o.createSVGPathSegLinetoVerticalAbs(p),w);break;case"c":m.replaceItem(o.createSVGPathSegCurvetoCubicAbs(d,p,c,f,h,a),w);break;case"s":m.replaceItem(o.createSVGPathSegCurvetoCubicSmoothAbs(d,p,h,a),w);break;case"q":m.replaceItem(o.createSVGPathSegCurvetoQuadraticAbs(d,p,c,f),w);break;case"t":m.replaceItem(o.createSVGPathSegCurvetoQuadraticSmoothAbs(d,p),w);break;case"a":m.replaceItem(o.createSVGPathSegArcAbs(d,p,T.r1,T.r2,T.angle,T.largeArcFlag,T.sweepFlag),w);break;case"z":case"Z":d=r,p=u;break}(M=="M"||M=="m")&&(r=d,u=p)}}})()},function(n,l,i){var e={};n.exports=e;var s=i(6);i(0),function(){e.create=s.create,e.add=s.add,e.remove=s.remove,e.clear=s.clear,e.addComposite=s.addComposite,e.addBody=s.addBody,e.addConstraint=s.addConstraint}()}])})})(ni);const ue=new nt(0,0,0,"YXZ"),fe=new B,si={type:"change"},ii={type:"lock"},ri={type:"unlock"},It=Math.PI/2;class mi extends Qn{constructor(t,n=null){super(t,n),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=oi.bind(this),this._onPointerlockChange=ai.bind(this),this._onPointerlockError=li.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(t){return t.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(t){if(this.enabled===!1)return;const n=this.object;fe.setFromMatrixColumn(n.matrix,0),fe.crossVectors(n.up,fe),n.position.addScaledVector(fe,t)}moveRight(t){if(this.enabled===!1)return;const n=this.object;fe.setFromMatrixColumn(n.matrix,0),n.position.addScaledVector(fe,t)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function oi(A){if(this.enabled===!1||this.isLocked===!1)return;const t=A.movementX||A.mozMovementX||A.webkitMovementX||0,n=A.movementY||A.mozMovementY||A.webkitMovementY||0,l=this.object;ue.setFromQuaternion(l.quaternion),ue.y-=t*.002*this.pointerSpeed,ue.x-=n*.002*this.pointerSpeed,ue.x=Math.max(It-this.maxPolarAngle,Math.min(It-this.minPolarAngle,ue.x)),l.quaternion.setFromEuler(ue),this.dispatchEvent(si)}function ai(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(ii),this.isLocked=!0):(this.dispatchEvent(ri),this.isLocked=!1)}function li(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}export{hi as A,ui as G,mi as P,fi as a,ie as l};
