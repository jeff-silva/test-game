import{M as Ve,g as I,p as qe,q as ht,r as mt,s as dt,t as pt,D as gt,u as vt,B as yt,i as xt,v as wt,w as St,x as Ct,y as Pt,z as At,d as _e,F as Mt,G as bt,H as Vt,I as Tt,b as Et,J as Bt,E as Te,Q as ie,K as j,N as et,U as tt,c as Ee,e as We,X as Ue,L as Dt,Y as nt,h as pe,Z as kt,_ as Ne,$ as Lt,n as Be,j as It}from"./oSmP2IjT.js";/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Rt extends Ve{constructor(n,i){super(n,i),this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new I,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}}const he=new Map,Ft=5,ee=(T,n=!1)=>{if(!he.has(T))he.set(T,1);else{const i=he.get(T);if(typeof i>"u"||i>=Ft)return;he.set(T,i+1)}n?console.error(`%c [enable3d] ${T} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${T} `,"background: #222; color: #bada55")};class it{constructor(){this._defaultMaterial=new qe({color:13421772})}get(){return this._defaultMaterial}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Ot{constructor(n){this.scene=n,this.isHeadless=n==="headless",this.defaultMaterial=new it}get make(){return{plane:(n={},i={})=>this.makePlane(n,i),box:(n={},i={})=>this.makeBox(n,i),sphere:(n={},i={})=>this.makeSphere(n,i),capsule:(n={},i={})=>this.makeCapsule(n,i),cylinder:(n={},i={})=>this.makeCylinder(n,i),cone:(n={},i={})=>this.makeCone(n,i),torus:(n={},i={})=>this.makeTorus(n,i),extrude:(n,i={})=>this.makeExtrude(n,i)}}get add(){return{mesh:n=>this.addMesh(n),existing:n=>this.addExisting(n),plane:(n={},i={})=>this.addPlane(n,i),box:(n={},i={})=>this.addBox(n,i),ground:(n,i={})=>this.addGround(n,i),sphere:(n={},i={})=>this.addSphere(n,i),capsule:(n={},i={})=>this.addCapsule(n,i),cylinder:(n={},i={})=>this.addCylinder(n,i),cone:(n={},i={})=>this.addCone(n,i),torus:(n={},i={})=>this.addTorus(n,i),extrude:(n,i={})=>this.addExtrude(n,i),material:(n={})=>this.addMaterial(n)}}addExisting(...n){this.scene!=="headless"&&this.scene.add(...n)}addMesh(n){if(Array.isArray(n))for(let i=0;i<n.length;i++)this.addExisting(n[i]);else this.addExisting(n);return this}createMesh(n,i,d){const{x:c=0,y:e=0,z:r=0}=d;let s;switch(!Array.isArray(i)&&i.type){case"LineBasicMaterial":s=new mt(n,i);break;case"PointsMaterial":s=new ht(n,i);break;default:s=new Rt(n,i);break}return s.position.set(c,e,r),s.castShadow=s.receiveShadow=!0,s}makeExtrude(n,i){const{x:d,y:c,z:e,name:r,shape:s,autoCenter:o=!0,breakable:h=!1,...a}=n,{depth:m=1,bevelEnabled:u=!1}=a,t=new dt(s,{depth:m,bevelEnabled:u,...a}),l=this.addMaterial(i),f=this.createMesh(t,l,{x:d,y:c,z:e});return o&&f.geometry.center(),f.name=r||`body_id_${f.id}`,f.shape="extrude",f}addExtrude(n,i={}){const d=this.makeExtrude(n,i);return this.addExisting(d),d}makePlane(n,i){const{x:d,y:c,z:e,name:r,breakable:s=!1,...o}=n,h=new pt(o.width||1,o.height||1,o.widthSegments||1,o.heightSegments||1),a=this.addMaterial(i);a.side=gt;const m=this.createMesh(h,a,{x:d,y:c,z:e});return m.name=r||`body_id_${m.id}`,m.shape="plane",m}addPlane(n,i){const d=this.makePlane(n,i);return this.addExisting(d),d}makeSphere(n,i){const{x:d,y:c,z:e,name:r,breakable:s=!1,...o}=n,h=new vt(o.radius||1,o.widthSegments||16,o.heightSegments||12,o.phiStart||void 0,o.phiLength||void 0,o.thetaStart||void 0,o.thetaLength||void 0),a=this.addMaterial(i),m=this.createMesh(h,a,{x:d,y:c,z:e});return m.name=r||`body_id_${m.id}`,m.shape="sphere",m}addSphere(n={},i={}){const d=this.makeSphere(n,i);return this.addExisting(d),d}makeBox(n,i){const{x:d,y:c,z:e,name:r,breakable:s=!1,...o}=n,h=new yt(o.width||1,o.height||1,o.depth||1,o.widthSegments||void 0,o.heightSegments||void 0,o.depthSegments||void 0),a=this.addMaterial(i),m=this.createMesh(h,a,{x:d,y:c,z:e});return m.name=r||`body_id_${m.id}`,m.shape="box",m}addBox(n={},i={}){const d=this.makeBox(n,i);return this.addExisting(d),d}addGround(n,i={}){const d=this.makeBox(n,i);return d.rotateX(xt.degToRad(90)),this.addExisting(d),d}makeCapsule(n={},i={}){const{x:d,y:c,z:e,name:r,breakable:s=!1,...o}=n,h=new wt(o.radius||.5,o.length||1,o.capSegments||4,o.radialSegments||16),a=this.addMaterial(i),m=this.createMesh(h,a,{x:d,y:c,z:e});return m.name=r||`body_id_${m.id}`,m.shape="capsule",m}addCapsule(n={},i={}){const d=this.makeCapsule(n,i);return this.addExisting(d),d}makeCylinder(n={},i={}){const{x:d,y:c,z:e,name:r,breakable:s=!1,...o}=n,h=new St(o.radiusTop||1,o.radiusBottom||1,o.height||1,o.radiusSegments||void 0,o.heightSegments||void 0,o.openEnded||void 0,o.thetaStart||void 0,o.thetaLength||void 0),a=this.addMaterial(i),m=this.createMesh(h,a,{x:d,y:c,z:e});return m.name=r||`body_id_${m.id}`,m.shape="cylinder",m}addCylinder(n={},i={}){const d=this.makeCylinder(n,i);return this.addExisting(d),d}makeCone(n={},i={}){const{x:d,y:c,z:e,name:r,breakable:s=!1,...o}=n,h=new Ct(o.radius||1,o.height||1,o.radiusSegments||8,o.heightSegments||1,o.openEnded||!1,o.thetaStart||0,o.thetaLength||2*Math.PI),a=this.addMaterial(i),m=this.createMesh(h,a,{x:d,y:c,z:e});return m.name=r||`body_id_${m.id}`,m.shape="cone",m}addCone(n={},i={}){const d=this.makeCone(n,i);return this.addExisting(d),d}makeTorus(n={},i={}){const{x:d,y:c,z:e,name:r,breakable:s=!1,...o}=n,h=new Pt(o.radius||void 0,o.tube||void 0,o.radialSegments||void 0,o.tubularSegments||void 0,o.arc||void 0),a=this.addMaterial(i),m=this.createMesh(h,a,{x:d,y:c,z:e});return m.name=r||`body_id_${m.id}`,m.shape="torus",m}addTorus(n={},i={}){const d=this.makeTorus(n,i);return this.addExisting(d),d}addMaterial(n={}){const i=Object.keys(n)[0];let d;if(this.scene==="headless")return this.defaultMaterial.get();switch(i){case"basic":d=new Bt(n.basic);break;case"normal":d=new Et(n.normal);break;case"standard":d=new Tt(n.standard);break;case"lambert":d=new qe(n.lambert);break;case"phong":d=new Vt(n.phong);break;case"physical":typeof n.physical<"u"?d=new bt(n.physical):(ee("You need to pass parameters to the physical material. (Fallback to default material)"),d=this.defaultMaterial.get());break;case"toon":d=new Mt(n.toon);break;case"line":d=new _e(n.line);break;case"points":d=new At(n.points);break;case"custom":d=n.custom||this.defaultMaterial.get();break;default:d=this.defaultMaterial.get();break}return d}}var se=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},De={},ve={};Object.defineProperty(ve,"__esModule",{value:!0});ve.VERSION=void 0;ve.VERSION="0.0.5";/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */var Ge=se&&se.__spreadArray||function(T,n){for(var i=0,d=n.length,c=T.length;i<d;i++,c++)T[c]=n[i];return T};Object.defineProperty(De,"__esModule",{value:!0});var re=De.Events=void 0,zt=ve,Ht=function(){function T(n,i,d){d===void 0&&(d=!1),this.fn=n,this.context=i,this.once=d}return T}(),Qe=function(T,n,i,d,c){if(typeof i!="function")throw new TypeError("The listener must be a function");var e=new Ht(i,d||T,c);return T._events.has(n)?T._events.get(n).fn?T._events.set(n,[T._events.get(n),e]):T._events.get(n).push(e):(T._events.set(n,e),T._eventsCount++),T},me=function(T,n){--T._eventsCount===0?T._events=new Map:T._events.delete(n)},Wt=function(){function T(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(T,"VERSION",{get:function(){return zt.VERSION},enumerable:!1,configurable:!0}),T.prototype.eventNames=function(){return Array.from(this._events.keys())},T.prototype.listeners=function(n){var i=this._events.get(n);if(!i)return[];if(i.fn)return[i.fn];for(var d=0,c=i.length,e=new Array(c);d<c;d++)e[d]=i[d].fn;return e},T.prototype.listenerCount=function(n){var i=this._events.get(n);return i?i.fn?1:i.length:0},T.prototype.emit=function(n){for(var i,d,c=[],e=1;e<arguments.length;e++)c[e-1]=arguments[e];if(!this._events.has(n))return!1;var r=this._events.get(n),s;if(r.fn)return r.once&&this.removeListener(n,r.fn,void 0,!0),(i=r.fn).call.apply(i,Ge([r.context],c)),!0;var o=r.length;for(s=0;s<o;s++)r[s].once&&this.removeListener(n,r[s].fn,void 0,!0),(d=r[s].fn).call.apply(d,Ge([r[s].context],c));return!0},T.prototype.on=function(n,i,d){return Qe(this,n,i,d,!1)},T.prototype.once=function(n,i,d){return Qe(this,n,i,d,!0)},T.prototype.removeListener=function(n,i,d,c){if(!this._events.has(n))return this;if(!i)return me(this,n),this;var e=this._events.get(n);if(e.fn)e.fn===i&&(!c||e.once)&&(!d||e.context===d)&&me(this,n);else{for(var r=0,s=[],o=e.length;r<o;r++)(e[r].fn!==i||c&&!e[r].once||d&&e[r].context!==d)&&s.push(e[r]);s.length?this._events.set(n,s.length===1?s[0]:s):me(this,n)}return this},T.prototype.removeAllListeners=function(n){return n?this._events.delete(n)&&me(this,n):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(T.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),T}();re=De.Events=Wt;/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Ut{constructor(n,i){this.physics=n,this.ammo=i,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.impact=[],this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new Te,this.tmpQuaternion=new ie,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new re,this.name=i.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){typeof this.eventEmitter>"u"&&(this.eventEmitter=new re)}get needUpdate(){return this._needUpdate}set needUpdate(n){!n&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=n}onUpdateEvent(n,i=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,i?this.eventEmitter.once("update",()=>{n()}):this.eventEmitter.on("update",()=>{n()})}get on(){return{update:n=>this.onUpdateEvent(n),collision:n=>this.onCollision(n)}}get once(){return{update:n=>this.onUpdateEvent(n,!0)}}onCollision(n){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",i=>{const{bodies:d,event:c}=i;d[0].name===this.name?n(d[1],c):d[1].name===this.name&&n(d[0],c)})}transform(){const n=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(n)}refresh(){const n=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(n)}setRotation(n,i,d){const c=this.tmpEuler.set(n,i,d),e=this.tmpQuaternion.set(0,0,0,1);e.setFromEuler(c),this.tmpBtQuaternion.setValue(0,0,0,1);const r=this.tmpBtQuaternion;r.setValue(e.x,e.y,e.z,e.w),this.physics.worldTransform.setRotation(r)}get rotation(){let n,i,d;const e=this.physics.worldTransform.getRotation();let r=this.tmpQuaternion.set(e.x(),e.y(),e.z(),e.w());r.w>1&&(r=r.normalize());const s=2*Math.acos(r.w),o=Math.sqrt(1-r.w*r.w);return o<.001?(n=r.x,i=r.y,d=r.z):(n=r.x/o,i=r.y/o,d=r.z/o),{x:n*s,y:i*s,z:d*s}}get quaternion(){const i=this.physics.worldTransform.getRotation();return{x:i.x(),y:i.y(),z:i.z(),w:i.w()}}setPosition(n,i,d){this.physics.worldTransform.getOrigin().setValue(n,i,d)}get position(){const n=this.physics.worldTransform;return{x:n.getOrigin().x(),y:n.getOrigin().y(),z:n.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(n){this.tmpBtVector3.setValue(n,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(n){this.tmpBtVector3.setValue(this.velocity.x,n,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(n){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,n),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(n){this.tmpBtVector3.setValue(n,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(n){this.tmpBtVector3.setValue(this.angularVelocity.x,n,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(n){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,n),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(n){this.tmpBtVector3.setValue(n,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(n){this.tmpBtVector3.setValue(0,n,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(n){this.tmpBtVector3.setValue(0,0,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(n,i){this.tmpBtVector3.setValue(n.x||0,n.y||0,n.z||0),this.tmpBtVector3_1.setValue(i.x||0,i.y||0,i.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(n){this.ammo.setCollisionFlags(n)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(n){this.ammo.setRestitution(n)}setBounciness(n){this.setRestitution(n)}setFriction(n){this.ammo.setFriction(n)}setDamping(n,i){this.ammo.setDamping(n,i)}setGravity(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(n,i,d){this.tmpBtVector3.setValue(n,i,d),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(n){this.ammo.setCcdMotionThreshold(n)}setCcdSweptSphereRadius(n){this.ammo.setCcdSweptSphereRadius(n)}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Nt{constructor(n,i){this.factory=n,this.addExisting=i}addPlane(n={},i={}){const d=this.factory.add.plane(n,i);return this.addExisting(d,n),d}addSphere(n={},i={}){const d=this.factory.add.sphere(n,i);return this.addExisting(d,n),d}addBox(n={},i={}){const d=this.factory.add.box(n,i);return this.addExisting(d,n),d}addGround(n,i={}){const d=this.factory.add.ground(n,i),c={...n,mass:0,collisionFlags:1};return this.addExisting(d,c),d}addCapsule(n={},i={}){const d=this.factory.add.capsule(n,i);return this.addExisting(d,n),d}addCylinder(n={},i={}){const d=this.factory.add.cylinder(n,i);return this.addExisting(d,n),d}addCone(n={},i={}){const d=this.factory.add.cone(n,i);return this.addExisting(d,n),d}addTorus(n={},i={}){const d=this.factory.add.torus(n,i);return this.addExisting(d,n),d}addExtrude(n,i={}){const d=this.factory.add.extrude(n,i);return d.translateX(1),this.addExisting(d),d}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Gt{constructor(n,i){this.worldTransform=n,this.physicsWorld=i,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(n,i=0){return new Ammo.btVector3(typeof(n==null?void 0:n.x)<"u"?n.x:i,typeof(n==null?void 0:n.y)<"u"?n.y:i,typeof(n==null?void 0:n.z)<"u"?n.z:i)}get addConstraints(){return{lock:(n,i,d)=>this.lock(n,i,d),fixed:(n,i,d)=>this.fixed(n,i,d),pointToPoint:(n,i,d,c)=>this.pointToPoint(n,i,d,c),hinge:(n,i,d,c)=>this.hinge(n,i,d,c),slider:(n,i,d={},c)=>this.slider(n,i,d,c),spring:(n,i,d={},c)=>this.spring(n,i,d,c),coneTwist:(n,i,d={frameA:{},frameB:{}},c)=>this.coneTwist(n,i,d,c),dof:(n,i,d,c)=>this.dof(n,i,d,c)}}getTransform(n,i,d={x:0,y:0,z:0},c=!1){d={x:0,y:0,z:0,...d};const e=(s,o)=>{var h=(s.x()-o.x())/2+d.x,a=(s.y()-o.y())/2+d.y,m=(s.z()-o.z())/2+d.z;return new Ammo.btVector3(h,a,m)},r=new Ammo.btTransform;if(r.setIdentity(),c){const s=e(n.getWorldTransform().getOrigin(),i.getWorldTransform().getOrigin()),o=new Ammo.btTransform;o.setIdentity(),o.setOrigin(s);const h=n.getCenterOfMassTransform().inverse().op_mul(i.getWorldTransform());return h.op_mul(o),{transformA:h,transformB:o}}else return r.setOrigin(new Ammo.btVector3(d.x,d.y,d.z)),{transformA:n.getCenterOfMassTransform().inverse().op_mul(i.getWorldTransform()).op_mul(r),transformB:r}}lock(n,i,d=!0){const c={x:0,y:0,z:0};return this.dof(n,i,{angularLowerLimit:c,angularUpperLimit:c},d)}fixed(n,i,d=!0){const c=this.getTransform(n.ammo,i.ammo);c.transformA.setRotation(n.ammo.getWorldTransform().getRotation()),c.transformB.setRotation(i.ammo.getWorldTransform().getRotation());const e=new Ammo.btFixedConstraint(n.ammo,i.ammo,c.transformA,c.transformB);return this.physicsWorld.addConstraint(e,d),e}pointToPoint(n,i,d={},c=!0){const{pivotA:e,pivotB:r}=d,s=new Ammo.btVector3((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0),o=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),h=new Ammo.btPoint2PointConstraint(n.ammo,i.ammo,s,o);return this.physicsWorld.addConstraint(h,c),h}hinge(n,i,d={},c=!0){const{pivotA:e,pivotB:r,axisA:s,axisB:o}=d,h=new Ammo.btVector3((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0),a=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),m=new Ammo.btVector3((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),u=new Ammo.btVector3((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),t=new Ammo.btHingeConstraint(n.ammo,i.ammo,h,a,m,u,!0);return this.physicsWorld.addConstraint(t,c),t}slider(n,i,d={},c=!0){const e=this.getTransform(n.ammo,i.ammo),{frameA:r={},frameB:s={},linearLowerLimit:o=0,linearUpperLimit:h=0,angularLowerLimit:a=0,angularUpperLimit:m=0}=d,u=e.transformA.getRotation();u.setEulerZYX(r.x||0,r.y||0,r.z||0),e.transformA.setRotation(u);const t=e.transformB.getRotation();t.setEulerZYX(s.x||0,s.y||0,s.z||0),e.transformB.setRotation(t);const l=new Ammo.btSliderConstraint(n.ammo,i.ammo,e.transformA,e.transformB,!0);return l.setLowerLinLimit(o),l.setUpperLinLimit(h),l.setLowerAngLimit(a),l.setUpperAngLimit(m),this.physicsWorld.addConstraint(l,c),l}spring(n,i,d={},c=!0){const{stiffness:e=50,damping:r=.01,angularLock:s=!1,linearLowerLimit:o={},linearUpperLimit:h={},angularLowerLimit:a={},angularUpperLimit:m={},offset:u={},center:t=!1,enableSpring:l=!0}=d,f={x:0,y:0,z:0,...u},p=this.getTransform(n.ammo,i.ammo,f,t),v=new Ammo.btGeneric6DofSpringConstraint(n.ammo,i.ammo,p.transformA,p.transformB,!0);this.tmpBtVector3.setValue(o.x||0,o.y||0,o.z||0),v.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(h.x||0,h.y||0,h.z||0),v.setLinearUpperLimit(this.tmpBtVector3),s?(this.tmpBtVector3.setValue(0,0,0),v.setAngularLowerLimit(this.tmpBtVector3),v.setAngularUpperLimit(this.tmpBtVector3)):(console.log(a,m),v.setAngularLowerLimit(this.toAmmoV3(a,-Math.PI)),v.setAngularUpperLimit(this.toAmmoV3(m,Math.PI)));for(let w=0;w<3;w++)v.enableSpring(w,l),v.setStiffness(w,e),v.setDamping(w,r);return this.physicsWorld.addConstraint(v,c),v}coneTwist(n,i,d,c=!0){const{frameA:e,frameB:r}=d,s=new Ammo.btTransform;s.setIdentity(),s.getOrigin().setValue((e==null?void 0:e.x)||0,(e==null?void 0:e.y)||0,(e==null?void 0:e.z)||0);const o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),this.getTransform(n.ammo,i.ammo);const h=new Ammo.btConeTwistConstraint(i.ammo,n.ammo,s,o);return h.setAngularOnly(!0),this.physicsWorld.addConstraint(h,c),h}dof(n,i,d={},c=!0){const{offset:e,center:r=!1}=d,s={x:0,y:0,z:0,...e},o=this.getTransform(n.ammo,i.ammo,s,r),h=new Ammo.btGeneric6DofConstraint(n.ammo,i.ammo,o.transformA,o.transformB,!0),{linearLowerLimit:a,linearUpperLimit:m,angularLowerLimit:u,angularUpperLimit:t}=d,l=this.toAmmoV3(a),f=this.toAmmoV3(m),p=this.toAmmoV3(u,-Math.PI),v=this.toAmmoV3(t,Math.PI);return h.setLinearLowerLimit(l),h.setLinearUpperLimit(f),h.setAngularLowerLimit(p),h.setAngularUpperLimit(v),Ammo.destroy(l),Ammo.destroy(f),Ammo.destroy(p),Ammo.destroy(v),this.physicsWorld.addConstraint(h,c),h}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */const oe={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},ae={ALL:"all",MANUAL:"manual"},Qt=function(){const T=new I,n=new I,i=new j;return function(d,c,e,r={}){if(r.type=oe.HULL,ye(r),r.fit===ae.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;const s=ke(d,c),o=new Ammo.btVector3,h=new Ammo.btConvexHullShape;h.setMargin(r.margin),n.addVectors(s.max,s.min).multiplyScalar(.5);let a=0;for(let l=0;l<d.length;l++)a+=d[l].length/3;const m=r.hullMaxVertices||1e5;a>m&&console.warn(`too many vertices for hull shape; sampling ~${m} from ~${a} vertices`);const u=Math.min(1,m/a);for(let l=0;l<d.length;l++){const f=d[l];i.fromArray(c[l]);for(let p=0;p<f.length;p+=3){const v=l===d.length-1&&p===f.length-3;(Math.random()<=u||v)&&(T.set(f[p],f[p+1],f[p+2]).applyMatrix4(i).sub(n),o.setValue(T.x,T.y,T.z),h.addPoint(o,v))}}let t=h;if(h.getNumVertices()>=100){const l=new Ammo.btShapeHull(h);l.buildHull(r.margin),Ammo.destroy(h),t=new Ammo.btConvexHullShape(Ammo.getPointer(l.getVertexPointer()),l.numVertices()),Ammo.destroy(l)}return Ammo.destroy(o),xe(t,r,we(e,r)),t}}(),Xt=function(){const T=new I,n=new I,i=new j;return function(d,c,e,r,s={}){if(s.type=oe.HACD,ye(s),s.fit===ae.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const o=ke(d,c);we(r,s);let h=0,a=0;n.addVectors(o.max,o.min).multiplyScalar(.5);for(let w=0;w<d.length;w++)h+=d[w].length/3,e&&e[w]?a+=e[w].length/3:a+=d[w].length/9;const m=new Ammo.HACD;s.hasOwnProperty("compacityWeight")&&m.SetCompacityWeight(s.compacityWeight),s.hasOwnProperty("volumeWeight")&&m.SetVolumeWeight(s.volumeWeight),s.hasOwnProperty("nClusters")&&m.SetNClusters(s.nClusters),s.hasOwnProperty("nVerticesPerCH")&&m.SetNVerticesPerCH(s.nVerticesPerCH),s.hasOwnProperty("concavity")&&m.SetConcavity(s.concavity);const u=Ammo._malloc(h*3*8),t=Ammo._malloc(a*3*4);m.SetPoints(u),m.SetTriangles(t),m.SetNPoints(h),m.SetNTriangles(a);let l=u/8,f=t/4;for(let w=0;w<d.length;w++){const P=d[w];i.fromArray(c[w]);for(let M=0;M<P.length;M+=3)T.set(P[M+0],P[M+1],P[M+2]).applyMatrix4(i).sub(n),Ammo.HEAPF64[l+0]=T.x,Ammo.HEAPF64[l+1]=T.y,Ammo.HEAPF64[l+2]=T.z,l+=3;if(e[w]){const M=e[w];for(let g=0;g<M.length;g++)Ammo.HEAP32[f]=M[g],f++}else for(let M=0;M<P.length/3;M++)Ammo.HEAP32[f]=M,f++}m.Compute(),Ammo._free(u),Ammo._free(t);const p=m.GetNClusters(),v=[];for(let w=0;w<p;w++){const P=new Ammo.btConvexHullShape;P.setMargin(s.margin);const M=m.GetNPointsCH(w),g=m.GetNTrianglesCH(w),y=Ammo._malloc(M*3*8),S=Ammo._malloc(g*3*4);m.GetCH(w,y,S);const x=y/8;for(let A=0;A<M;A++){const C=new Ammo.btVector3,b=Ammo.HEAPF64[x+A*3+0],V=Ammo.HEAPF64[x+A*3+1],E=Ammo.HEAPF64[x+A*3+2];C.setValue(b,V,E),P.addPoint(C,A===M-1),Ammo.destroy(C)}xe(),v.push(P)}return v}}(),$t=function(){const T=new I,n=new I,i=new j;return function(d,c,e,r,s={}){if(s.type=oe.VHACD,ye(s),s.fit===ae.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const o=ke(d,c);we(r,s);let h=0,a=0;n.addVectors(o.max,o.min).multiplyScalar(.5);for(let M=0;M<d.length;M++)h+=d[M].length/3,e&&e[M]?a+=e[M].length/3:a+=d[M].length/9;const m=new Ammo.VHACD,u=new Ammo.Parameters;s.hasOwnProperty("resolution")&&u.set_m_resolution(s.resolution),s.hasOwnProperty("depth")&&u.set_m_depth(s.depth),s.hasOwnProperty("concavity")&&u.set_m_concavity(s.concavity),s.hasOwnProperty("planeDownsampling")&&u.set_m_planeDownsampling(s.planeDownsampling),s.hasOwnProperty("convexhullDownsampling")&&u.set_m_convexhullDownsampling(s.convexhullDownsampling),s.hasOwnProperty("alpha")&&u.set_m_alpha(s.alpha),s.hasOwnProperty("beta")&&u.set_m_beta(s.beta),s.hasOwnProperty("gamma")&&u.set_m_gamma(s.gamma),s.hasOwnProperty("pca")&&u.set_m_pca(s.pca),s.hasOwnProperty("mode")&&u.set_m_mode(s.mode),s.hasOwnProperty("maxNumVerticesPerCH")&&u.set_m_maxNumVerticesPerCH(s.maxNumVerticesPerCH),s.hasOwnProperty("minVolumePerCH")&&u.set_m_minVolumePerCH(s.minVolumePerCH),s.hasOwnProperty("convexhullApproximation")&&u.set_m_convexhullApproximation(s.convexhullApproximation),s.hasOwnProperty("oclAcceleration")&&u.set_m_oclAcceleration(s.oclAcceleration);const t=Ammo._malloc(h*3*8+3),l=Ammo._malloc(a*3*4);let f=t/8,p=l/4;for(let M=0;M<d.length;M++){const g=d[M];i.fromArray(c[M]);for(let y=0;y<g.length;y+=3)T.set(g[y+0],g[y+1],g[y+2]).applyMatrix4(i).sub(n),Ammo.HEAPF64[f+0]=T.x,Ammo.HEAPF64[f+1]=T.y,Ammo.HEAPF64[f+2]=T.z,f+=3;if(e[M]){const y=e[M];for(let S=0;S<y.length;S++)Ammo.HEAP32[p]=y[S],p++}else for(let y=0;y<g.length/3;y++)Ammo.HEAP32[p]=y,p++}m.Compute(t,3,h,l,3,a,u),Ammo._free(t),Ammo._free(l);const v=m.GetNConvexHulls(),w=[],P=new Ammo.ConvexHull;for(let M=0;M<v;M++){m.GetConvexHull(M,P);const g=P.get_m_nPoints();P.get_m_points();const y=new Ammo.btConvexHullShape;y.setMargin(s.margin);for(let S=0;S<g;S++){const x=new Ammo.btVector3,A=P.get_m_points(S*3+0),C=P.get_m_points(S*3+1),b=P.get_m_points(S*3+2);x.setValue(A,C,b),y.addPoint(x,S===g-1),Ammo.destroy(x)}xe(),w.push(y)}return Ammo.destroy(P),Ammo.destroy(m),w}}(),Ae=function(){const T=new I,n=new I,i=new I,d=new j;return function(c,e,r,s,o={}){if(o.type=oe.MESH,ye(o),o.fit===ae.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;const h=we(s,o),a=new Ammo.btVector3,m=new Ammo.btVector3,u=new Ammo.btVector3,t=new Ammo.btTriangleMesh(!0,!1);for(let p=0;p<c.length;p++){const v=c[p],w=r[p]?r[p]:null;if(d.fromArray(e[p]),w)for(let P=0;P<w.length;P+=3){const M=w[P]*3,g=w[P+1]*3,y=w[P+2]*3;T.set(v[M],v[M+1],v[M+2]).applyMatrix4(d),n.set(v[g],v[g+1],v[g+2]).applyMatrix4(d),i.set(v[y],v[y+1],v[y+2]).applyMatrix4(d),a.setValue(T.x,T.y,T.z),m.setValue(n.x,n.y,n.z),u.setValue(i.x,i.y,i.z),t.addTriangle(a,m,u,!1)}else for(let P=0;P<v.length;P+=9)T.set(v[P+0],v[P+1],v[P+2]).applyMatrix4(d),n.set(v[P+3],v[P+4],v[P+5]).applyMatrix4(d),i.set(v[P+6],v[P+7],v[P+8]).applyMatrix4(d),a.setValue(T.x,T.y,T.z),m.setValue(n.x,n.y,n.z),u.setValue(i.x,i.y,i.z),t.addTriangle(a,m,u,!1)}const l=new Ammo.btVector3(h.x,h.y,h.z);t.setScaling(l),Ammo.destroy(l);let f;return o.concave?f=new Ammo.btBvhTriangleMeshShape(t,!0,!0):f=new Ammo.btConvexTriangleMeshShape(t,!0),f.resources=[t],Ammo.destroy(a),Ammo.destroy(m),Ammo.destroy(u),xe(),f}}();function ye(T){T.type=T.type||oe.HULL,T.margin=T.hasOwnProperty("margin")?T.margin:.01}const xe=function(T,n,i){},Zt=function(){const T=new j;return function(n,i,d){parseInt(et)>=123?T.copy(n.matrixWorld).invert():T.getInverse(n.matrixWorld),new I().setFromMatrixScale(n.matrixWorld),n.traverse(e=>{const r=new j;e.isMesh&&(i.includeInvisible||e.el&&e.el.object3D.visible||e.visible)&&(e===n?r.identity():(e.updateWorldMatrix(!0),r.multiplyMatrices(T,e.matrixWorld)),d(e.geometry.isBufferGeometry?e.geometry.attributes.position.array:e.geometry.vertices,r.elements,e.geometry.index?e.geometry.index.array:null))})}}(),we=function(){const T=new j;return function(n,i={}){const d=new I(1,1,1);return i.fit===ae.ALL&&(T.fromArray(n),d.setFromMatrixScale(T)),d}}();(function(){const T=new I;return function(n,i,d){let c=0,{x:e,y:r,z:s}=d.getCenter(T);return st(n,i,o=>{const h=e-o.x,a=r-o.y,m=s-o.z;c=Math.max(c,h*h+a*a+m*m)}),Math.sqrt(c)}})();const ke=function(T,n){const i=new tt;let d=1/0,c=1/0,e=1/0,r=-1/0,s=-1/0,o=-1/0;return i.min.set(0,0,0),i.max.set(0,0,0),st(T,n,h=>{h.x<d&&(d=h.x),h.y<c&&(c=h.y),h.z<e&&(e=h.z),h.x>r&&(r=h.x),h.y>s&&(s=h.y),h.z>o&&(o=h.z)}),i.min.set(d,c,e),i.max.set(r,s,o),i},st=function(){const T=new I,n=new j;return function(i,d,c){for(let e=0;e<i.length;e++){n.fromArray(d[e]);for(let r=0;r<i[e].length;r+=3)T.set(i[e][r],i[e][r+1],i[e][r+2]).applyMatrix4(n),c(T)}}}();/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */const Yt=(T,n)=>{const{radius:i=1,tube:d=.4,tubularSegments:c=8}=T,e=Math.PI,r=c,s=Math.sqrt(2*d*d-2*d*d*Math.cos(2*e/r)),o=new Ammo.btVector3(d,e/r+.5*s,d),h=new Ammo.btCylinderShape(o);h.setMargin(.05);const a=new Ammo.btCompoundShape,m=new Ammo.btVector3(0,0,1),u=new Ammo.btVector3(0,i,0),t=new Ammo.btQuaternion(n.x,n.y,n.z,n.w);for(let l=0;l<r;l++){const f=l*2*e/r,p=u.rotate(m,f),v=new Ammo.btTransform;t.setRotation(m,f+Math.PI/2),v.setIdentity(),v.setOrigin(p),v.setRotation(t),a.addChildShape(v,h)}return a};/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class Kt extends re{addCollider(n,i,d){!n.body||!i.body||(n.body.checkCollisions=!0,i.body.checkCollisions=!0,this.on("collision",c=>{var s,o;const{bodies:e,event:r}=c;(s=e[0])!=null&&s.name&&((o=e[1])!=null&&o.name)&&(n!=null&&n.name)&&(i!=null&&i.name)&&(e[0].name===n.name&&e[1].name===i.name||e[1].name===n.name&&e[0].name===i.name)&&d(r)}))}}/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */const Xe={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295};class Jt{constructor(n,i,d={}){this.scene=n,this.world=i,this.options=d,this.debugDrawMode=d.debugDrawMode||Xe.DrawWireframe;const c=this.debugDrawMode&Xe.DrawOnTop||!1,e=d.maxBufferSize||1e6;this.geometry=new Ee;const r=new Float32Array(e*3),s=new Float32Array(e*3);this.geometry.setAttribute("position",new We(r,3).setUsage(Ue)),this.geometry.setAttribute("color",new We(s,3).setUsage(Ue)),this.index=0;const o=new _e({vertexColors:!0,depthTest:!c});this.mesh=new Dt(this.geometry,o),c&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){this.enabled&&(this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(n,i,d){const c=Ammo.HEAPF32,e=c[(d+0)/4],r=c[(d+4)/4],s=c[(d+8)/4],o=c[(n+0)/4],h=c[(n+4)/4],a=c[(n+8)/4];this.geometry.attributes.position.setXYZ(this.index,o,h,a),this.geometry.attributes.color.setXYZ(this.index++,e,r,s);const m=c[(i+0)/4],u=c[(i+4)/4],t=c[(i+8)/4];this.geometry.attributes.position.setXYZ(this.index,m,u,t),this.geometry.attributes.color.setXYZ(this.index++,e,r,s)}drawContactPoint(n,i,d,c,e){const r=Ammo.HEAPF32,s=r[(e+0)/4],o=r[(e+4)/4],h=r[(e+8)/4],a=r[(n+0)/4],m=r[(n+4)/4],u=r[(n+8)/4];this.geometry.attributes.position.setXYZ(this.index,a,m,u),this.geometry.attributes.color.setXYZ(this.index++,s,o,h);const t=r[(i+0)/4]*d,l=r[(i+4)/4]*d,f=r[(i+8)/4]*d;this.geometry.attributes.position.setXYZ(this.index,a+t,m+l,u+f),this.geometry.attributes.color.setXYZ(this.index++,s,o,h)}reportErrorWarning(n){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(n)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(n,i){console.warn("TODO: draw3dText")}setDebugMode(n){this.debugDrawMode=n}getDebugMode(){return this.debugDrawMode}}const ge=0,jt=1,qt=new I,$e=new nt,Me=new pe,Ze=new I,de=new kt;class _t{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Ye,this.unassigned=new Ye,this.vertices=[]}setFromPoints(n){if(n.length>=4){this.makeEmpty();for(let i=0,d=n.length;i<d;i++)this.vertices.push(new en(n[i]));this.compute()}return this}setFromObject(n){const i=[];return n.updateMatrixWorld(!0),n.traverse(function(d){const c=d.geometry;if(c!==void 0){const e=c.attributes.position;if(e!==void 0)for(let r=0,s=e.count;r<s;r++){const o=new I;o.fromBufferAttribute(e,r).applyMatrix4(d.matrixWorld),i.push(o)}}}),this.setFromPoints(i)}containsPoint(n){const i=this.faces;for(let d=0,c=i.length;d<c;d++)if(i[d].distanceToPoint(n)>this.tolerance)return!1;return!0}intersectRay(n,i){const d=this.faces;let c=-1/0,e=1/0;for(let r=0,s=d.length;r<s;r++){const o=d[r],h=o.distanceToPoint(n.origin),a=o.normal.dot(n.direction);if(h>0&&a>=0)return null;const m=a!==0?-h/a:0;if(!(m<=0)&&(a>0?e=Math.min(m,e):c=Math.max(m,c),c>e))return null}return c!==-1/0?n.at(c,i):n.at(e,i),i}intersectsRay(n){return this.intersectRay(n,qt)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(n,i){return n.face=i,i.outside===null?this.assigned.append(n):this.assigned.insertBefore(i.outside,n),i.outside=n,this}removeVertexFromFace(n,i){return n===i.outside&&(n.next!==null&&n.next.face===i?i.outside=n.next:i.outside=null),this.assigned.remove(n),this}removeAllVerticesFromFace(n){if(n.outside!==null){const i=n.outside;let d=n.outside;for(;d.next!==null&&d.next.face===n;)d=d.next;return this.assigned.removeSubList(i,d),i.prev=d.next=null,n.outside=null,i}}deleteFaceVertices(n,i){const d=this.removeAllVerticesFromFace(n);if(d!==void 0)if(i===void 0)this.unassigned.appendChain(d);else{let c=d;do{const e=c.next;i.distanceToPoint(c.point)>this.tolerance?this.addVertexToFace(c,i):this.unassigned.append(c),c=e}while(c!==null)}return this}resolveUnassignedPoints(n){if(this.unassigned.isEmpty()===!1){let i=this.unassigned.first();do{const d=i.next;let c=this.tolerance,e=null;for(let r=0;r<n.length;r++){const s=n[r];if(s.mark===ge){const o=s.distanceToPoint(i.point);if(o>c&&(c=o,e=s),c>1e3*this.tolerance)break}}e!==null&&this.addVertexToFace(i,e),i=d}while(i!==null)}return this}computeExtremes(){const n=new I,i=new I,d=[],c=[];for(let e=0;e<3;e++)d[e]=c[e]=this.vertices[0];n.copy(this.vertices[0].point),i.copy(this.vertices[0].point);for(let e=0,r=this.vertices.length;e<r;e++){const s=this.vertices[e],o=s.point;for(let h=0;h<3;h++)o.getComponent(h)<n.getComponent(h)&&(n.setComponent(h,o.getComponent(h)),d[h]=s);for(let h=0;h<3;h++)o.getComponent(h)>i.getComponent(h)&&(i.setComponent(h,o.getComponent(h)),c[h]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(i.x))+Math.max(Math.abs(n.y),Math.abs(i.y))+Math.max(Math.abs(n.z),Math.abs(i.z))),{min:d,max:c}}computeInitialHull(){const n=this.vertices,i=this.computeExtremes(),d=i.min,c=i.max;let e=0,r=0;for(let u=0;u<3;u++){const t=c[u].point.getComponent(u)-d[u].point.getComponent(u);t>e&&(e=t,r=u)}const s=d[r],o=c[r];let h,a;e=0,$e.set(s.point,o.point);for(let u=0,t=this.vertices.length;u<t;u++){const l=n[u];if(l!==s&&l!==o){$e.closestPointToPoint(l.point,!0,Ze);const f=Ze.distanceToSquared(l.point);f>e&&(e=f,h=l)}}e=-1,Me.setFromCoplanarPoints(s.point,o.point,h.point);for(let u=0,t=this.vertices.length;u<t;u++){const l=n[u];if(l!==s&&l!==o&&l!==h){const f=Math.abs(Me.distanceToPoint(l.point));f>e&&(e=f,a=l)}}const m=[];if(Me.distanceToPoint(a.point)<0){m.push(J.create(s,o,h),J.create(a,o,s),J.create(a,h,o),J.create(a,s,h));for(let u=0;u<3;u++){const t=(u+1)%3;m[u+1].getEdge(2).setTwin(m[0].getEdge(t)),m[u+1].getEdge(1).setTwin(m[t+1].getEdge(0))}}else{m.push(J.create(s,h,o),J.create(a,s,o),J.create(a,o,h),J.create(a,h,s));for(let u=0;u<3;u++){const t=(u+1)%3;m[u+1].getEdge(2).setTwin(m[0].getEdge((3-u)%3)),m[u+1].getEdge(0).setTwin(m[t+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(m[u]);for(let u=0,t=n.length;u<t;u++){const l=n[u];if(l!==s&&l!==o&&l!==h&&l!==a){e=this.tolerance;let f=null;for(let p=0;p<4;p++){const v=this.faces[p].distanceToPoint(l.point);v>e&&(e=v,f=this.faces[p])}f!==null&&this.addVertexToFace(l,f)}}return this}reindexFaces(){const n=[];for(let i=0;i<this.faces.length;i++){const d=this.faces[i];d.mark===ge&&n.push(d)}return this.faces=n,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let n,i=0;const d=this.assigned.first().face;let c=d.outside;do{const e=d.distanceToPoint(c.point);e>i&&(i=e,n=c),c=c.next}while(c!==null&&c.face===d);return n}}computeHorizon(n,i,d,c){this.deleteFaceVertices(d),d.mark=jt;let e;i===null?e=i=d.getEdge(0):e=i.next;do{const r=e.twin,s=r.face;s.mark===ge&&(s.distanceToPoint(n)>this.tolerance?this.computeHorizon(n,r,s,c):c.push(e)),e=e.next}while(e!==i);return this}addAdjoiningFace(n,i){const d=J.create(n,i.tail(),i.head());return this.faces.push(d),d.getEdge(-1).setTwin(i.twin),d.getEdge(0)}addNewFaces(n,i){this.newFaces=[];let d=null,c=null;for(let e=0;e<i.length;e++){const r=i[e],s=this.addAdjoiningFace(n,r);d===null?d=s:s.next.setTwin(c),this.newFaces.push(s.face),c=s}return d.next.setTwin(c),this}addVertexToHull(n){const i=[];return this.unassigned.clear(),this.removeVertexFromFace(n,n.face),this.computeHorizon(n.point,null,n.face,i),this.addNewFaces(n,i),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let n;for(this.computeInitialHull();(n=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(n);return this.reindexFaces(),this.cleanup(),this}}class J{constructor(){this.normal=new I,this.midpoint=new I,this.area=0,this.constant=0,this.outside=null,this.mark=ge,this.edge=null}static create(n,i,d){const c=new J,e=new be(n,c),r=new be(i,c),s=new be(d,c);return e.next=s.prev=r,r.next=e.prev=s,s.next=r.prev=e,c.edge=e,c.compute()}getEdge(n){let i=this.edge;for(;n>0;)i=i.next,n--;for(;n<0;)i=i.prev,n++;return i}compute(){const n=this.edge.tail(),i=this.edge.head(),d=this.edge.next.head();return de.set(n.point,i.point,d.point),de.getNormal(this.normal),de.getMidpoint(this.midpoint),this.area=de.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(n){return this.normal.dot(n)-this.constant}}class be{constructor(n,i){this.vertex=n,this.prev=null,this.next=null,this.twin=null,this.face=i}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const n=this.head(),i=this.tail();return i!==null?i.point.distanceTo(n.point):-1}lengthSquared(){const n=this.head(),i=this.tail();return i!==null?i.point.distanceToSquared(n.point):-1}setTwin(n){return this.twin=n,n.twin=this,this}}class en{constructor(n){this.point=n,this.prev=null,this.next=null,this.face=null}}class Ye{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(n,i){return i.prev=n.prev,i.next=n,i.prev===null?this.head=i:i.prev.next=i,n.prev=i,this}insertAfter(n,i){return i.prev=n,i.next=n.next,i.next===null?this.tail=i:i.next.prev=i,n.next=i,this}append(n){return this.head===null?this.head=n:this.tail.next=n,n.prev=this.tail,n.next=null,this.tail=n,this}appendChain(n){for(this.head===null?this.head=n:this.tail.next=n,n.prev=this.tail;n.next!==null;)n=n.next;return this.tail=n,this}remove(n){return n.prev===null?this.head=n.next:n.prev.next=n.next,n.next===null?this.tail=n.prev:n.next.prev=n.prev,this}removeSubList(n,i){return n.prev===null?this.head=i.next:n.prev.next=i.next,i.next===null?this.tail=n.prev:i.next.prev=n.prev,this}isEmpty(){return this.head===null}}class tn extends Ee{constructor(n=[]){super();const i=[],d=[],e=new _t().setFromPoints(n).faces;for(let r=0;r<e.length;r++){const s=e[r];let o=s.edge;do{const h=o.head().point;i.push(h.x,h.y,h.z),d.push(s.normal.x,s.normal.y,s.normal.z),o=o.next}while(o!==s.edge)}this.setAttribute("position",new Ne(i,3)),this.setAttribute("normal",new Ne(d,3))}}const Ke=T=>{const n=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:tn;return new n(T)},q=function(T,n){this.minSizeForBreak=T||1.4,this.smallDelta=n||1e-4,this.tempLine1=new nt,this.tempPlane1=new pe,this.tempPlane2=new pe,this.tempPlane_Cut=new pe,this.tempCM1=new I,this.tempCM2=new I,this.tempVector3=new I,this.tempVector3_2=new I,this.tempVector3_3=new I,this.tempVector3_P0=new I,this.tempVector3_P1=new I,this.tempVector3_P2=new I,this.tempVector3_N0=new I,this.tempVector3_N1=new I,this.tempVector3_AB=new I,this.tempVector3_CB=new I,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var i=30*30,d=0;d<i;d++)this.segments[d]=!1};q.prototype={constructor:q,prepareBreakableObject:function(T,n,i,d,c){T.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),T.userData.ammoPhysicsData={};var e=T.userData.ammoPhysicsData;e.mass=n,e.velocity=i.clone(),e.angularVelocity=d.clone(),e.breakable=c},subdivideByImpact:function(T,n,i,d,c){var e=[],r=this.tempPlane1,s=this.tempPlane2;this.tempVector3.addVectors(n,i),r.setFromCoplanarPoints(n,T.position,this.tempVector3);var o=c+d,h=this;function a(m,u,t,l){if(Math.random()<l*.05||l>o){e.push(m);return}var f=Math.PI;l===0?(s.normal.copy(r.normal),s.constant=r.constant):l<=d?(f=(t-u)*(.2+.6*Math.random())+u,h.tempVector3_2.copy(T.position).sub(n).applyAxisAngle(i,f).add(n),s.setFromCoplanarPoints(n,h.tempVector3,h.tempVector3_2)):(f=(.5*(l&1)+.2*(2-Math.random()))*Math.PI,h.tempVector3_2.copy(n).sub(m.position).applyAxisAngle(i,f).add(m.position),h.tempVector3_3.copy(i).add(m.position),s.setFromCoplanarPoints(m.position,h.tempVector3_3,h.tempVector3_2)),h.cutByPlane(m,s,h.tempResultObjects);var p=h.tempResultObjects.object1,v=h.tempResultObjects.object2;p&&a(p,u,f,l+1),v&&a(v,f,t,l+1)}return a(T,0,2*Math.PI,0),e},cutByPlane:function(T,n,i){var d=T.geometry,c=d.attributes.position.array,e=d.attributes.normal.array,r=c.length/3,s=r/3,o=d.getIndex();o&&(o=o.array,s=o.length/3);function h(N,Se){var le=N*3+Se;return o?o[le]:le}for(var a=[],m=[],u=this.smallDelta,t=r*r,l=0;l<t;l++)this.segments[l]=!1;for(var f=this.tempVector3_P0,p=this.tempVector3_P1,v=this.tempVector3_N0,w=this.tempVector3_N1,l=0;l<s-1;l++){var P=h(l,0),M=h(l,1),g=h(l,2);v.set(e[P],e[P]+1,e[P]+2);for(var y=l+1;y<s;y++){var S=h(y,0),x=h(y,1),A=h(y,2);w.set(e[S],e[S]+1,e[S]+2);var C=1-v.dot(w)<u;C&&(P===S||P===x||P===A?M===S||M===x||M===A?(this.segments[P*r+M]=!0,this.segments[M*r+P]=!0):(this.segments[g*r+P]=!0,this.segments[P*r+g]=!0):(M===S||M===x||M===A)&&(this.segments[g*r+M]=!0,this.segments[M*r+g]=!0))}}var b=this.tempPlane_Cut;T.updateMatrix(),q.transformPlaneToLocalSpace(n,T.matrix,b);for(var l=0;l<s;l++)for(var V=h(l,0),E=h(l,1),B=h(l,2),D=0;D<3;D++){var L=D===0?V:D===1?E:B,k=D===0?E:D===1?B:V,R=this.segments[L*r+k];if(!R){this.segments[L*r+k]=!0,this.segments[k*r+L]=!0,f.set(c[3*L],c[3*L+1],c[3*L+2]),p.set(c[3*k],c[3*k+1],c[3*k+2]);var O=0,H=b.distanceToPoint(f);H>u?(O=2,m.push(f.clone())):H<-u?(O=1,a.push(f.clone())):(O=3,a.push(f.clone()),m.push(f.clone()));var z=0,H=b.distanceToPoint(p);if(H>u?(z=2,m.push(p.clone())):H<-u?(z=1,a.push(p.clone())):(z=3,a.push(p.clone()),m.push(p.clone())),O===1&&z===2||O===2&&z===1){this.tempLine1.start.copy(f),this.tempLine1.end.copy(p);var W=new I;if(W=b.intersectLine(this.tempLine1,W),W===void 0)return console.error("Internal error: segment does not intersect plane."),i.segmentedObject1=null,i.segmentedObject2=null,0;a.push(W),m.push(W.clone())}}}var G=T.userData.ammoPhysicsData.mass*.5;this.tempCM1.set(0,0,0);var Y=0,Q=a.length;if(Q>0){for(var l=0;l<Q;l++)this.tempCM1.add(a[l]);this.tempCM1.divideScalar(Q);for(var l=0;l<Q;l++){var F=a[l];F.sub(this.tempCM1),Y=Math.max(Y,F.x,F.y,F.z)}this.tempCM1.add(T.position)}this.tempCM2.set(0,0,0);var $=0,U=m.length;if(U>0){for(var l=0;l<U;l++)this.tempCM2.add(m[l]);this.tempCM2.divideScalar(U);for(var l=0;l<U;l++){var F=m[l];F.sub(this.tempCM2),$=Math.max($,F.x,F.y,F.z)}this.tempCM2.add(T.position)}var K=null,X=null,Z=0;if(Q>4)try{K=new Ve(Ke(a),T.material),K.position.copy(this.tempCM1),K.quaternion.copy(T.quaternion),K.userData=T.userData,this.prepareBreakableObject(K,G,T.userData.ammoPhysicsData.velocity,T.userData.ammoPhysicsData.angularVelocity,2*Y>this.minSizeForBreak),Z++}catch(N){ee("Error in ConvexObjectBreaker.ts",!0),ee(N,!0)}if(U>4)try{X=new Ve(Ke(m),T.material),X.position.copy(this.tempCM2),X.quaternion.copy(T.quaternion),X.userData=T.userData,this.prepareBreakableObject(X,G,T.userData.ammoPhysicsData.velocity,T.userData.ammoPhysicsData.angularVelocity,2*$>this.minSizeForBreak),Z++}catch(N){ee("Error in ConvexObjectBreaker.ts",!0),ee(N,!0)}return i.object1=K,i.object2=X,Z}};q.transformFreeVector=function(T,n){var i=T.x,d=T.y,c=T.z,e=n.elements;return T.x=e[0]*i+e[4]*d+e[8]*c,T.y=e[1]*i+e[5]*d+e[9]*c,T.z=e[2]*i+e[6]*d+e[10]*c,T};q.transformFreeVectorInverse=function(T,n){var i=T.x,d=T.y,c=T.z,e=n.elements;return T.x=e[0]*i+e[1]*d+e[2]*c,T.y=e[4]*i+e[5]*d+e[6]*c,T.z=e[8]*i+e[9]*d+e[10]*c,T};q.transformTiedVectorInverse=function(T,n){var i=T.x,d=T.y,c=T.z,e=n.elements;return T.x=e[0]*i+e[1]*d+e[2]*c-e[12],T.y=e[4]*i+e[5]*d+e[6]*c-e[13],T.z=e[8]*i+e[9]*d+e[10]*c-e[14],T};q.transformPlaneToLocalSpace=function(){var T=new I;return function(i,d,c){c.normal.copy(i.normal),c.constant=i.constant;var e=q.transformTiedVectorInverse(i.coplanarPoint(T),d);q.transformFreeVectorInverse(c.normal,d),c.constant=-e.dot(c.normal)}}();const nn=(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const T=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(T instanceof WebAssembly.Module)return new WebAssembly.Instance(T)instanceof WebAssembly.Instance}}catch(T){T instanceof Error&&console.error(T.message)}return!1})(),Je=(T,n)=>{var i=document.createElement("script");i.onload=()=>{n()},i.onerror=()=>{throw new Error(`failed to load ${T}`)},i.async=!0,i.src=T,document.head.appendChild(i)},sn=(T,n)=>{nn?Je(`${T}/ammo.wasm.js`,()=>n()):Je(`${T}/ammo.js`,()=>n())},vn=(T,n)=>{typeof window<"u"&&(window.__loadPhysics=!0),sn(T,()=>{Ammo().then(()=>{n()})})};function rt(T,n){n.forEach(i=>{Object.getOwnPropertyNames(i.prototype).forEach(d=>{Object.defineProperty(T.prototype,d,Object.getOwnPropertyDescriptor(i.prototype,d)||Object.create(null))})})}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class rn{constructor(n){this.physics=n}getHitPointWorld(){const n=this._btRayCallback.get_m_hitPointWorld();return{x:n.x(),y:n.y(),z:n.z()}}getHitNormalWorld(){const n=this._btRayCallback.get_m_hitNormalWorld();return{x:n.x(),y:n.y(),z:n.z()}}getCollisionObject(){return Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody).threeObject}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class on{constructor(n){this.physics=n}getHitPointsWorld(){const n=this._btRayCallback.get_m_hitPointWorld(),i=[];for(let d=n.size()-1;d>=0;d--){const c=n.at(d);i.push({x:c.x(),y:c.y(),z:c.z()})}return i}getHitPointWorld(){return ee("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){const n=this._btRayCallback.get_m_hitNormalWorld(),i=[];for(let d=n.size()-1;d>=0;d--){const c=n.at(d);i.push({x:c.x(),y:c.y(),z:c.z()})}return i}getCollisionObjects(){const n=[],i=this._btRayCallback.get_m_collisionObjects();for(let d=i.size()-1;d>=0;d--){const c=Ammo.castObject(i.at(d),Ammo.btRigidBody);n.push(c.threeObject)}return n}}/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class ot{constructor(n){this.physics=n}setRayFromWorld(n=0,i=0,d=0){this._btRayFrom.setValue(n,i,d)}setRayToWorld(n=0,i=0,d=0){this._btRayTo.setValue(n,i,d)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback),this._btRayCallback=this.type==="closest"?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){typeof this._btRayFrom<"u"&&Ammo.destroy(this._btRayFrom),typeof this._btRayTo<"u"&&Ammo.destroy(this._btRayTo),typeof this._btRayCallback<"u"&&Ammo.destroy(this._btRayCallback)}}class at{constructor(n){this.physics=n,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}class lt{constructor(n){this.physics=n,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}}rt(at,[ot,rn]);rt(lt,[ot,on]);/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */class yn extends re{constructor(n,i={}){super(),this.scene=n,this.config=i,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=i.gravity||{x:0,y:-9.81,z:0},this.isHeadless=n==="headless",this.tmpEuler=new Te,this.tmpQuaternion=new ie,this.tmpVector3=new I,this.tmpVector3a=new I,this.tmpMatrix4=new j,this.tmpMatrix4a=new j,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new I,this.impactPoint=new I,this.impactNormal=new I,n!=="headless"&&(this.defaultMaterial=new it),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(n){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=n}destroy(n){var e;const i=Object.keys(n).includes("body")?n.body:n;if(typeof(i==null?void 0:i.ammo)>"u")return;let d=i.ammo.threeObject;const c=d.name;if(c&&d&&(e=d==null?void 0:d.body)!=null&&e.ammo){d.body.isSoftBody?this.physicsWorld.removeSoftBody(d.body.ammo):this.physicsWorld.removeRigidBody(d.body.ammo),d.body.destructor(),d.body=void 0,d.hasBody=!1,delete i.ammo.threeObject;for(let r=0;r<this.rigidBodies.length;r++)this.rigidBodies[r].name===c&&(this.rigidBodies.splice(r,1),r--)}this.scene==="headless"&&d&&(d=null)}setup(){if(this.worldTransform=new Ammo.btTransform,typeof this.config.setupPhysicsWorld=="function"?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new q,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let n=0;n<500;n++)this.objectsToRemove[n]=null}this.collisionEvents=new Kt,this.factory=new Ot(this.scene),this.shapes=new Nt(this.factory,(n,i)=>this.addExisting(n,i)),this.constraints=new Gt(this.worldTransform,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new Jt(this.scene,this.physicsWorld,{}))}updateDebugger(){this.scene!=="headless"&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){const n=this.gravity,{softBodies:i=!1}=this.config;let d;if(!i){const c=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(c),r=new Ammo.btDbvtBroadphase,s=new Ammo.btSequentialImpulseConstraintSolver;d=new Ammo.btDiscreteDynamicsWorld(e,r,s,c)}if(i){const c=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,e=new Ammo.btCollisionDispatcher(c),r=new Ammo.btDbvtBroadphase,s=new Ammo.btSequentialImpulseConstraintSolver,o=new Ammo.btDefaultSoftBodySolver;d=new Ammo.btSoftRigidDynamicsWorld(e,r,s,c,o)}return d.setGravity(new Ammo.btVector3(n.x,n.y,n.z)),d}createDebrisFromBreakableObject(n,i){this.scene!=="headless"&&(n.material=i.material,n.shape="hull",n.fragmentDepth=i.fragmentDepth+1,n.name=`${i.name}__DEBRIS_${n.id}`,this.scene.add(n),this.addExisting(n,{autoCenter:!0}),n.body.fractureImpulse=i.body.fractureImpulse,n.body.breakable=!1,setTimeout(()=>{n.body.breakable=!0},2500))}removeDebris(n){this.scene!=="headless"&&(this.scene.remove(n),this.destroy(n))}update(n){this.updatePhysics(n),this.detectCollisions()}updatePhysics(n){const i=n/1e3;this.physicsWorld.stepSimulation(i,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let d=0;d<this.rigidBodies.length;d++){const c=this.rigidBodies[d];c.body.impact=[];const r=c.body.ammo.getMotionState();if(r){if(r.getWorldTransform(this.worldTransform),c.body.didUpdate&&(c.body._emitUpdateEvents&&c.body.eventEmitter.emit("update"),c.body.didUpdate=!1),c.body.ammo.isKinematicObject()&&c.body.needUpdate)c.getWorldQuaternion(this.tmpQuaternion),c.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),r.setWorldTransform(this.worldTransform),c.body.needUpdate=!1;else if(!c.body.skipUpdate){if(!c.body.ammo.isStaticObject()){const s=this.worldTransform.getOrigin(),o=this.worldTransform.getRotation(),h=c.body.offset;if(c.body.ignoreScale)this.tmpVector3a.set(c.scale.x,c.scale.y,c.scale.z);else{const a=c.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(a.x(),a.y(),a.z())}this.tmpVector3.set(s.x()+h.x,s.y()+h.y,s.z()+h.z),this.tmpQuaternion.set(o.x(),o.y(),o.z(),o.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),c.parent?parseInt(et)>=123?this.tmpMatrix4a.copy(c.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(c.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(c.position,c.quaternion,c.scale)}}}}}detectCollisions(){var c,e;const n=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);const i=this.physicsWorld.getDispatcher(),d=i.getNumManifolds();for(let r=0;r<d;r++){const s=i.getManifoldByIndexInternal(r),o=s.getNumContacts(),h=Ammo.castObject(s.getBody0(),Ammo.btRigidBody),a=Ammo.castObject(s.getBody1(),Ammo.btRigidBody),m=h.threeObject,u=a.threeObject;if(!m||!u||h.name===""&&a.name==="")continue;const t=(c=m.body)==null?void 0:c.checkCollisions,l=(e=u.body)==null?void 0:e.checkCollisions,f=m.body.breakable,p=u.body.breakable,v=m.body.fractureImpulse,w=u.body.fractureImpulse,P=t||l,M=f||p;if(typeof m.fragmentDepth>"u"&&(m.fragmentDepth=0),typeof u.fragmentDepth>"u"&&(u.fragmentDepth=0),!P&&!M)continue;let g=!1,y=0,S="start";for(let A=0;A<o;A++){const C=s.getContactPoint(A);if(C.getDistance()<=0){g=!0;const V=C.getAppliedImpulse(),E=C.get_m_positionWorldOnB(),B=C.get_m_normalWorldOnB();if(t||l){const D=[m.uuid,u.uuid].sort(),L=`${D[0]}__${D[1]}`;if(this.earlierDetectedCollisions.find(k=>k.combinedName===L)&&(S="collision"),!n.find(k=>k.combinedName===L)){n.push({combinedName:L,collision:!0});const k={x:E.x(),y:E.y(),z:E.z()},R={x:B.x(),y:B.y(),z:B.z()};m.body.impact.push({impulse:V,point:k,normal:R,name:u.name}),u.body.impact.push({impulse:V,point:k,normal:R,name:m.name}),this.collisionEvents.emit("collision",{bodies:[m,u],event:S})}}V>=y&&(y=V,(f||p)&&(this.impactPoint.set(E.x(),E.y(),E.z()),this.impactNormal.set(B.x(),B.y(),B.z())));break}}if(!g||!M)continue;const x=2;if(this.emptyV3.set(0,0,0),m.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:f,physicsBody:h},u.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:p,physicsBody:a},f&&y>v&&m.fragmentDepth<x){const A=this.convexBreaker.subdivideByImpact(m,this.impactPoint,this.impactNormal,1,2),C=A.length;for(let b=0;b<C;b++){const V=h.getLinearVelocity(),E=h.getAngularVelocity(),B=A[b];B.userData.ammoPhysicsData.velocity.set(V.x(),V.y(),V.z()),B.userData.ammoPhysicsData.angularVelocity.set(E.x(),E.y(),E.z()),this.createDebrisFromBreakableObject(B,m)}this.objectsToRemove[this.numObjectsToRemove++]=m}if(p&&y>w&&u.fragmentDepth<x){const A=this.convexBreaker.subdivideByImpact(u,this.impactPoint,this.impactNormal,1,2),C=A.length;for(let b=0;b<C;b++){const V=a.getLinearVelocity(),E=a.getAngularVelocity(),B=A[b];B.userData.ammoPhysicsData.velocity.set(V.x(),V.y(),V.z()),B.userData.ammoPhysicsData.angularVelocity.set(E.x(),E.y(),E.z()),this.createDebrisFromBreakableObject(B,u)}this.objectsToRemove[this.numObjectsToRemove++]=u}}for(let r=0;r<this.numObjectsToRemove;r++)this.removeDebris(this.objectsToRemove[r]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(r=>{const{combinedName:s}=r;if(!n.find(o=>o.combinedName===s)){const o=s.split("__"),h=this.rigidBodies.find(u=>u.uuid===o[0]),a=this.rigidBodies.find(u=>u.uuid===o[1]);h&&a&&this.collisionEvents.emit("collision",{bodies:[h,a],event:"end"})}}),this.earlierDetectedCollisions=[...n]}setGravity(n=0,i=-9.8,d=0){this.tmpBtVector3.setValue(n,i,d),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(n=1)=>{this.debugDrawer.setDebugMode(n)},disable:()=>{this.debugDrawer.disable()}}}start(){if(typeof Ammo>"u"){ee("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(()=>{this.setup()}):this.setup()}get add(){return{collider:(n,i,d)=>this.collisionEvents.addCollider(n,i,d),constraints:this.constraints.addConstraints,existing:(n,i)=>this.addExisting(n,i),plane:(n={},i={})=>this.shapes.addPlane(n,i),sphere:(n={},i={})=>this.shapes.addSphere(n,i),ground:(n={},i={})=>this.shapes.addGround(n,i),box:(n={},i={})=>this.shapes.addBox(n,i),capsule:(n={},i={})=>this.shapes.addCapsule(n,i),cylinder:(n={},i={})=>this.shapes.addCylinder(n,i),cone:(n={},i={})=>this.shapes.addCone(n,i),torus:(n={},i={})=>this.shapes.addTorus(n,i),extrude:(n,i={})=>this.shapes.addExtrude(n,i),raycaster:(n="closest")=>n==="closest"?new at(this):new lt(this)}}prepareThreeObjectForCollisionShape(n,i={}){var o,h;const{autoCenter:d=!1}=i,c={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6};let e="unknown";const r=((o=n.geometry)==null?void 0:o.type)||"unknown";/box/i.test(r)?e="box":/cone/i.test(r)?e="cone":/cylinder/i.test(r)?e="cylinder":/extrude/i.test(r)?e="extrude":/plane/i.test(r)?e="plane":/sphere/i.test(r)?e="sphere":/torus/i.test(r)&&(e="torus");let s={...c,...(h=n==null?void 0:n.geometry)==null?void 0:h.parameters};if(i.shape?(s={...c,...i},e=i.shape):n.shape&&(e=n.shape),Object.keys(s).forEach(a=>{typeof s[a]>"u"&&c[a]&&(s[a]=c[a])}),d){if(n.isMesh&&n.geometry)n.geometry.center();else if(n.isGroup){const a=new tt,m=new I;a.setFromObject(n).getCenter(m),n.traverse(u=>{u.isMesh&&u.geometry.translate(-m.x,-m.y,-m.z)})}}return e==="cylinder"&&(s.radius=i.radius||s.radiusTop),e==="extrude"&&(e="hacd"),(e==="mesh"||e==="convex")&&(e="convexMesh"),e==="concave"&&(e="concaveMesh"),e==="unknown"&&(ee(`Shape for ${n==null?void 0:n.name} not recognized! Will fallback to box.`),e="box"),{shape:e,params:s,object:n}}createCollisionShape(n,i,d){const c=d!=null&&d.quaternion?d==null?void 0:d.quaternion:new ie(0,0,0,1),{axis:e="y"}=i,r=new Ammo.btVector3,s=d==null?void 0:d.geometry;d&&(s!=null&&s.isGeometry)&&(d.geometry=new Ee().fromGeometry(s));const o=l=>{const f=new j().elements,p=[],v=[],w=[];return Zt(l,{},(P,M,g)=>{p.push(P),v.push(M),w.push(g)}),{vertices:p,matrices:v,indexes:w,matrixWorld:f}};let h={};this.complexShapes.indexOf(n)!==-1&&(h=o(d));let a;switch(n){case"box":r.setValue(i.width/2,i.height/2,i.depth/2),a=new Ammo.btBoxShape(r);break;case"sphere":a=new Ammo.btSphereShape(i.radius);break;case"cylinder":switch(e){case"y":r.setValue(i.radius,i.height/2,i.radius),a=new Ammo.btCylinderShape(r);break;case"x":r.setValue(i.height/2,i.radius,i.radius),a=new Ammo.btCylinderShapeX(r);break;case"z":r.setValue(i.radius,i.radius,i.height/2),a=new Ammo.btCylinderShapeZ(r);break}break;case"cone":switch(e){case"y":a=new Ammo.btConeShape(i.radius,i.height);break;case"x":a=new Ammo.btConeShapeX(i.radius,i.height);break;case"z":a=new Ammo.btConeShapeZ(i.radius,i.height);break}break;case"capsule":switch(e){case"y":a=new Ammo.btCapsuleShape(i.radius,i.height);break;case"x":a=new Ammo.btCapsuleShapeX(i.radius,i.height);break;case"z":a=new Ammo.btCapsuleShapeZ(i.radius,i.height);break}break;case"torus":a=Yt(i,c);break;case"plane":a=Ae(h.vertices,h.matrices,h.indexes,h.matrixWorld,{...i,concave:!1});break;case"hull":a=Qt(h.vertices,h.matrices,h.matrixWorld,i);break;case"hacd":a=Xt(h.vertices,h.matrices,h.indexes,h.matrixWorld,i);break;case"vhacd":a=$t(h.vertices,h.matrices,h.indexes,h.matrixWorld,i);break;case"convexMesh":a=Ae(h.vertices,h.matrices,h.indexes,h.matrixWorld,{...i,concave:!1});break;case"concaveMesh":a=Ae(h.vertices,h.matrices,h.indexes,h.matrixWorld,{...i,concave:!0});break}Ammo.destroy(r);const{x:m,y:u,z:t}=i;return(m||u||t)&&(a._compoundOffset={x:m||0,y:u||0,z:t||0}),Array.isArray(a)&&(a=this.mergeCollisionShapesToCompoundShape(a)),a}mergeCollisionShapesToCompoundShape(n){const i=new Ammo.btCompoundShape;return n.forEach(d=>{const{_childOffset:c,_compoundOffset:e}=d;if(c){const{pos:r,quat:s,scale:o,margin:h}=c,a=this.applyPosQuatScaleMargin(d,r,s,o,h);i.addChildShape(a,d)}else if(e){const r=new Ammo.btTransform;r.setIdentity(),r.setOrigin(new Ammo.btVector3(e.x,e.y,e.z)),i.addChildShape(r,d)}else{const r=new Ammo.btTransform;r.setIdentity(),i.addChildShape(r,d)}}),i}addExisting(n,i={}){const{hasBody:d}=n;if(d){ee(`Object "${n.name}" already has a physical body!`);return}const c=new I,e=new ie,r=new I;n.getWorldPosition(c),n.getWorldQuaternion(e),n.getWorldScale(r);const s=(i.collisionFlags||0).toString(2).slice(-1)==="1",o=(i.collisionFlags||0).toString(2).slice(-2,-1)==="1",{shape:h="unknown",compound:a=[],mass:m=s||o?0:1,collisionFlags:u=0,collisionGroup:t=1,collisionMask:l=-1,offset:f=void 0,breakable:p=!1,addChildren:v=!0,margin:w=.01,ignoreScale:P=!1,fractureImpulse:M=1}=i;if(P&&r.set(1,1,1),a.length>=1){const A=a.map(E=>this.createCollisionShape(E.shape,E)),C=this.mergeCollisionShapesToCompoundShape(A),b=this.applyPosQuatScaleMargin(C,c,e,r,w),V=this.collisionShapeToRigidBody(C,b,m,o);this.addRigidBodyToWorld(n,V,u,t,l,f),n.body.breakable=p,n.body.fractureImpulse=M,n.body.ignoreScale=P;return}const g=[];if(h!=="unknown"||n.isMesh){const A=this.prepareThreeObjectForCollisionShape(n,i),C=this.createCollisionShape(A.shape,A.params,A.object);g.push(C)}if(h==="unknown"&&v&&n.children.length>=1&&n.children.forEach(A=>{if(A.isMesh){const C=this.prepareThreeObjectForCollisionShape(A),b=this.createCollisionShape(C.shape,C.params,C.object);b._childOffset={pos:A.position.clone(),quat:A.quaternion.clone(),scale:A.scale.clone(),margin:w},g.push(b)}}),g.length===0){const A=this.prepareThreeObjectForCollisionShape(n,i),C=this.createCollisionShape(A.shape,A.params,A.object);g.push(C)}const y=g.length===1?g[0]:this.mergeCollisionShapesToCompoundShape(g),S=this.applyPosQuatScaleMargin(y,c,e,r,w),x=this.collisionShapeToRigidBody(y,S,m,o);this.addRigidBodyToWorld(n,x,u,t,l,f),n.body.breakable=p,n.body.fractureImpulse=M,n.body.ignoreScale=P}addRigidBodyToWorld(n,i,d,c,e,r){this.rigidBodies.push(n),this.physicsWorld.addRigidBody(i,c,e);const s=Object.values(i)[0];n.name||(n.name=`object-${n.id}`),i.name=n.name,n.body=new Ut(this,i),n.hasBody=!0,n.ptr=s,i.threeObject=n,r&&(n.body.offset={x:0,y:0,z:0,...r}),n.body.setCollisionFlags(d)}applyPosQuatScaleMargin(n,i=new I,d=new ie,c=new I,e=.01){n.setMargin(e);const r=new Ammo.btQuaternion(0,0,0,1);r.setValue(d.x,d.y,d.z,d.w);const s=new Ammo.btTransform;s.setIdentity(),s.getOrigin().setValue(i.x,i.y,i.z),s.setRotation(r),Ammo.destroy(r);const o=new Ammo.btVector3(c.x,c.y,c.z);return n.setLocalScaling(o),Ammo.destroy(o),s}collisionShapeToRigidBody(n,i,d,c){const e=new Ammo.btDefaultMotionState(i),r=new Ammo.btVector3(0,0,0);d>0&&n.calculateLocalInertia(d,r);const s=new Ammo.btRigidBodyConstructionInfo(d,e,n,r),o=new Ammo.btRigidBody(s);return(d>0||c)&&o.setActivationState(4),o}}const an="0.25.4",ln=`Powered by enable3d v${an}`;console.log(`%c %c %c %c %c ${ln} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|LGPL-3.0}
 */document.createElement("canvas");new Lt;new Be;new Be;new Be;var cn={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(T,n){(function(d,c){T.exports=c()})(se,function(){return function(i){var d={};function c(e){if(d[e])return d[e].exports;var r=d[e]={i:e,l:!1,exports:{}};return i[e].call(r.exports,r,r.exports,c),r.l=!0,r.exports}return c.m=i,c.c=d,c.d=function(e,r,s){c.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:s})},c.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,r){if(r&1&&(e=c(e)),r&8||r&4&&typeof e=="object"&&e&&e.__esModule)return e;var s=Object.create(null);if(c.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),r&2&&typeof e!="string")for(var o in e)c.d(s,o,(function(h){return e[h]}).bind(null,o));return s},c.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(r,"a",r),r},c.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},c.p="",c(c.s=20)}([function(i,d){var c={};i.exports=c,function(){c._baseDelta=1e3/60,c._nextId=0,c._seed=0,c._nowStartTime=+new Date,c._warnedOnce={},c._decomp=null,c.extend=function(r,s){var o,h;typeof s=="boolean"?(o=2,h=s):(o=1,h=!0);for(var a=o;a<arguments.length;a++){var m=arguments[a];if(m)for(var u in m)h&&m[u]&&m[u].constructor===Object&&(!r[u]||r[u].constructor===Object)?(r[u]=r[u]||{},c.extend(r[u],h,m[u])):r[u]=m[u]}return r},c.clone=function(r,s){return c.extend({},s,r)},c.keys=function(r){if(Object.keys)return Object.keys(r);var s=[];for(var o in r)s.push(o);return s},c.values=function(r){var s=[];if(Object.keys){for(var o=Object.keys(r),h=0;h<o.length;h++)s.push(r[o[h]]);return s}for(var a in r)s.push(r[a]);return s},c.get=function(r,s,o,h){s=s.split(".").slice(o,h);for(var a=0;a<s.length;a+=1)r=r[s[a]];return r},c.set=function(r,s,o,h,a){var m=s.split(".").slice(h,a);return c.get(r,s,0,-1)[m[m.length-1]]=o,o},c.shuffle=function(r){for(var s=r.length-1;s>0;s--){var o=Math.floor(c.random()*(s+1)),h=r[s];r[s]=r[o],r[o]=h}return r},c.choose=function(r){return r[Math.floor(c.random()*r.length)]},c.isElement=function(r){return typeof HTMLElement<"u"?r instanceof HTMLElement:!!(r&&r.nodeType&&r.nodeName)},c.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"},c.isFunction=function(r){return typeof r=="function"},c.isPlainObject=function(r){return typeof r=="object"&&r.constructor===Object},c.isString=function(r){return toString.call(r)==="[object String]"},c.clamp=function(r,s,o){return r<s?s:r>o?o:r},c.sign=function(r){return r<0?-1:1},c.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-c._nowStartTime},c.random=function(r,s){return r=typeof r<"u"?r:0,s=typeof s<"u"?s:1,r+e()*(s-r)};var e=function(){return c._seed=(c._seed*9301+49297)%233280,c._seed/233280};c.colorToNumber=function(r){return r=r.replace("#",""),r.length==3&&(r=r.charAt(0)+r.charAt(0)+r.charAt(1)+r.charAt(1)+r.charAt(2)+r.charAt(2)),parseInt(r,16)},c.logLevel=1,c.log=function(){console&&c.logLevel>0&&c.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},c.info=function(){console&&c.logLevel>0&&c.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},c.warn=function(){console&&c.logLevel>0&&c.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},c.warnOnce=function(){var r=Array.prototype.slice.call(arguments).join(" ");c._warnedOnce[r]||(c.warn(r),c._warnedOnce[r]=!0)},c.deprecated=function(r,s,o){r[s]=c.chain(function(){c.warnOnce(" deprecated ",o)},r[s])},c.nextId=function(){return c._nextId++},c.indexOf=function(r,s){if(r.indexOf)return r.indexOf(s);for(var o=0;o<r.length;o++)if(r[o]===s)return o;return-1},c.map=function(r,s){if(r.map)return r.map(s);for(var o=[],h=0;h<r.length;h+=1)o.push(s(r[h]));return o},c.topologicalSort=function(r){var s=[],o=[],h=[];for(var a in r)!o[a]&&!h[a]&&c._topologicalSort(a,o,h,r,s);return s},c._topologicalSort=function(r,s,o,h,a){var m=h[r]||[];o[r]=!0;for(var u=0;u<m.length;u+=1){var t=m[u];o[t]||s[t]||c._topologicalSort(t,s,o,h,a)}o[r]=!1,s[r]=!0,a.push(r)},c.chain=function(){for(var r=[],s=0;s<arguments.length;s+=1){var o=arguments[s];o._chained?r.push.apply(r,o._chained):r.push(o)}var h=function(){for(var a,m=new Array(arguments.length),u=0,t=arguments.length;u<t;u++)m[u]=arguments[u];for(u=0;u<r.length;u+=1){var l=r[u].apply(a,m);typeof l<"u"&&(a=l)}return a};return h._chained=r,h},c.chainPathBefore=function(r,s,o){return c.set(r,s,c.chain(o,c.get(r,s)))},c.chainPathAfter=function(r,s,o){return c.set(r,s,c.chain(c.get(r,s),o))},c.setDecomp=function(r){c._decomp=r},c.getDecomp=function(){var r=c._decomp;try{!r&&typeof window<"u"&&(r=window.decomp),!r&&typeof se<"u"&&(r=se.decomp)}catch{r=null}return r}}()},function(i,d){var c={};i.exports=c,function(){c.create=function(e){var r={min:{x:0,y:0},max:{x:0,y:0}};return e&&c.update(r,e),r},c.update=function(e,r,s){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var o=0;o<r.length;o++){var h=r[o];h.x>e.max.x&&(e.max.x=h.x),h.x<e.min.x&&(e.min.x=h.x),h.y>e.max.y&&(e.max.y=h.y),h.y<e.min.y&&(e.min.y=h.y)}s&&(s.x>0?e.max.x+=s.x:e.min.x+=s.x,s.y>0?e.max.y+=s.y:e.min.y+=s.y)},c.contains=function(e,r){return r.x>=e.min.x&&r.x<=e.max.x&&r.y>=e.min.y&&r.y<=e.max.y},c.overlaps=function(e,r){return e.min.x<=r.max.x&&e.max.x>=r.min.x&&e.max.y>=r.min.y&&e.min.y<=r.max.y},c.translate=function(e,r){e.min.x+=r.x,e.max.x+=r.x,e.min.y+=r.y,e.max.y+=r.y},c.shift=function(e,r){var s=e.max.x-e.min.x,o=e.max.y-e.min.y;e.min.x=r.x,e.max.x=r.x+s,e.min.y=r.y,e.max.y=r.y+o}}()},function(i,d){var c={};i.exports=c,function(){c.create=function(e,r){return{x:e||0,y:r||0}},c.clone=function(e){return{x:e.x,y:e.y}},c.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},c.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},c.rotate=function(e,r,s){var o=Math.cos(r),h=Math.sin(r);s||(s={});var a=e.x*o-e.y*h;return s.y=e.x*h+e.y*o,s.x=a,s},c.rotateAbout=function(e,r,s,o){var h=Math.cos(r),a=Math.sin(r);o||(o={});var m=s.x+((e.x-s.x)*h-(e.y-s.y)*a);return o.y=s.y+((e.x-s.x)*a+(e.y-s.y)*h),o.x=m,o},c.normalise=function(e){var r=c.magnitude(e);return r===0?{x:0,y:0}:{x:e.x/r,y:e.y/r}},c.dot=function(e,r){return e.x*r.x+e.y*r.y},c.cross=function(e,r){return e.x*r.y-e.y*r.x},c.cross3=function(e,r,s){return(r.x-e.x)*(s.y-e.y)-(r.y-e.y)*(s.x-e.x)},c.add=function(e,r,s){return s||(s={}),s.x=e.x+r.x,s.y=e.y+r.y,s},c.sub=function(e,r,s){return s||(s={}),s.x=e.x-r.x,s.y=e.y-r.y,s},c.mult=function(e,r){return{x:e.x*r,y:e.y*r}},c.div=function(e,r){return{x:e.x/r,y:e.y/r}},c.perp=function(e,r){return r=r===!0?-1:1,{x:r*-e.y,y:r*e.x}},c.neg=function(e){return{x:-e.x,y:-e.y}},c.angle=function(e,r){return Math.atan2(r.y-e.y,r.x-e.x)},c._temp=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()]}()},function(i,d,c){var e={};i.exports=e;var r=c(2),s=c(0);(function(){e.create=function(o,h){for(var a=[],m=0;m<o.length;m++){var u=o[m],t={x:u.x,y:u.y,index:m,body:h,isInternal:!1};a.push(t)}return a},e.fromPath=function(o,h){var a=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,m=[];return o.replace(a,function(u,t,l){m.push({x:parseFloat(t),y:parseFloat(l)})}),e.create(m,h)},e.centre=function(o){for(var h=e.area(o,!0),a={x:0,y:0},m,u,t,l=0;l<o.length;l++)t=(l+1)%o.length,m=r.cross(o[l],o[t]),u=r.mult(r.add(o[l],o[t]),m),a=r.add(a,u);return r.div(a,6*h)},e.mean=function(o){for(var h={x:0,y:0},a=0;a<o.length;a++)h.x+=o[a].x,h.y+=o[a].y;return r.div(h,o.length)},e.area=function(o,h){for(var a=0,m=o.length-1,u=0;u<o.length;u++)a+=(o[m].x-o[u].x)*(o[m].y+o[u].y),m=u;return h?a/2:Math.abs(a)/2},e.inertia=function(o,h){for(var a=0,m=0,u=o,t,l,f=0;f<u.length;f++)l=(f+1)%u.length,t=Math.abs(r.cross(u[l],u[f])),a+=t*(r.dot(u[l],u[l])+r.dot(u[l],u[f])+r.dot(u[f],u[f])),m+=t;return h/6*(a/m)},e.translate=function(o,h,a){a=typeof a<"u"?a:1;var m=o.length,u=h.x*a,t=h.y*a,l;for(l=0;l<m;l++)o[l].x+=u,o[l].y+=t;return o},e.rotate=function(o,h,a){if(h!==0){var m=Math.cos(h),u=Math.sin(h),t=a.x,l=a.y,f=o.length,p,v,w,P;for(P=0;P<f;P++)p=o[P],v=p.x-t,w=p.y-l,p.x=t+(v*m-w*u),p.y=l+(v*u+w*m);return o}},e.contains=function(o,h){for(var a=h.x,m=h.y,u=o.length,t=o[u-1],l,f=0;f<u;f++){if(l=o[f],(a-t.x)*(l.y-t.y)+(m-t.y)*(t.x-l.x)>0)return!1;t=l}return!0},e.scale=function(o,h,a,m){if(h===1&&a===1)return o;m=m||e.centre(o);for(var u,t,l=0;l<o.length;l++)u=o[l],t=r.sub(u,m),o[l].x=m.x+t.x*h,o[l].y=m.y+t.y*a;return o},e.chamfer=function(o,h,a,m,u){typeof h=="number"?h=[h]:h=h||[8],a=typeof a<"u"?a:-1,m=m||2,u=u||14;for(var t=[],l=0;l<o.length;l++){var f=o[l-1>=0?l-1:o.length-1],p=o[l],v=o[(l+1)%o.length],w=h[l<h.length?l:h.length-1];if(w===0){t.push(p);continue}var P=r.normalise({x:p.y-f.y,y:f.x-p.x}),M=r.normalise({x:v.y-p.y,y:p.x-v.x}),g=Math.sqrt(2*Math.pow(w,2)),y=r.mult(s.clone(P),w),S=r.normalise(r.mult(r.add(P,M),.5)),x=r.sub(p,r.mult(S,g)),A=a;a===-1&&(A=Math.pow(w,.32)*1.75),A=s.clamp(A,m,u),A%2===1&&(A+=1);for(var C=Math.acos(r.dot(P,M)),b=C/A,V=0;V<A;V++)t.push(r.add(r.rotate(y,b*V),x))}return t},e.clockwiseSort=function(o){var h=e.mean(o);return o.sort(function(a,m){return r.angle(h,a)-r.angle(h,m)}),o},e.isConvex=function(o){var h=0,a=o.length,m,u,t,l;if(a<3)return null;for(m=0;m<a;m++)if(u=(m+1)%a,t=(m+2)%a,l=(o[u].x-o[m].x)*(o[t].y-o[u].y),l-=(o[u].y-o[m].y)*(o[t].x-o[u].x),l<0?h|=1:l>0&&(h|=2),h===3)return!1;return h!==0?!0:null},e.hull=function(o){var h=[],a=[],m,u;for(o=o.slice(0),o.sort(function(t,l){var f=t.x-l.x;return f!==0?f:t.y-l.y}),u=0;u<o.length;u+=1){for(m=o[u];a.length>=2&&r.cross3(a[a.length-2],a[a.length-1],m)<=0;)a.pop();a.push(m)}for(u=o.length-1;u>=0;u-=1){for(m=o[u];h.length>=2&&r.cross3(h[h.length-2],h[h.length-1],m)<=0;)h.pop();h.push(m)}return h.pop(),a.pop(),h.concat(a)}})()},function(i,d,c){var e={};i.exports=e;var r=c(3),s=c(2),o=c(7),h=c(0),a=c(1),m=c(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var l={id:h.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},f=h.extend(l,t);return u(f,t),f},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var u=function(t,l){l=l||{},e.set(t,{bounds:t.bounds||a.create(t.vertices),positionPrev:t.positionPrev||s.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),r.rotate(t.vertices,t.angle,t.position),m.rotate(t.axes,t.angle),a.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:l.axes||t.axes,area:l.area||t.area,mass:l.mass||t.mass,inertia:l.inertia||t.inertia});var f=t.isStatic?"#14151f":h.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),p=t.isStatic?"#555":"#ccc",v=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||f,t.render.strokeStyle=t.render.strokeStyle||p,t.render.lineWidth=t.render.lineWidth||v,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,l,f){var p;typeof l=="string"&&(p=l,l={},l[p]=f);for(p in l)if(Object.prototype.hasOwnProperty.call(l,p))switch(f=l[p],p){case"isStatic":e.setStatic(t,f);break;case"isSleeping":o.set(t,f);break;case"mass":e.setMass(t,f);break;case"density":e.setDensity(t,f);break;case"inertia":e.setInertia(t,f);break;case"vertices":e.setVertices(t,f);break;case"position":e.setPosition(t,f);break;case"angle":e.setAngle(t,f);break;case"velocity":e.setVelocity(t,f);break;case"angularVelocity":e.setAngularVelocity(t,f);break;case"speed":e.setSpeed(t,f);break;case"angularSpeed":e.setAngularSpeed(t,f);break;case"parts":e.setParts(t,f);break;case"centre":e.setCentre(t,f);break;default:t[p]=f}},e.setStatic=function(t,l){for(var f=0;f<t.parts.length;f++){var p=t.parts[f];l?(p.isStatic||(p._original={restitution:p.restitution,friction:p.friction,mass:p.mass,inertia:p.inertia,density:p.density,inverseMass:p.inverseMass,inverseInertia:p.inverseInertia}),p.restitution=0,p.friction=1,p.mass=p.inertia=p.density=1/0,p.inverseMass=p.inverseInertia=0,p.positionPrev.x=p.position.x,p.positionPrev.y=p.position.y,p.anglePrev=p.angle,p.angularVelocity=0,p.speed=0,p.angularSpeed=0,p.motion=0):p._original&&(p.restitution=p._original.restitution,p.friction=p._original.friction,p.mass=p._original.mass,p.inertia=p._original.inertia,p.density=p._original.density,p.inverseMass=p._original.inverseMass,p.inverseInertia=p._original.inverseInertia,p._original=null),p.isStatic=l}},e.setMass=function(t,l){var f=t.inertia/(t.mass/6);t.inertia=f*(l/6),t.inverseInertia=1/t.inertia,t.mass=l,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,l){e.setMass(t,l*t.area),t.density=l},e.setInertia=function(t,l){t.inertia=l,t.inverseInertia=1/t.inertia},e.setVertices=function(t,l){l[0].body===t?t.vertices=l:t.vertices=r.create(l,t),t.axes=m.fromVertices(t.vertices),t.area=r.area(t.vertices),e.setMass(t,t.density*t.area);var f=r.centre(t.vertices);r.translate(t.vertices,f,-1),e.setInertia(t,e._inertiaScale*r.inertia(t.vertices,t.mass)),r.translate(t.vertices,t.position),a.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,l,f){var p;for(l=l.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,p=0;p<l.length;p++){var v=l[p];v!==t&&(v.parent=t,t.parts.push(v))}if(t.parts.length!==1){if(f=typeof f<"u"?f:!0,f){var w=[];for(p=0;p<l.length;p++)w=w.concat(l[p].vertices);r.clockwiseSort(w);var P=r.hull(w),M=r.centre(P);e.setVertices(t,P),r.translate(t.vertices,M)}var g=e._totalProperties(t);t.area=g.area,t.parent=t,t.position.x=g.centre.x,t.position.y=g.centre.y,t.positionPrev.x=g.centre.x,t.positionPrev.y=g.centre.y,e.setMass(t,g.mass),e.setInertia(t,g.inertia),e.setPosition(t,g.centre)}},e.setCentre=function(t,l,f){f?(t.positionPrev.x+=l.x,t.positionPrev.y+=l.y,t.position.x+=l.x,t.position.y+=l.y):(t.positionPrev.x=l.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=l.y-(t.position.y-t.positionPrev.y),t.position.x=l.x,t.position.y=l.y)},e.setPosition=function(t,l,f){var p=s.sub(l,t.position);f?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=p.x,t.velocity.y=p.y,t.speed=s.magnitude(p)):(t.positionPrev.x+=p.x,t.positionPrev.y+=p.y);for(var v=0;v<t.parts.length;v++){var w=t.parts[v];w.position.x+=p.x,w.position.y+=p.y,r.translate(w.vertices,p),a.update(w.bounds,w.vertices,t.velocity)}},e.setAngle=function(t,l,f){var p=l-t.angle;f?(t.anglePrev=t.angle,t.angularVelocity=p,t.angularSpeed=Math.abs(p)):t.anglePrev+=p;for(var v=0;v<t.parts.length;v++){var w=t.parts[v];w.angle+=p,r.rotate(w.vertices,p,t.position),m.rotate(w.axes,p),a.update(w.bounds,w.vertices,t.velocity),v>0&&s.rotateAbout(w.position,p,t.position,w.position)}},e.setVelocity=function(t,l){var f=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-l.x*f,t.positionPrev.y=t.position.y-l.y*f,t.velocity.x=(t.position.x-t.positionPrev.x)/f,t.velocity.y=(t.position.y-t.positionPrev.y)/f,t.speed=s.magnitude(t.velocity)},e.getVelocity=function(t){var l=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*l,y:(t.position.y-t.positionPrev.y)*l}},e.getSpeed=function(t){return s.magnitude(e.getVelocity(t))},e.setSpeed=function(t,l){e.setVelocity(t,s.mult(s.normalise(e.getVelocity(t)),l))},e.setAngularVelocity=function(t,l){var f=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-l*f,t.angularVelocity=(t.angle-t.anglePrev)/f,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,l){e.setAngularVelocity(t,h.sign(e.getAngularVelocity(t))*l)},e.translate=function(t,l,f){e.setPosition(t,s.add(t.position,l),f)},e.rotate=function(t,l,f,p){if(!f)e.setAngle(t,t.angle+l,p);else{var v=Math.cos(l),w=Math.sin(l),P=t.position.x-f.x,M=t.position.y-f.y;e.setPosition(t,{x:f.x+(P*v-M*w),y:f.y+(P*w+M*v)},p),e.setAngle(t,t.angle+l,p)}},e.scale=function(t,l,f,p){var v=0,w=0;p=p||t.position;for(var P=0;P<t.parts.length;P++){var M=t.parts[P];r.scale(M.vertices,l,f,p),M.axes=m.fromVertices(M.vertices),M.area=r.area(M.vertices),e.setMass(M,t.density*M.area),r.translate(M.vertices,{x:-M.position.x,y:-M.position.y}),e.setInertia(M,e._inertiaScale*r.inertia(M.vertices,M.mass)),r.translate(M.vertices,{x:M.position.x,y:M.position.y}),P>0&&(v+=M.area,w+=M.inertia),M.position.x=p.x+(M.position.x-p.x)*l,M.position.y=p.y+(M.position.y-p.y)*f,a.update(M.bounds,M.vertices,t.velocity)}t.parts.length>1&&(t.area=v,t.isStatic||(e.setMass(t,t.density*v),e.setInertia(t,w))),t.circleRadius&&(l===f?t.circleRadius*=l:t.circleRadius=null)},e.update=function(t,l){l=(typeof l<"u"?l:1e3/60)*t.timeScale;var f=l*l,p=e._timeCorrection?l/(t.deltaTime||l):1,v=1-t.frictionAir*(l/h._baseDelta),w=(t.position.x-t.positionPrev.x)*p,P=(t.position.y-t.positionPrev.y)*p;t.velocity.x=w*v+t.force.x/t.mass*f,t.velocity.y=P*v+t.force.y/t.mass*f,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=l,t.angularVelocity=(t.angle-t.anglePrev)*v*p+t.torque/t.inertia*f,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var M=0;M<t.parts.length;M++){var g=t.parts[M];r.translate(g.vertices,t.velocity),M>0&&(g.position.x+=t.velocity.x,g.position.y+=t.velocity.y),t.angularVelocity!==0&&(r.rotate(g.vertices,t.angularVelocity,t.position),m.rotate(g.axes,t.angularVelocity),M>0&&s.rotateAbout(g.position,t.angularVelocity,t.position,g.position)),a.update(g.bounds,g.vertices,t.velocity)}},e.updateVelocities=function(t){var l=e._baseDelta/t.deltaTime,f=t.velocity;f.x=(t.position.x-t.positionPrev.x)*l,f.y=(t.position.y-t.positionPrev.y)*l,t.speed=Math.sqrt(f.x*f.x+f.y*f.y),t.angularVelocity=(t.angle-t.anglePrev)*l,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,l,f){var p={x:l.x-t.position.x,y:l.y-t.position.y};t.force.x+=f.x,t.force.y+=f.y,t.torque+=p.x*f.y-p.y*f.x},e._totalProperties=function(t){for(var l={mass:0,area:0,inertia:0,centre:{x:0,y:0}},f=t.parts.length===1?0:1;f<t.parts.length;f++){var p=t.parts[f],v=p.mass!==1/0?p.mass:1;l.mass+=v,l.area+=p.area,l.inertia+=p.inertia,l.centre=s.add(l.centre,s.mult(p.position,v))}return l.centre=s.div(l.centre,l.mass),l}})()},function(i,d,c){var e={};i.exports=e;var r=c(0);(function(){e.on=function(s,o,h){for(var a=o.split(" "),m,u=0;u<a.length;u++)m=a[u],s.events=s.events||{},s.events[m]=s.events[m]||[],s.events[m].push(h);return h},e.off=function(s,o,h){if(!o){s.events={};return}typeof o=="function"&&(h=o,o=r.keys(s.events).join(" "));for(var a=o.split(" "),m=0;m<a.length;m++){var u=s.events[a[m]],t=[];if(h&&u)for(var l=0;l<u.length;l++)u[l]!==h&&t.push(u[l]);s.events[a[m]]=t}},e.trigger=function(s,o,h){var a,m,u,t,l=s.events;if(l&&r.keys(l).length>0){h||(h={}),a=o.split(" ");for(var f=0;f<a.length;f++)if(m=a[f],u=l[m],u){t=r.clone(h,!1),t.name=m,t.source=s;for(var p=0;p<u.length;p++)u[p].apply(s,[t])}}}})()},function(i,d,c){var e={};i.exports=e;var r=c(5),s=c(0),o=c(1),h=c(4);(function(){e.create=function(a){return s.extend({id:s.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},a)},e.setModified=function(a,m,u,t){if(a.isModified=m,m&&a.cache&&(a.cache.allBodies=null,a.cache.allConstraints=null,a.cache.allComposites=null),u&&a.parent&&e.setModified(a.parent,m,u,t),t)for(var l=0;l<a.composites.length;l++){var f=a.composites[l];e.setModified(f,m,u,t)}},e.add=function(a,m){var u=[].concat(m);r.trigger(a,"beforeAdd",{object:m});for(var t=0;t<u.length;t++){var l=u[t];switch(l.type){case"body":if(l.parent!==l){s.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(a,l);break;case"constraint":e.addConstraint(a,l);break;case"composite":e.addComposite(a,l);break;case"mouseConstraint":e.addConstraint(a,l.constraint);break}}return r.trigger(a,"afterAdd",{object:m}),a},e.remove=function(a,m,u){var t=[].concat(m);r.trigger(a,"beforeRemove",{object:m});for(var l=0;l<t.length;l++){var f=t[l];switch(f.type){case"body":e.removeBody(a,f,u);break;case"constraint":e.removeConstraint(a,f,u);break;case"composite":e.removeComposite(a,f,u);break;case"mouseConstraint":e.removeConstraint(a,f.constraint);break}}return r.trigger(a,"afterRemove",{object:m}),a},e.addComposite=function(a,m){return a.composites.push(m),m.parent=a,e.setModified(a,!0,!0,!1),a},e.removeComposite=function(a,m,u){var t=s.indexOf(a.composites,m);if(t!==-1){var l=e.allBodies(m);e.removeCompositeAt(a,t);for(var f=0;f<l.length;f++)l[f].sleepCounter=0}if(u)for(var f=0;f<a.composites.length;f++)e.removeComposite(a.composites[f],m,!0);return a},e.removeCompositeAt=function(a,m){return a.composites.splice(m,1),e.setModified(a,!0,!0,!1),a},e.addBody=function(a,m){return a.bodies.push(m),e.setModified(a,!0,!0,!1),a},e.removeBody=function(a,m,u){var t=s.indexOf(a.bodies,m);if(t!==-1&&(e.removeBodyAt(a,t),m.sleepCounter=0),u)for(var l=0;l<a.composites.length;l++)e.removeBody(a.composites[l],m,!0);return a},e.removeBodyAt=function(a,m){return a.bodies.splice(m,1),e.setModified(a,!0,!0,!1),a},e.addConstraint=function(a,m){return a.constraints.push(m),e.setModified(a,!0,!0,!1),a},e.removeConstraint=function(a,m,u){var t=s.indexOf(a.constraints,m);if(t!==-1&&e.removeConstraintAt(a,t),u)for(var l=0;l<a.composites.length;l++)e.removeConstraint(a.composites[l],m,!0);return a},e.removeConstraintAt=function(a,m){return a.constraints.splice(m,1),e.setModified(a,!0,!0,!1),a},e.clear=function(a,m,u){if(u)for(var t=0;t<a.composites.length;t++)e.clear(a.composites[t],m,!0);return m?a.bodies=a.bodies.filter(function(l){return l.isStatic}):a.bodies.length=0,a.constraints.length=0,a.composites.length=0,e.setModified(a,!0,!0,!1),a},e.allBodies=function(a){if(a.cache&&a.cache.allBodies)return a.cache.allBodies;for(var m=[].concat(a.bodies),u=0;u<a.composites.length;u++)m=m.concat(e.allBodies(a.composites[u]));return a.cache&&(a.cache.allBodies=m),m},e.allConstraints=function(a){if(a.cache&&a.cache.allConstraints)return a.cache.allConstraints;for(var m=[].concat(a.constraints),u=0;u<a.composites.length;u++)m=m.concat(e.allConstraints(a.composites[u]));return a.cache&&(a.cache.allConstraints=m),m},e.allComposites=function(a){if(a.cache&&a.cache.allComposites)return a.cache.allComposites;for(var m=[].concat(a.composites),u=0;u<a.composites.length;u++)m=m.concat(e.allComposites(a.composites[u]));return a.cache&&(a.cache.allComposites=m),m},e.get=function(a,m,u){var t,l;switch(u){case"body":t=e.allBodies(a);break;case"constraint":t=e.allConstraints(a);break;case"composite":t=e.allComposites(a).concat(a);break}return t?(l=t.filter(function(f){return f.id.toString()===m.toString()}),l.length===0?null:l[0]):null},e.move=function(a,m,u){return e.remove(a,m),e.add(u,m),a},e.rebase=function(a){for(var m=e.allBodies(a).concat(e.allConstraints(a)).concat(e.allComposites(a)),u=0;u<m.length;u++)m[u].id=s.nextId();return a},e.translate=function(a,m,u){for(var t=u?e.allBodies(a):a.bodies,l=0;l<t.length;l++)h.translate(t[l],m);return a},e.rotate=function(a,m,u,t){for(var l=Math.cos(m),f=Math.sin(m),p=t?e.allBodies(a):a.bodies,v=0;v<p.length;v++){var w=p[v],P=w.position.x-u.x,M=w.position.y-u.y;h.setPosition(w,{x:u.x+(P*l-M*f),y:u.y+(P*f+M*l)}),h.rotate(w,m)}return a},e.scale=function(a,m,u,t,l){for(var f=l?e.allBodies(a):a.bodies,p=0;p<f.length;p++){var v=f[p],w=v.position.x-t.x,P=v.position.y-t.y;h.setPosition(v,{x:t.x+w*m,y:t.y+P*u}),h.scale(v,m,u)}return a},e.bounds=function(a){for(var m=e.allBodies(a),u=[],t=0;t<m.length;t+=1){var l=m[t];u.push(l.bounds.min,l.bounds.max)}return o.create(u)}})()},function(i,d,c){var e={};i.exports=e;var r=c(4),s=c(5),o=c(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(h,a){for(var m=a/o._baseDelta,u=e._motionSleepThreshold,t=0;t<h.length;t++){var l=h[t],f=r.getSpeed(l),p=r.getAngularSpeed(l),v=f*f+p*p;if(l.force.x!==0||l.force.y!==0){e.set(l,!1);continue}var w=Math.min(l.motion,v),P=Math.max(l.motion,v);l.motion=e._minBias*w+(1-e._minBias)*P,l.sleepThreshold>0&&l.motion<u?(l.sleepCounter+=1,l.sleepCounter>=l.sleepThreshold/m&&e.set(l,!0)):l.sleepCounter>0&&(l.sleepCounter-=1)}},e.afterCollisions=function(h){for(var a=e._motionSleepThreshold,m=0;m<h.length;m++){var u=h[m];if(u.isActive){var t=u.collision,l=t.bodyA.parent,f=t.bodyB.parent;if(!(l.isSleeping&&f.isSleeping||l.isStatic||f.isStatic)&&(l.isSleeping||f.isSleeping)){var p=l.isSleeping&&!l.isStatic?l:f,v=p===l?f:l;!p.isStatic&&v.motion>a&&e.set(p,!1)}}}},e.set=function(h,a){var m=h.isSleeping;a?(h.isSleeping=!0,h.sleepCounter=h.sleepThreshold,h.positionImpulse.x=0,h.positionImpulse.y=0,h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.anglePrev=h.angle,h.speed=0,h.angularSpeed=0,h.motion=0,m||s.trigger(h,"sleepStart")):(h.isSleeping=!1,h.sleepCounter=0,m&&s.trigger(h,"sleepEnd"))}})()},function(i,d,c){var e={};i.exports=e;var r=c(3),s=c(9);(function(){var o=[],h={overlap:0,axis:null},a={overlap:0,axis:null};e.create=function(m,u){return{pair:null,collided:!1,bodyA:m,bodyB:u,parentA:m.parent,parentB:u.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},e.collides=function(m,u,t){if(e._overlapAxes(h,m.vertices,u.vertices,m.axes),h.overlap<=0||(e._overlapAxes(a,u.vertices,m.vertices,u.axes),a.overlap<=0))return null;var l=t&&t.table[s.id(m,u)],f;l?f=l.collision:(f=e.create(m,u),f.collided=!0,f.bodyA=m.id<u.id?m:u,f.bodyB=m.id<u.id?u:m,f.parentA=f.bodyA.parent,f.parentB=f.bodyB.parent),m=f.bodyA,u=f.bodyB;var p;h.overlap<a.overlap?p=h:p=a;var v=f.normal,w=f.tangent,P=f.penetration,M=f.supports,g=p.overlap,y=p.axis,S=y.x,x=y.y,A=u.position.x-m.position.x,C=u.position.y-m.position.y;S*A+x*C>=0&&(S=-S,x=-x),v.x=S,v.y=x,w.x=-x,w.y=S,P.x=S*g,P.y=x*g,f.depth=g;var b=e._findSupports(m,u,v,1),V=0;if(r.contains(m.vertices,b[0])&&(M[V++]=b[0]),r.contains(m.vertices,b[1])&&(M[V++]=b[1]),V<2){var E=e._findSupports(u,m,v,-1);r.contains(u.vertices,E[0])&&(M[V++]=E[0]),V<2&&r.contains(u.vertices,E[1])&&(M[V++]=E[1])}return V===0&&(M[V++]=b[0]),f.supportCount=V,f},e._overlapAxes=function(m,u,t,l){var f=u.length,p=t.length,v=u[0].x,w=u[0].y,P=t[0].x,M=t[0].y,g=l.length,y=Number.MAX_VALUE,S=0,x,A,C,b,V,E;for(V=0;V<g;V++){var B=l[V],D=B.x,L=B.y,k=v*D+w*L,R=P*D+M*L,O=k,z=R;for(E=1;E<f;E+=1)b=u[E].x*D+u[E].y*L,b>O?O=b:b<k&&(k=b);for(E=1;E<p;E+=1)b=t[E].x*D+t[E].y*L,b>z?z=b:b<R&&(R=b);if(A=O-R,C=z-k,x=A<C?A:C,x<y&&(y=x,S=V,x<=0))break}m.axis=l[S],m.overlap=y},e._findSupports=function(m,u,t,l){var f=u.vertices,p=f.length,v=m.position.x,w=m.position.y,P=t.x*l,M=t.y*l,g=f[0],y=g,S=P*(v-y.x)+M*(w-y.y),x,A,C;for(C=1;C<p;C+=1)y=f[C],A=P*(v-y.x)+M*(w-y.y),A<S&&(S=A,g=y);return x=f[(p+g.index-1)%p],S=P*(v-x.x)+M*(w-x.y),y=f[(g.index+1)%p],P*(v-y.x)+M*(w-y.y)<S?(o[0]=g,o[1]=y,o):(o[0]=g,o[1]=x,o)}})()},function(i,d,c){var e={};i.exports=e;var r=c(16);(function(){e.create=function(s,o){var h=s.bodyA,a=s.bodyB,m={id:e.id(h,a),bodyA:h,bodyB:a,collision:s,contacts:[r.create(),r.create()],contactCount:0,separation:0,isActive:!0,isSensor:h.isSensor||a.isSensor,timeCreated:o,timeUpdated:o,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(m,s,o),m},e.update=function(s,o,h){var a=o.supports,m=o.supportCount,u=s.contacts,t=o.parentA,l=o.parentB;s.isActive=!0,s.timeUpdated=h,s.collision=o,s.separation=o.depth,s.inverseMass=t.inverseMass+l.inverseMass,s.friction=t.friction<l.friction?t.friction:l.friction,s.frictionStatic=t.frictionStatic>l.frictionStatic?t.frictionStatic:l.frictionStatic,s.restitution=t.restitution>l.restitution?t.restitution:l.restitution,s.slop=t.slop>l.slop?t.slop:l.slop,s.contactCount=m,o.pair=s;var f=a[0],p=u[0],v=a[1],w=u[1];(w.vertex===f||p.vertex===v)&&(u[1]=p,u[0]=p=w,w=u[1]),p.vertex=f,w.vertex=v},e.setActive=function(s,o,h){o?(s.isActive=!0,s.timeUpdated=h):(s.isActive=!1,s.contactCount=0)},e.id=function(s,o){return s.id<o.id?s.id.toString(36)+":"+o.id.toString(36):o.id.toString(36)+":"+s.id.toString(36)}})()},function(i,d,c){var e={};i.exports=e;var r=c(3),s=c(2),o=c(7),h=c(1),a=c(11),m=c(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(u){var t=u;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var l=t.bodyA?s.add(t.bodyA.position,t.pointA):t.pointA,f=t.bodyB?s.add(t.bodyB.position,t.pointB):t.pointB,p=s.magnitude(s.sub(l,f));t.length=typeof t.length<"u"?t.length:p,t.id=t.id||m.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var v={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(v.type="pin",v.anchors=!1):t.stiffness<.9&&(v.type="spring"),t.render=m.extend(v,t.render),t},e.preSolveAll=function(u){for(var t=0;t<u.length;t+=1){var l=u[t],f=l.constraintImpulse;l.isStatic||f.x===0&&f.y===0&&f.angle===0||(l.position.x+=f.x,l.position.y+=f.y,l.angle+=f.angle)}},e.solveAll=function(u,t){for(var l=m.clamp(t/m._baseDelta,0,1),f=0;f<u.length;f+=1){var p=u[f],v=!p.bodyA||p.bodyA&&p.bodyA.isStatic,w=!p.bodyB||p.bodyB&&p.bodyB.isStatic;(v||w)&&e.solve(u[f],l)}for(f=0;f<u.length;f+=1)p=u[f],v=!p.bodyA||p.bodyA&&p.bodyA.isStatic,w=!p.bodyB||p.bodyB&&p.bodyB.isStatic,!v&&!w&&e.solve(u[f],l)},e.solve=function(u,t){var l=u.bodyA,f=u.bodyB,p=u.pointA,v=u.pointB;if(!(!l&&!f)){l&&!l.isStatic&&(s.rotate(p,l.angle-u.angleA,p),u.angleA=l.angle),f&&!f.isStatic&&(s.rotate(v,f.angle-u.angleB,v),u.angleB=f.angle);var w=p,P=v;if(l&&(w=s.add(l.position,p)),f&&(P=s.add(f.position,v)),!(!w||!P)){var M=s.sub(w,P),g=s.magnitude(M);g<e._minLength&&(g=e._minLength);var y=(g-u.length)/g,S=u.stiffness>=1||u.length===0,x=S?u.stiffness*t:u.stiffness*t*t,A=u.damping*t,C=s.mult(M,y*x),b=(l?l.inverseMass:0)+(f?f.inverseMass:0),V=(l?l.inverseInertia:0)+(f?f.inverseInertia:0),E=b+V,B,D,L,k,R;if(A>0){var O=s.create();L=s.div(M,g),R=s.sub(f&&s.sub(f.position,f.positionPrev)||O,l&&s.sub(l.position,l.positionPrev)||O),k=s.dot(L,R)}l&&!l.isStatic&&(D=l.inverseMass/b,l.constraintImpulse.x-=C.x*D,l.constraintImpulse.y-=C.y*D,l.position.x-=C.x*D,l.position.y-=C.y*D,A>0&&(l.positionPrev.x-=A*L.x*k*D,l.positionPrev.y-=A*L.y*k*D),B=s.cross(p,C)/E*e._torqueDampen*l.inverseInertia*(1-u.angularStiffness),l.constraintImpulse.angle-=B,l.angle-=B),f&&!f.isStatic&&(D=f.inverseMass/b,f.constraintImpulse.x+=C.x*D,f.constraintImpulse.y+=C.y*D,f.position.x+=C.x*D,f.position.y+=C.y*D,A>0&&(f.positionPrev.x+=A*L.x*k*D,f.positionPrev.y+=A*L.y*k*D),B=s.cross(v,C)/E*e._torqueDampen*f.inverseInertia*(1-u.angularStiffness),f.constraintImpulse.angle+=B,f.angle+=B)}}},e.postSolveAll=function(u){for(var t=0;t<u.length;t++){var l=u[t],f=l.constraintImpulse;if(!(l.isStatic||f.x===0&&f.y===0&&f.angle===0)){o.set(l,!1);for(var p=0;p<l.parts.length;p++){var v=l.parts[p];r.translate(v.vertices,f),p>0&&(v.position.x+=f.x,v.position.y+=f.y),f.angle!==0&&(r.rotate(v.vertices,f.angle,l.position),a.rotate(v.axes,f.angle),p>0&&s.rotateAbout(v.position,f.angle,l.position,v.position)),h.update(v.bounds,v.vertices,l.velocity)}f.angle*=e._warming,f.x*=e._warming,f.y*=e._warming}}},e.pointAWorld=function(u){return{x:(u.bodyA?u.bodyA.position.x:0)+(u.pointA?u.pointA.x:0),y:(u.bodyA?u.bodyA.position.y:0)+(u.pointA?u.pointA.y:0)}},e.pointBWorld=function(u){return{x:(u.bodyB?u.bodyB.position.x:0)+(u.pointB?u.pointB.x:0),y:(u.bodyB?u.bodyB.position.y:0)+(u.pointB?u.pointB.y:0)}},e.currentLength=function(u){var t=(u.bodyA?u.bodyA.position.x:0)+(u.pointA?u.pointA.x:0),l=(u.bodyA?u.bodyA.position.y:0)+(u.pointA?u.pointA.y:0),f=(u.bodyB?u.bodyB.position.x:0)+(u.pointB?u.pointB.x:0),p=(u.bodyB?u.bodyB.position.y:0)+(u.pointB?u.pointB.y:0),v=t-f,w=l-p;return Math.sqrt(v*v+w*w)}})()},function(i,d,c){var e={};i.exports=e;var r=c(2),s=c(0);(function(){e.fromVertices=function(o){for(var h={},a=0;a<o.length;a++){var m=(a+1)%o.length,u=r.normalise({x:o[m].y-o[a].y,y:o[a].x-o[m].x}),t=u.y===0?1/0:u.x/u.y;t=t.toFixed(3).toString(),h[t]=u}return s.values(h)},e.rotate=function(o,h){if(h!==0)for(var a=Math.cos(h),m=Math.sin(h),u=0;u<o.length;u++){var t=o[u],l;l=t.x*a-t.y*m,t.y=t.x*m+t.y*a,t.x=l}}})()},function(i,d,c){var e={};i.exports=e;var r=c(3),s=c(0),o=c(4),h=c(1),a=c(2);(function(){e.rectangle=function(m,u,t,l,f){f=f||{};var p={label:"Rectangle Body",position:{x:m,y:u},vertices:r.fromPath("L 0 0 L "+t+" 0 L "+t+" "+l+" L 0 "+l)};if(f.chamfer){var v=f.chamfer;p.vertices=r.chamfer(p.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete f.chamfer}return o.create(s.extend({},p,f))},e.trapezoid=function(m,u,t,l,f,p){p=p||{},f>=1&&s.warn("Bodies.trapezoid: slope parameter must be < 1."),f*=.5;var v=(1-f*2)*t,w=t*f,P=w+v,M=P+w,g;f<.5?g="L 0 0 L "+w+" "+-l+" L "+P+" "+-l+" L "+M+" 0":g="L 0 0 L "+P+" "+-l+" L "+M+" 0";var y={label:"Trapezoid Body",position:{x:m,y:u},vertices:r.fromPath(g)};if(p.chamfer){var S=p.chamfer;y.vertices=r.chamfer(y.vertices,S.radius,S.quality,S.qualityMin,S.qualityMax),delete p.chamfer}return o.create(s.extend({},y,p))},e.circle=function(m,u,t,l,f){l=l||{};var p={label:"Circle Body",circleRadius:t};f=f||25;var v=Math.ceil(Math.max(10,Math.min(f,t)));return v%2===1&&(v+=1),e.polygon(m,u,v,t,s.extend({},p,l))},e.polygon=function(m,u,t,l,f){if(f=f||{},t<3)return e.circle(m,u,l,f);for(var p=2*Math.PI/t,v="",w=p*.5,P=0;P<t;P+=1){var M=w+P*p,g=Math.cos(M)*l,y=Math.sin(M)*l;v+="L "+g.toFixed(3)+" "+y.toFixed(3)+" "}var S={label:"Polygon Body",position:{x:m,y:u},vertices:r.fromPath(v)};if(f.chamfer){var x=f.chamfer;S.vertices=r.chamfer(S.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete f.chamfer}return o.create(s.extend({},S,f))},e.fromVertices=function(m,u,t,l,f,p,v,w){var P=s.getDecomp(),M,g,y,S,x,A,C,b,V,E,B;for(M=!!(P&&P.quickDecomp),l=l||{},y=[],f=typeof f<"u"?f:!1,p=typeof p<"u"?p:.01,v=typeof v<"u"?v:10,w=typeof w<"u"?w:.01,s.isArray(t[0])||(t=[t]),E=0;E<t.length;E+=1)if(A=t[E],S=r.isConvex(A),x=!S,x&&!M&&s.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),S||!M)S?A=r.clockwiseSort(A):A=r.hull(A),y.push({position:{x:m,y:u},vertices:A});else{var D=A.map(function(F){return[F.x,F.y]});P.makeCCW(D),p!==!1&&P.removeCollinearPoints(D,p),w!==!1&&P.removeDuplicatePoints&&P.removeDuplicatePoints(D,w);var L=P.quickDecomp(D);for(C=0;C<L.length;C++){var k=L[C],R=k.map(function(F){return{x:F[0],y:F[1]}});v>0&&r.area(R)<v||y.push({position:r.centre(R),vertices:R})}}for(C=0;C<y.length;C++)y[C]=o.create(s.extend(y[C],l));if(f){var O=5;for(C=0;C<y.length;C++){var z=y[C];for(b=C+1;b<y.length;b++){var H=y[b];if(h.overlaps(z.bounds,H.bounds)){var W=z.vertices,G=H.vertices;for(V=0;V<z.vertices.length;V++)for(B=0;B<H.vertices.length;B++){var Y=a.magnitudeSquared(a.sub(W[(V+1)%W.length],G[B])),Q=a.magnitudeSquared(a.sub(W[V],G[(B+1)%G.length]));Y<O&&Q<O&&(W[V].isInternal=!0,G[B].isInternal=!0)}}}}}return y.length>1?(g=o.create(s.extend({parts:y.slice(0)},l)),o.setPosition(g,{x:m,y:u}),g):y[0]}})()},function(i,d,c){var e={};i.exports=e;var r=c(0),s=c(8);(function(){e.create=function(o){var h={bodies:[],collisions:[],pairs:null};return r.extend(h,o)},e.setBodies=function(o,h){o.bodies=h.slice(0)},e.clear=function(o){o.bodies=[],o.collisions=[]},e.collisions=function(o){var h=o.pairs,a=o.bodies,m=a.length,u=e.canCollide,t=s.collides,l=o.collisions,f=0,p,v;for(a.sort(e._compareBoundsX),p=0;p<m;p++){var w=a[p],P=w.bounds,M=w.bounds.max.x,g=w.bounds.max.y,y=w.bounds.min.y,S=w.isStatic||w.isSleeping,x=w.parts.length,A=x===1;for(v=p+1;v<m;v++){var C=a[v],b=C.bounds;if(b.min.x>M)break;if(!(g<b.min.y||y>b.max.y)&&!(S&&(C.isStatic||C.isSleeping))&&u(w.collisionFilter,C.collisionFilter)){var V=C.parts.length;if(A&&V===1){var E=t(w,C,h);E&&(l[f++]=E)}else for(var B=x>1?1:0,D=V>1?1:0,L=B;L<x;L++)for(var k=w.parts[L],P=k.bounds,R=D;R<V;R++){var O=C.parts[R],b=O.bounds;if(!(P.min.x>b.max.x||P.max.x<b.min.x||P.max.y<b.min.y||P.min.y>b.max.y)){var E=t(k,O,h);E&&(l[f++]=E)}}}}}return l.length!==f&&(l.length=f),l},e.canCollide=function(o,h){return o.group===h.group&&o.group!==0?o.group>0:(o.mask&h.category)!==0&&(h.mask&o.category)!==0},e._compareBoundsX=function(o,h){return o.bounds.min.x-h.bounds.min.x}})()},function(i,d,c){var e={};i.exports=e;var r=c(0);(function(){e.create=function(s){var o={};return s||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),o.element=s||document.body,o.absolute={x:0,y:0},o.position={x:0,y:0},o.mousedownPosition={x:0,y:0},o.mouseupPosition={x:0,y:0},o.offset={x:0,y:0},o.scale={x:1,y:1},o.wheelDelta=0,o.button=-1,o.pixelRatio=parseInt(o.element.getAttribute("data-pixel-ratio"),10)||1,o.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},o.mousemove=function(h){var a=e._getRelativeMousePosition(h,o.element,o.pixelRatio),m=h.changedTouches;m&&(o.button=0,h.preventDefault()),o.absolute.x=a.x,o.absolute.y=a.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.sourceEvents.mousemove=h},o.mousedown=function(h){var a=e._getRelativeMousePosition(h,o.element,o.pixelRatio),m=h.changedTouches;m?(o.button=0,h.preventDefault()):o.button=h.button,o.absolute.x=a.x,o.absolute.y=a.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mousedownPosition.x=o.position.x,o.mousedownPosition.y=o.position.y,o.sourceEvents.mousedown=h},o.mouseup=function(h){var a=e._getRelativeMousePosition(h,o.element,o.pixelRatio),m=h.changedTouches;m&&h.preventDefault(),o.button=-1,o.absolute.x=a.x,o.absolute.y=a.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mouseupPosition.x=o.position.x,o.mouseupPosition.y=o.position.y,o.sourceEvents.mouseup=h},o.mousewheel=function(h){o.wheelDelta=Math.max(-1,Math.min(1,h.wheelDelta||-h.detail)),h.preventDefault(),o.sourceEvents.mousewheel=h},e.setElement(o,o.element),o},e.setElement=function(s,o){s.element=o,o.addEventListener("mousemove",s.mousemove,{passive:!0}),o.addEventListener("mousedown",s.mousedown,{passive:!0}),o.addEventListener("mouseup",s.mouseup,{passive:!0}),o.addEventListener("wheel",s.mousewheel,{passive:!1}),o.addEventListener("touchmove",s.mousemove,{passive:!1}),o.addEventListener("touchstart",s.mousedown,{passive:!1}),o.addEventListener("touchend",s.mouseup,{passive:!1})},e.clearSourceEvents=function(s){s.sourceEvents.mousemove=null,s.sourceEvents.mousedown=null,s.sourceEvents.mouseup=null,s.sourceEvents.mousewheel=null,s.wheelDelta=0},e.setOffset=function(s,o){s.offset.x=o.x,s.offset.y=o.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y},e.setScale=function(s,o){s.scale.x=o.x,s.scale.y=o.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y},e._getRelativeMousePosition=function(s,o,h){var a=o.getBoundingClientRect(),m=document.documentElement||document.body.parentNode||document.body,u=window.pageXOffset!==void 0?window.pageXOffset:m.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:m.scrollTop,l=s.changedTouches,f,p;return l?(f=l[0].pageX-a.left-u,p=l[0].pageY-a.top-t):(f=s.pageX-a.left-u,p=s.pageY-a.top-t),{x:f/(o.clientWidth/(o.width||o.clientWidth)*h),y:p/(o.clientHeight/(o.height||o.clientHeight)*h)}}})()},function(i,d,c){var e={};i.exports=e;var r=c(0);(function(){e._registry={},e.register=function(s){if(e.isPlugin(s)||r.warn("Plugin.register:",e.toString(s),"does not implement all required fields."),s.name in e._registry){var o=e._registry[s.name],h=e.versionParse(s.version).number,a=e.versionParse(o.version).number;h>a?(r.warn("Plugin.register:",e.toString(o),"was upgraded to",e.toString(s)),e._registry[s.name]=s):h<a?r.warn("Plugin.register:",e.toString(o),"can not be downgraded to",e.toString(s)):s!==o&&r.warn("Plugin.register:",e.toString(s),"is already registered to different plugin object")}else e._registry[s.name]=s;return s},e.resolve=function(s){return e._registry[e.dependencyParse(s).name]},e.toString=function(s){return typeof s=="string"?s:(s.name||"anonymous")+"@"+(s.version||s.range||"0.0.0")},e.isPlugin=function(s){return s&&s.name&&s.version&&s.install},e.isUsed=function(s,o){return s.used.indexOf(o)>-1},e.isFor=function(s,o){var h=s.for&&e.dependencyParse(s.for);return!s.for||o.name===h.name&&e.versionSatisfies(o.version,h.range)},e.use=function(s,o){if(s.uses=(s.uses||[]).concat(o||[]),s.uses.length===0){r.warn("Plugin.use:",e.toString(s),"does not specify any dependencies to install.");return}for(var h=e.dependencies(s),a=r.topologicalSort(h),m=[],u=0;u<a.length;u+=1)if(a[u]!==s.name){var t=e.resolve(a[u]);if(!t){m.push(" "+a[u]);continue}e.isUsed(s,t.name)||(e.isFor(t,s)||(r.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(s)+"."),t._warned=!0),t.install?t.install(s):(r.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(m.push(" "+e.toString(t)),delete t._warned):m.push(" "+e.toString(t)),s.used.push(t.name))}m.length>0&&r.info(m.join("  "))},e.dependencies=function(s,o){var h=e.dependencyParse(s),a=h.name;if(o=o||{},!(a in o)){s=e.resolve(s)||s,o[a]=r.map(s.uses||[],function(u){e.isPlugin(u)&&e.register(u);var t=e.dependencyParse(u),l=e.resolve(u);return l&&!e.versionSatisfies(l.version,t.range)?(r.warn("Plugin.dependencies:",e.toString(l),"does not satisfy",e.toString(t),"used by",e.toString(h)+"."),l._warned=!0,s._warned=!0):l||(r.warn("Plugin.dependencies:",e.toString(u),"used by",e.toString(h),"could not be resolved."),s._warned=!0),t.name});for(var m=0;m<o[a].length;m+=1)e.dependencies(o[a][m],o);return o}},e.dependencyParse=function(s){if(r.isString(s)){var o=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return o.test(s)||r.warn("Plugin.dependencyParse:",s,"is not a valid dependency string."),{name:s.split("@")[0],range:s.split("@")[1]||"*"}}return{name:s.name,range:s.range||s.version}},e.versionParse=function(s){var o=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;o.test(s)||r.warn("Plugin.versionParse:",s,"is not a valid version or range.");var h=o.exec(s),a=Number(h[4]),m=Number(h[5]),u=Number(h[6]);return{isRange:!!(h[1]||h[2]),version:h[3],range:s,operator:h[1]||h[2]||"",major:a,minor:m,patch:u,parts:[a,m,u],prerelease:h[7],number:a*1e8+m*1e4+u}},e.versionSatisfies=function(s,o){o=o||"*";var h=e.versionParse(o),a=e.versionParse(s);if(h.isRange){if(h.operator==="*"||s==="*")return!0;if(h.operator===">")return a.number>h.number;if(h.operator===">=")return a.number>=h.number;if(h.operator==="~")return a.major===h.major&&a.minor===h.minor&&a.patch>=h.patch;if(h.operator==="^")return h.major>0?a.major===h.major&&a.number>=h.number:h.minor>0?a.minor===h.minor&&a.patch>=h.patch:a.patch===h.patch}return s===o||s==="*"}})()},function(i,d){var c={};i.exports=c,function(){c.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}}()},function(i,d,c){var e={};i.exports=e;var r=c(7),s=c(18),o=c(13),h=c(19),a=c(5),m=c(6),u=c(10),t=c(0),l=c(4);(function(){e._deltaMax=1e3/60,e.create=function(f){f=f||{};var p={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},v=t.extend(p,f);return v.world=f.world||m.create({label:"World"}),v.pairs=f.pairs||h.create(),v.detector=f.detector||o.create(),v.detector.pairs=v.pairs,v.grid={buckets:[]},v.world.gravity=v.gravity,v.broadphase=v.grid,v.metrics={},v},e.update=function(f,p){var v=t.now(),w=f.world,P=f.detector,M=f.pairs,g=f.timing,y=g.timestamp,S;p>e._deltaMax&&t.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",e._deltaMax.toFixed(3),"ms."),p=typeof p<"u"?p:t._baseDelta,p*=g.timeScale,g.timestamp+=p,g.lastDelta=p;var x={timestamp:g.timestamp,delta:p};a.trigger(f,"beforeUpdate",x);var A=m.allBodies(w),C=m.allConstraints(w);for(w.isModified&&(o.setBodies(P,A),m.setModified(w,!1,!1,!0)),f.enableSleeping&&r.update(A,p),e._bodiesApplyGravity(A,f.gravity),p>0&&e._bodiesUpdate(A,p),a.trigger(f,"beforeSolve",x),u.preSolveAll(A),S=0;S<f.constraintIterations;S++)u.solveAll(C,p);u.postSolveAll(A);var b=o.collisions(P);h.update(M,b,y),f.enableSleeping&&r.afterCollisions(M.list),M.collisionStart.length>0&&a.trigger(f,"collisionStart",{pairs:M.collisionStart,timestamp:g.timestamp,delta:p});var V=t.clamp(20/f.positionIterations,0,1);for(s.preSolvePosition(M.list),S=0;S<f.positionIterations;S++)s.solvePosition(M.list,p,V);for(s.postSolvePosition(A),u.preSolveAll(A),S=0;S<f.constraintIterations;S++)u.solveAll(C,p);for(u.postSolveAll(A),s.preSolveVelocity(M.list),S=0;S<f.velocityIterations;S++)s.solveVelocity(M.list,p);return e._bodiesUpdateVelocities(A),M.collisionActive.length>0&&a.trigger(f,"collisionActive",{pairs:M.collisionActive,timestamp:g.timestamp,delta:p}),M.collisionEnd.length>0&&a.trigger(f,"collisionEnd",{pairs:M.collisionEnd,timestamp:g.timestamp,delta:p}),e._bodiesClearForces(A),a.trigger(f,"afterUpdate",x),f.timing.lastElapsed=t.now()-v,f},e.merge=function(f,p){if(t.extend(f,p),p.world){f.world=p.world,e.clear(f);for(var v=m.allBodies(f.world),w=0;w<v.length;w++){var P=v[w];r.set(P,!1),P.id=t.nextId()}}},e.clear=function(f){h.clear(f.pairs),o.clear(f.detector)},e._bodiesClearForces=function(f){for(var p=f.length,v=0;v<p;v++){var w=f[v];w.force.x=0,w.force.y=0,w.torque=0}},e._bodiesApplyGravity=function(f,p){var v=typeof p.scale<"u"?p.scale:.001,w=f.length;if(!(p.x===0&&p.y===0||v===0))for(var P=0;P<w;P++){var M=f[P];M.isStatic||M.isSleeping||(M.force.y+=M.mass*p.y*v,M.force.x+=M.mass*p.x*v)}},e._bodiesUpdate=function(f,p){for(var v=f.length,w=0;w<v;w++){var P=f[w];P.isStatic||P.isSleeping||l.update(P,p)}},e._bodiesUpdateVelocities=function(f){for(var p=f.length,v=0;v<p;v++)l.updateVelocities(f[v])}})()},function(i,d,c){var e={};i.exports=e;var r=c(3),s=c(0),o=c(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(h){var a,m,u,t=h.length;for(a=0;a<t;a++)m=h[a],m.isActive&&(u=m.contactCount,m.collision.parentA.totalContacts+=u,m.collision.parentB.totalContacts+=u)},e.solvePosition=function(h,a,m){var u,t,l,f,p,v,w,P,M=e._positionDampen*(m||1),g=s.clamp(a/s._baseDelta,0,1),y=h.length;for(u=0;u<y;u++)t=h[u],!(!t.isActive||t.isSensor)&&(l=t.collision,f=l.parentA,p=l.parentB,v=l.normal,t.separation=l.depth+v.x*(p.positionImpulse.x-f.positionImpulse.x)+v.y*(p.positionImpulse.y-f.positionImpulse.y));for(u=0;u<y;u++)t=h[u],!(!t.isActive||t.isSensor)&&(l=t.collision,f=l.parentA,p=l.parentB,v=l.normal,P=t.separation-t.slop*g,(f.isStatic||p.isStatic)&&(P*=2),f.isStatic||f.isSleeping||(w=M/f.totalContacts,f.positionImpulse.x+=v.x*P*w,f.positionImpulse.y+=v.y*P*w),p.isStatic||p.isSleeping||(w=M/p.totalContacts,p.positionImpulse.x-=v.x*P*w,p.positionImpulse.y-=v.y*P*w))},e.postSolvePosition=function(h){for(var a=e._positionWarming,m=h.length,u=r.translate,t=o.update,l=0;l<m;l++){var f=h[l],p=f.positionImpulse,v=p.x,w=p.y,P=f.velocity;if(f.totalContacts=0,v!==0||w!==0){for(var M=0;M<f.parts.length;M++){var g=f.parts[M];u(g.vertices,p),t(g.bounds,g.vertices,P),g.position.x+=v,g.position.y+=w}f.positionPrev.x+=v,f.positionPrev.y+=w,v*P.x+w*P.y<0?(p.x=0,p.y=0):(p.x*=a,p.y*=a)}}},e.preSolveVelocity=function(h){var a=h.length,m,u;for(m=0;m<a;m++){var t=h[m];if(!(!t.isActive||t.isSensor)){var l=t.contacts,f=t.contactCount,p=t.collision,v=p.parentA,w=p.parentB,P=p.normal,M=p.tangent;for(u=0;u<f;u++){var g=l[u],y=g.vertex,S=g.normalImpulse,x=g.tangentImpulse;if(S!==0||x!==0){var A=P.x*S+M.x*x,C=P.y*S+M.y*x;v.isStatic||v.isSleeping||(v.positionPrev.x+=A*v.inverseMass,v.positionPrev.y+=C*v.inverseMass,v.anglePrev+=v.inverseInertia*((y.x-v.position.x)*C-(y.y-v.position.y)*A)),w.isStatic||w.isSleeping||(w.positionPrev.x-=A*w.inverseMass,w.positionPrev.y-=C*w.inverseMass,w.anglePrev-=w.inverseInertia*((y.x-w.position.x)*C-(y.y-w.position.y)*A))}}}}},e.solveVelocity=function(h,a){var m=a/s._baseDelta,u=m*m,t=u*m,l=-e._restingThresh*m,f=e._restingThreshTangent,p=e._frictionNormalMultiplier*m,v=e._frictionMaxStatic,w=h.length,P,M,g,y;for(g=0;g<w;g++){var S=h[g];if(!(!S.isActive||S.isSensor)){var x=S.collision,A=x.parentA,C=x.parentB,b=x.normal.x,V=x.normal.y,E=x.tangent.x,B=x.tangent.y,D=S.inverseMass,L=S.friction*S.frictionStatic*p,k=S.contacts,R=S.contactCount,O=1/R,z=A.position.x-A.positionPrev.x,H=A.position.y-A.positionPrev.y,W=A.angle-A.anglePrev,G=C.position.x-C.positionPrev.x,Y=C.position.y-C.positionPrev.y,Q=C.angle-C.anglePrev;for(y=0;y<R;y++){var F=k[y],$=F.vertex,U=$.x-A.position.x,K=$.y-A.position.y,X=$.x-C.position.x,Z=$.y-C.position.y,N=z-K*W,Se=H+U*W,le=G-Z*Q,ct=Y+X*Q,Le=N-le,Ie=Se-ct,Ce=b*Le+V*Ie,_=E*Le+B*Ie,Re=S.separation+Ce,Pe=Math.min(Re,1);Pe=Re<0?0:Pe;var Fe=Pe*L;_<-Fe||_>Fe?(M=_>0?_:-_,P=S.friction*(_>0?1:-1)*t,P<-M?P=-M:P>M&&(P=M)):(P=_,M=v);var Oe=U*V-K*b,ze=X*V-Z*b,He=O/(D+A.inverseInertia*Oe*Oe+C.inverseInertia*ze*ze),ce=(1+S.restitution)*Ce*He;if(P*=He,Ce<l)F.normalImpulse=0;else{var ut=F.normalImpulse;F.normalImpulse+=ce,F.normalImpulse>0&&(F.normalImpulse=0),ce=F.normalImpulse-ut}if(_<-f||_>f)F.tangentImpulse=0;else{var ft=F.tangentImpulse;F.tangentImpulse+=P,F.tangentImpulse<-M&&(F.tangentImpulse=-M),F.tangentImpulse>M&&(F.tangentImpulse=M),P=F.tangentImpulse-ft}var ue=b*ce+E*P,fe=V*ce+B*P;A.isStatic||A.isSleeping||(A.positionPrev.x+=ue*A.inverseMass,A.positionPrev.y+=fe*A.inverseMass,A.anglePrev+=(U*fe-K*ue)*A.inverseInertia),C.isStatic||C.isSleeping||(C.positionPrev.x-=ue*C.inverseMass,C.positionPrev.y-=fe*C.inverseMass,C.anglePrev-=(X*fe-Z*ue)*C.inverseInertia)}}}}})()},function(i,d,c){var e={};i.exports=e;var r=c(9),s=c(0);(function(){e.create=function(o){return s.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},o)},e.update=function(o,h,a){var m=r.update,u=r.create,t=r.setActive,l=o.table,f=o.list,p=f.length,v=p,w=o.collisionStart,P=o.collisionEnd,M=o.collisionActive,g=h.length,y=0,S=0,x=0,A,C,b;for(b=0;b<g;b++)A=h[b],C=A.pair,C?(C.isActive&&(M[x++]=C),m(C,A,a)):(C=u(A,a),l[C.id]=C,w[y++]=C,f[v++]=C);for(v=0,p=f.length,b=0;b<p;b++)C=f[b],C.timeUpdated>=a?f[v++]=C:(t(C,!1,a),C.collision.bodyA.sleepCounter>0&&C.collision.bodyB.sleepCounter>0?f[v++]=C:(P[S++]=C,delete l[C.id]));f.length!==v&&(f.length=v),w.length!==y&&(w.length=y),P.length!==S&&(P.length=S),M.length!==x&&(M.length=x)},e.clear=function(o){return o.table={},o.list.length=0,o.collisionStart.length=0,o.collisionActive.length=0,o.collisionEnd.length=0,o}})()},function(i,d,c){var e=i.exports=c(21);e.Axes=c(11),e.Bodies=c(12),e.Body=c(4),e.Bounds=c(1),e.Collision=c(8),e.Common=c(0),e.Composite=c(6),e.Composites=c(22),e.Constraint=c(10),e.Contact=c(16),e.Detector=c(13),e.Engine=c(17),e.Events=c(5),e.Grid=c(23),e.Mouse=c(14),e.MouseConstraint=c(24),e.Pair=c(9),e.Pairs=c(19),e.Plugin=c(15),e.Query=c(25),e.Render=c(26),e.Resolver=c(18),e.Runner=c(27),e.SAT=c(28),e.Sleeping=c(7),e.Svg=c(29),e.Vector=c(2),e.Vertices=c(3),e.World=c(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(i,d,c){var e={};i.exports=e;var r=c(15),s=c(0);(function(){e.name="matter-js",e.version="0.20.0",e.uses=[],e.used=[],e.use=function(){r.use(e,Array.prototype.slice.call(arguments))},e.before=function(o,h){return o=o.replace(/^Matter./,""),s.chainPathBefore(e,o,h)},e.after=function(o,h){return o=o.replace(/^Matter./,""),s.chainPathAfter(e,o,h)}})()},function(i,d,c){var e={};i.exports=e;var r=c(6),s=c(10),o=c(0),h=c(4),a=c(12),m=o.deprecated;(function(){e.stack=function(u,t,l,f,p,v,w){for(var P=r.create({label:"Stack"}),M=u,g=t,y,S=0,x=0;x<f;x++){for(var A=0,C=0;C<l;C++){var b=w(M,g,C,x,y,S);if(b){var V=b.bounds.max.y-b.bounds.min.y,E=b.bounds.max.x-b.bounds.min.x;V>A&&(A=V),h.translate(b,{x:E*.5,y:V*.5}),M=b.bounds.max.x+p,r.addBody(P,b),y=b,S+=1}else M+=p}g+=A+v,M=u}return P},e.chain=function(u,t,l,f,p,v){for(var w=u.bodies,P=1;P<w.length;P++){var M=w[P-1],g=w[P],y=M.bounds.max.y-M.bounds.min.y,S=M.bounds.max.x-M.bounds.min.x,x=g.bounds.max.y-g.bounds.min.y,A=g.bounds.max.x-g.bounds.min.x,C={bodyA:M,pointA:{x:S*t,y:y*l},bodyB:g,pointB:{x:A*f,y:x*p}},b=o.extend(C,v);r.addConstraint(u,s.create(b))}return u.label+=" Chain",u},e.mesh=function(u,t,l,f,p){var v=u.bodies,w,P,M,g,y;for(w=0;w<l;w++){for(P=1;P<t;P++)M=v[P-1+w*t],g=v[P+w*t],r.addConstraint(u,s.create(o.extend({bodyA:M,bodyB:g},p)));if(w>0)for(P=0;P<t;P++)M=v[P+(w-1)*t],g=v[P+w*t],r.addConstraint(u,s.create(o.extend({bodyA:M,bodyB:g},p))),f&&P>0&&(y=v[P-1+(w-1)*t],r.addConstraint(u,s.create(o.extend({bodyA:y,bodyB:g},p)))),f&&P<t-1&&(y=v[P+1+(w-1)*t],r.addConstraint(u,s.create(o.extend({bodyA:y,bodyB:g},p))))}return u.label+=" Mesh",u},e.pyramid=function(u,t,l,f,p,v,w){return e.stack(u,t,l,f,p,v,function(P,M,g,y,S,x){var A=Math.min(f,Math.ceil(l/2)),C=S?S.bounds.max.x-S.bounds.min.x:0;if(!(y>A)){y=A-y;var b=y,V=l-1-y;if(!(g<b||g>V)){x===1&&h.translate(S,{x:(g+(l%2===1?1:-1))*C,y:0});var E=S?g*C:0;return w(u+E+g*p,M,g,y,S,x)}}})},e.newtonsCradle=function(u,t,l,f,p){for(var v=r.create({label:"Newtons Cradle"}),w=0;w<l;w++){var P=1.9,M=a.circle(u+w*(f*P),t+p,f,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),g=s.create({pointA:{x:u+w*(f*P),y:t},bodyB:M});r.addBody(v,M),r.addConstraint(v,g)}return v},m(e,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),e.car=function(u,t,l,f,p){var v=h.nextGroup(!0),w=20,P=-l*.5+w,M=l*.5-w,g=0,y=r.create({label:"Car"}),S=a.rectangle(u,t,l,f,{collisionFilter:{group:v},chamfer:{radius:f*.5},density:2e-4}),x=a.circle(u+P,t+g,p,{collisionFilter:{group:v},friction:.8}),A=a.circle(u+M,t+g,p,{collisionFilter:{group:v},friction:.8}),C=s.create({bodyB:S,pointB:{x:P,y:g},bodyA:x,stiffness:1,length:0}),b=s.create({bodyB:S,pointB:{x:M,y:g},bodyA:A,stiffness:1,length:0});return r.addBody(y,S),r.addBody(y,x),r.addBody(y,A),r.addConstraint(y,C),r.addConstraint(y,b),y},m(e,"car","Composites.car  moved to car example"),e.softBody=function(u,t,l,f,p,v,w,P,M,g){M=o.extend({inertia:1/0},M),g=o.extend({stiffness:.2,render:{type:"line",anchors:!1}},g);var y=e.stack(u,t,l,f,p,v,function(S,x){return a.circle(S,x,P,M)});return e.mesh(y,l,f,w,g),y.label="Soft Body",y},m(e,"softBody","Composites.softBody  moved to softBody and cloth examples")})()},function(i,d,c){var e={};i.exports=e;var r=c(9),s=c(0),o=s.deprecated;(function(){e.create=function(h){var a={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(a,h)},e.update=function(h,a,m,u){var t,l,f,p=m.world,v=h.buckets,w,P,M=!1;for(t=0;t<a.length;t++){var g=a[t];if(!(g.isSleeping&&!u)&&!(p.bounds&&(g.bounds.max.x<p.bounds.min.x||g.bounds.min.x>p.bounds.max.x||g.bounds.max.y<p.bounds.min.y||g.bounds.min.y>p.bounds.max.y))){var y=e._getRegion(h,g);if(!g.region||y.id!==g.region.id||u){(!g.region||u)&&(g.region=y);var S=e._regionUnion(y,g.region);for(l=S.startCol;l<=S.endCol;l++)for(f=S.startRow;f<=S.endRow;f++){P=e._getBucketId(l,f),w=v[P];var x=l>=y.startCol&&l<=y.endCol&&f>=y.startRow&&f<=y.endRow,A=l>=g.region.startCol&&l<=g.region.endCol&&f>=g.region.startRow&&f<=g.region.endRow;!x&&A&&A&&w&&e._bucketRemoveBody(h,w,g),(g.region===y||x&&!A||u)&&(w||(w=e._createBucket(v,P)),e._bucketAddBody(h,w,g))}g.region=y,M=!0}}}M&&(h.pairsList=e._createActivePairsList(h))},o(e,"update","Grid.update  replaced by Matter.Detector"),e.clear=function(h){h.buckets={},h.pairs={},h.pairsList=[]},o(e,"clear","Grid.clear  replaced by Matter.Detector"),e._regionUnion=function(h,a){var m=Math.min(h.startCol,a.startCol),u=Math.max(h.endCol,a.endCol),t=Math.min(h.startRow,a.startRow),l=Math.max(h.endRow,a.endRow);return e._createRegion(m,u,t,l)},e._getRegion=function(h,a){var m=a.bounds,u=Math.floor(m.min.x/h.bucketWidth),t=Math.floor(m.max.x/h.bucketWidth),l=Math.floor(m.min.y/h.bucketHeight),f=Math.floor(m.max.y/h.bucketHeight);return e._createRegion(u,t,l,f)},e._createRegion=function(h,a,m,u){return{id:h+","+a+","+m+","+u,startCol:h,endCol:a,startRow:m,endRow:u}},e._getBucketId=function(h,a){return"C"+h+"R"+a},e._createBucket=function(h,a){var m=h[a]=[];return m},e._bucketAddBody=function(h,a,m){var u=h.pairs,t=r.id,l=a.length,f;for(f=0;f<l;f++){var p=a[f];if(!(m.id===p.id||m.isStatic&&p.isStatic)){var v=t(m,p),w=u[v];w?w[2]+=1:u[v]=[m,p,1]}}a.push(m)},e._bucketRemoveBody=function(h,a,m){var u=h.pairs,t=r.id,l;a.splice(s.indexOf(a,m),1);var f=a.length;for(l=0;l<f;l++){var p=u[t(m,a[l])];p&&(p[2]-=1)}},e._createActivePairsList=function(h){var a,m=h.pairs,u=s.keys(m),t=u.length,l=[],f;for(f=0;f<t;f++)a=m[u[f]],a[2]>0?l.push(a):delete m[u[f]];return l}})()},function(i,d,c){var e={};i.exports=e;var r=c(3),s=c(7),o=c(14),h=c(5),a=c(13),m=c(10),u=c(6),t=c(0),l=c(1);(function(){e.create=function(f,p){var v=(f?f.mouse:null)||(p?p.mouse:null);v||(f&&f.render&&f.render.canvas?v=o.create(f.render.canvas):p&&p.element?v=o.create(p.element):(v=o.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var w=m.create({label:"Mouse Constraint",pointA:v.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),P={type:"mouseConstraint",mouse:v,element:null,body:null,constraint:w,collisionFilter:{category:1,mask:4294967295,group:0}},M=t.extend(P,p);return h.on(f,"beforeUpdate",function(){var g=u.allBodies(f.world);e.update(M,g),e._triggerEvents(M)}),M},e.update=function(f,p){var v=f.mouse,w=f.constraint,P=f.body;if(v.button===0){if(w.bodyB)s.set(w.bodyB,!1),w.pointA=v.position;else for(var M=0;M<p.length;M++)if(P=p[M],l.contains(P.bounds,v.position)&&a.canCollide(P.collisionFilter,f.collisionFilter))for(var g=P.parts.length>1?1:0;g<P.parts.length;g++){var y=P.parts[g];if(r.contains(y.vertices,v.position)){w.pointA=v.position,w.bodyB=f.body=P,w.pointB={x:v.position.x-P.position.x,y:v.position.y-P.position.y},w.angleB=P.angle,s.set(P,!1),h.trigger(f,"startdrag",{mouse:v,body:P});break}}}else w.bodyB=f.body=null,w.pointB=null,P&&h.trigger(f,"enddrag",{mouse:v,body:P})},e._triggerEvents=function(f){var p=f.mouse,v=p.sourceEvents;v.mousemove&&h.trigger(f,"mousemove",{mouse:p}),v.mousedown&&h.trigger(f,"mousedown",{mouse:p}),v.mouseup&&h.trigger(f,"mouseup",{mouse:p}),o.clearSourceEvents(p)}})()},function(i,d,c){var e={};i.exports=e;var r=c(2),s=c(8),o=c(1),h=c(12),a=c(3);(function(){e.collides=function(m,u){for(var t=[],l=u.length,f=m.bounds,p=s.collides,v=o.overlaps,w=0;w<l;w++){var P=u[w],M=P.parts.length,g=M===1?0:1;if(v(P.bounds,f))for(var y=g;y<M;y++){var S=P.parts[y];if(v(S.bounds,f)){var x=p(S,m);if(x){t.push(x);break}}}}return t},e.ray=function(m,u,t,l){l=l||1e-100;for(var f=r.angle(u,t),p=r.magnitude(r.sub(u,t)),v=(t.x+u.x)*.5,w=(t.y+u.y)*.5,P=h.rectangle(v,w,p,l,{angle:f}),M=e.collides(P,m),g=0;g<M.length;g+=1){var y=M[g];y.body=y.bodyB=y.bodyA}return M},e.region=function(m,u,t){for(var l=[],f=0;f<m.length;f++){var p=m[f],v=o.overlaps(p.bounds,u);(v&&!t||!v&&t)&&l.push(p)}return l},e.point=function(m,u){for(var t=[],l=0;l<m.length;l++){var f=m[l];if(o.contains(f.bounds,u))for(var p=f.parts.length===1?0:1;p<f.parts.length;p++){var v=f.parts[p];if(o.contains(v.bounds,u)&&a.contains(v.vertices,u)){t.push(f);break}}}return t}})()},function(i,d,c){var e={};i.exports=e;var r=c(4),s=c(0),o=c(6),h=c(1),a=c(5),m=c(2),u=c(14);(function(){var t,l;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(g){window.setTimeout(function(){g(s.now())},1e3/60)},l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(g){var y={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!g.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},S=s.extend(y,g);return S.canvas&&(S.canvas.width=S.options.width||S.canvas.width,S.canvas.height=S.options.height||S.canvas.height),S.mouse=g.mouse,S.engine=g.engine,S.canvas=S.canvas||v(S.options.width,S.options.height),S.context=S.canvas.getContext("2d"),S.textures={},S.bounds=S.bounds||{min:{x:0,y:0},max:{x:S.canvas.width,y:S.canvas.height}},S.controller=e,S.options.showBroadphase=!1,S.options.pixelRatio!==1&&e.setPixelRatio(S,S.options.pixelRatio),s.isElement(S.element)&&S.element.appendChild(S.canvas),S},e.run=function(g){(function y(S){g.frameRequestId=t(y),f(g,S),e.world(g,S),g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0),(g.options.showStats||g.options.showDebug)&&e.stats(g,g.context,S),(g.options.showPerformance||g.options.showDebug)&&e.performance(g,g.context,S),g.context.setTransform(1,0,0,1,0,0)})()},e.stop=function(g){l(g.frameRequestId)},e.setPixelRatio=function(g,y){var S=g.options,x=g.canvas;y==="auto"&&(y=w(x)),S.pixelRatio=y,x.setAttribute("data-pixel-ratio",y),x.width=S.width*y,x.height=S.height*y,x.style.width=S.width+"px",x.style.height=S.height+"px"},e.setSize=function(g,y,S){g.options.width=y,g.options.height=S,g.bounds.max.x=g.bounds.min.x+y,g.bounds.max.y=g.bounds.min.y+S,g.options.pixelRatio!==1?e.setPixelRatio(g,g.options.pixelRatio):(g.canvas.width=y,g.canvas.height=S)},e.lookAt=function(g,y,S,x){x=typeof x<"u"?x:!0,y=s.isArray(y)?y:[y],S=S||{x:0,y:0};for(var A={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},C=0;C<y.length;C+=1){var b=y[C],V=b.bounds?b.bounds.min:b.min||b.position||b,E=b.bounds?b.bounds.max:b.max||b.position||b;V&&E&&(V.x<A.min.x&&(A.min.x=V.x),E.x>A.max.x&&(A.max.x=E.x),V.y<A.min.y&&(A.min.y=V.y),E.y>A.max.y&&(A.max.y=E.y))}var B=A.max.x-A.min.x+2*S.x,D=A.max.y-A.min.y+2*S.y,L=g.canvas.height,k=g.canvas.width,R=k/L,O=B/D,z=1,H=1;O>R?H=O/R:z=R/O,g.options.hasBounds=!0,g.bounds.min.x=A.min.x,g.bounds.max.x=A.min.x+B*z,g.bounds.min.y=A.min.y,g.bounds.max.y=A.min.y+D*H,x&&(g.bounds.min.x+=B*.5-B*z*.5,g.bounds.max.x+=B*.5-B*z*.5,g.bounds.min.y+=D*.5-D*H*.5,g.bounds.max.y+=D*.5-D*H*.5),g.bounds.min.x-=S.x,g.bounds.max.x-=S.x,g.bounds.min.y-=S.y,g.bounds.max.y-=S.y,g.mouse&&(u.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.canvas.width,y:(g.bounds.max.y-g.bounds.min.y)/g.canvas.height}),u.setOffset(g.mouse,g.bounds.min))},e.startViewTransform=function(g){var y=g.bounds.max.x-g.bounds.min.x,S=g.bounds.max.y-g.bounds.min.y,x=y/g.options.width,A=S/g.options.height;g.context.setTransform(g.options.pixelRatio/x,0,0,g.options.pixelRatio/A,0,0),g.context.translate(-g.bounds.min.x,-g.bounds.min.y)},e.endViewTransform=function(g){g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0)},e.world=function(g,y){var S=s.now(),x=g.engine,A=x.world,C=g.canvas,b=g.context,V=g.options,E=g.timing,B=o.allBodies(A),D=o.allConstraints(A),L=V.wireframes?V.wireframeBackground:V.background,k=[],R=[],O,z={timestamp:x.timing.timestamp};if(a.trigger(g,"beforeRender",z),g.currentBackground!==L&&M(g,L),b.globalCompositeOperation="source-in",b.fillStyle="transparent",b.fillRect(0,0,C.width,C.height),b.globalCompositeOperation="source-over",V.hasBounds){for(O=0;O<B.length;O++){var H=B[O];h.overlaps(H.bounds,g.bounds)&&k.push(H)}for(O=0;O<D.length;O++){var W=D[O],G=W.bodyA,Y=W.bodyB,Q=W.pointA,F=W.pointB;G&&(Q=m.add(G.position,W.pointA)),Y&&(F=m.add(Y.position,W.pointB)),!(!Q||!F)&&(h.contains(g.bounds,Q)||h.contains(g.bounds,F))&&R.push(W)}e.startViewTransform(g),g.mouse&&(u.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.options.width,y:(g.bounds.max.y-g.bounds.min.y)/g.options.height}),u.setOffset(g.mouse,g.bounds.min))}else R=D,k=B,g.options.pixelRatio!==1&&g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0);!V.wireframes||x.enableSleeping&&V.showSleeping?e.bodies(g,k,b):(V.showConvexHulls&&e.bodyConvexHulls(g,k,b),e.bodyWireframes(g,k,b)),V.showBounds&&e.bodyBounds(g,k,b),(V.showAxes||V.showAngleIndicator)&&e.bodyAxes(g,k,b),V.showPositions&&e.bodyPositions(g,k,b),V.showVelocity&&e.bodyVelocity(g,k,b),V.showIds&&e.bodyIds(g,k,b),V.showSeparations&&e.separations(g,x.pairs.list,b),V.showCollisions&&e.collisions(g,x.pairs.list,b),V.showVertexNumbers&&e.vertexNumbers(g,k,b),V.showMousePosition&&e.mousePosition(g,g.mouse,b),e.constraints(R,b),V.hasBounds&&e.endViewTransform(g),a.trigger(g,"afterRender",z),E.lastElapsed=s.now()-S},e.stats=function(g,y,S){for(var x=g.engine,A=x.world,C=o.allBodies(A),b=0,V=55,E=44,B=0,D=0,L=0;L<C.length;L+=1)b+=C[L].parts.length;var k={Part:b,Body:C.length,Cons:o.allConstraints(A).length,Comp:o.allComposites(A).length,Pair:x.pairs.list.length};y.fillStyle="#0e0f19",y.fillRect(B,D,V*5.5,E),y.font="12px Arial",y.textBaseline="top",y.textAlign="right";for(var R in k){var O=k[R];y.fillStyle="#aaa",y.fillText(R,B+V,D+8),y.fillStyle="#eee",y.fillText(O,B+V,D+26),B+=V}},e.performance=function(g,y){var S=g.engine,x=g.timing,A=x.deltaHistory,C=x.elapsedHistory,b=x.timestampElapsedHistory,V=x.engineDeltaHistory,E=x.engineUpdatesHistory,B=x.engineElapsedHistory,D=S.timing.lastUpdatesPerFrame,L=S.timing.lastDelta,k=p(A),R=p(C),O=p(V),z=p(E),H=p(B),W=p(b),G=W/k||0,Y=Math.round(k/L),Q=1e3/k||0,F=4,$=12,U=60,K=34,X=10,Z=69;y.fillStyle="#0e0f19",y.fillRect(0,50,$*5+U*6+22,K),e.status(y,X,Z,U,F,A.length,Math.round(Q)+" fps",Q/e._goodFps,function(N){return A[N]/k-1}),e.status(y,X+$+U,Z,U,F,V.length,L.toFixed(2)+" dt",e._goodDelta/L,function(N){return V[N]/O-1}),e.status(y,X+($+U)*2,Z,U,F,E.length,D+" upf",Math.pow(s.clamp(z/Y||1,0,1),4),function(N){return E[N]/z-1}),e.status(y,X+($+U)*3,Z,U,F,B.length,H.toFixed(2)+" ut",1-D*H/e._goodFps,function(N){return B[N]/H-1}),e.status(y,X+($+U)*4,Z,U,F,C.length,R.toFixed(2)+" rt",1-R/e._goodFps,function(N){return C[N]/R-1}),e.status(y,X+($+U)*5,Z,U,F,b.length,G.toFixed(2)+" x",G*G*G,function(N){return(b[N]/A[N]/G||0)-1})},e.status=function(g,y,S,x,A,C,b,V,E){g.strokeStyle="#888",g.fillStyle="#444",g.lineWidth=1,g.fillRect(y,S+7,x,1),g.beginPath(),g.moveTo(y,S+7-A*s.clamp(.4*E(0),-2,2));for(var B=0;B<x;B+=1)g.lineTo(y+B,S+7-(B<C?A*s.clamp(.4*E(B),-2,2):0));g.stroke(),g.fillStyle="hsl("+s.clamp(25+95*V,0,120)+",100%,60%)",g.fillRect(y,S-7,4,4),g.font="12px Arial",g.textBaseline="middle",g.textAlign="right",g.fillStyle="#eee",g.fillText(b,y+x,S-5)},e.constraints=function(g,y){for(var S=y,x=0;x<g.length;x++){var A=g[x];if(!(!A.render.visible||!A.pointA||!A.pointB)){var C=A.bodyA,b=A.bodyB,V,E;if(C?V=m.add(C.position,A.pointA):V=A.pointA,A.render.type==="pin")S.beginPath(),S.arc(V.x,V.y,3,0,2*Math.PI),S.closePath();else{if(b?E=m.add(b.position,A.pointB):E=A.pointB,S.beginPath(),S.moveTo(V.x,V.y),A.render.type==="spring")for(var B=m.sub(E,V),D=m.perp(m.normalise(B)),L=Math.ceil(s.clamp(A.length/5,12,20)),k,R=1;R<L;R+=1)k=R%2===0?1:-1,S.lineTo(V.x+B.x*(R/L)+D.x*k*4,V.y+B.y*(R/L)+D.y*k*4);S.lineTo(E.x,E.y)}A.render.lineWidth&&(S.lineWidth=A.render.lineWidth,S.strokeStyle=A.render.strokeStyle,S.stroke()),A.render.anchors&&(S.fillStyle=A.render.strokeStyle,S.beginPath(),S.arc(V.x,V.y,3,0,2*Math.PI),S.arc(E.x,E.y,3,0,2*Math.PI),S.closePath(),S.fill())}}},e.bodies=function(g,y,S){var x=S;g.engine;var A=g.options,C=A.showInternalEdges||!A.wireframes,b,V,E,B;for(E=0;E<y.length;E++)if(b=y[E],!!b.render.visible){for(B=b.parts.length>1?1:0;B<b.parts.length;B++)if(V=b.parts[B],!!V.render.visible){if(A.showSleeping&&b.isSleeping?x.globalAlpha=.5*V.render.opacity:V.render.opacity!==1&&(x.globalAlpha=V.render.opacity),V.render.sprite&&V.render.sprite.texture&&!A.wireframes){var D=V.render.sprite,L=P(g,D.texture);x.translate(V.position.x,V.position.y),x.rotate(V.angle),x.drawImage(L,L.width*-D.xOffset*D.xScale,L.height*-D.yOffset*D.yScale,L.width*D.xScale,L.height*D.yScale),x.rotate(-V.angle),x.translate(-V.position.x,-V.position.y)}else{if(V.circleRadius)x.beginPath(),x.arc(V.position.x,V.position.y,V.circleRadius,0,2*Math.PI);else{x.beginPath(),x.moveTo(V.vertices[0].x,V.vertices[0].y);for(var k=1;k<V.vertices.length;k++)!V.vertices[k-1].isInternal||C?x.lineTo(V.vertices[k].x,V.vertices[k].y):x.moveTo(V.vertices[k].x,V.vertices[k].y),V.vertices[k].isInternal&&!C&&x.moveTo(V.vertices[(k+1)%V.vertices.length].x,V.vertices[(k+1)%V.vertices.length].y);x.lineTo(V.vertices[0].x,V.vertices[0].y),x.closePath()}A.wireframes?(x.lineWidth=1,x.strokeStyle=g.options.wireframeStrokeStyle,x.stroke()):(x.fillStyle=V.render.fillStyle,V.render.lineWidth&&(x.lineWidth=V.render.lineWidth,x.strokeStyle=V.render.strokeStyle,x.stroke()),x.fill())}x.globalAlpha=1}}},e.bodyWireframes=function(g,y,S){var x=S,A=g.options.showInternalEdges,C,b,V,E,B;for(x.beginPath(),V=0;V<y.length;V++)if(C=y[V],!!C.render.visible)for(B=C.parts.length>1?1:0;B<C.parts.length;B++){for(b=C.parts[B],x.moveTo(b.vertices[0].x,b.vertices[0].y),E=1;E<b.vertices.length;E++)!b.vertices[E-1].isInternal||A?x.lineTo(b.vertices[E].x,b.vertices[E].y):x.moveTo(b.vertices[E].x,b.vertices[E].y),b.vertices[E].isInternal&&!A&&x.moveTo(b.vertices[(E+1)%b.vertices.length].x,b.vertices[(E+1)%b.vertices.length].y);x.lineTo(b.vertices[0].x,b.vertices[0].y)}x.lineWidth=1,x.strokeStyle=g.options.wireframeStrokeStyle,x.stroke()},e.bodyConvexHulls=function(g,y,S){var x=S,A,C,b;for(x.beginPath(),C=0;C<y.length;C++)if(A=y[C],!(!A.render.visible||A.parts.length===1)){for(x.moveTo(A.vertices[0].x,A.vertices[0].y),b=1;b<A.vertices.length;b++)x.lineTo(A.vertices[b].x,A.vertices[b].y);x.lineTo(A.vertices[0].x,A.vertices[0].y)}x.lineWidth=1,x.strokeStyle="rgba(255,255,255,0.2)",x.stroke()},e.vertexNumbers=function(g,y,S){var x=S,A,C,b;for(A=0;A<y.length;A++){var V=y[A].parts;for(b=V.length>1?1:0;b<V.length;b++){var E=V[b];for(C=0;C<E.vertices.length;C++)x.fillStyle="rgba(255,255,255,0.2)",x.fillText(A+"_"+C,E.position.x+(E.vertices[C].x-E.position.x)*.8,E.position.y+(E.vertices[C].y-E.position.y)*.8)}}},e.mousePosition=function(g,y,S){var x=S;x.fillStyle="rgba(255,255,255,0.8)",x.fillText(y.position.x+"  "+y.position.y,y.position.x+5,y.position.y-5)},e.bodyBounds=function(g,y,S){var x=S;g.engine;var A=g.options;x.beginPath();for(var C=0;C<y.length;C++){var b=y[C];if(b.render.visible)for(var V=y[C].parts,E=V.length>1?1:0;E<V.length;E++){var B=V[E];x.rect(B.bounds.min.x,B.bounds.min.y,B.bounds.max.x-B.bounds.min.x,B.bounds.max.y-B.bounds.min.y)}}A.wireframes?x.strokeStyle="rgba(255,255,255,0.08)":x.strokeStyle="rgba(0,0,0,0.1)",x.lineWidth=1,x.stroke()},e.bodyAxes=function(g,y,S){var x=S;g.engine;var A=g.options,C,b,V,E;for(x.beginPath(),b=0;b<y.length;b++){var B=y[b],D=B.parts;if(B.render.visible)if(A.showAxes)for(V=D.length>1?1:0;V<D.length;V++)for(C=D[V],E=0;E<C.axes.length;E++){var L=C.axes[E];x.moveTo(C.position.x,C.position.y),x.lineTo(C.position.x+L.x*20,C.position.y+L.y*20)}else for(V=D.length>1?1:0;V<D.length;V++)for(C=D[V],E=0;E<C.axes.length;E++)x.moveTo(C.position.x,C.position.y),x.lineTo((C.vertices[0].x+C.vertices[C.vertices.length-1].x)/2,(C.vertices[0].y+C.vertices[C.vertices.length-1].y)/2)}A.wireframes?(x.strokeStyle="indianred",x.lineWidth=1):(x.strokeStyle="rgba(255, 255, 255, 0.4)",x.globalCompositeOperation="overlay",x.lineWidth=2),x.stroke(),x.globalCompositeOperation="source-over"},e.bodyPositions=function(g,y,S){var x=S;g.engine;var A=g.options,C,b,V,E;for(x.beginPath(),V=0;V<y.length;V++)if(C=y[V],!!C.render.visible)for(E=0;E<C.parts.length;E++)b=C.parts[E],x.arc(b.position.x,b.position.y,3,0,2*Math.PI,!1),x.closePath();for(A.wireframes?x.fillStyle="indianred":x.fillStyle="rgba(0,0,0,0.5)",x.fill(),x.beginPath(),V=0;V<y.length;V++)C=y[V],C.render.visible&&(x.arc(C.positionPrev.x,C.positionPrev.y,2,0,2*Math.PI,!1),x.closePath());x.fillStyle="rgba(255,165,0,0.8)",x.fill()},e.bodyVelocity=function(g,y,S){var x=S;x.beginPath();for(var A=0;A<y.length;A++){var C=y[A];if(C.render.visible){var b=r.getVelocity(C);x.moveTo(C.position.x,C.position.y),x.lineTo(C.position.x+b.x,C.position.y+b.y)}}x.lineWidth=3,x.strokeStyle="cornflowerblue",x.stroke()},e.bodyIds=function(g,y,S){var x=S,A,C;for(A=0;A<y.length;A++)if(y[A].render.visible){var b=y[A].parts;for(C=b.length>1?1:0;C<b.length;C++){var V=b[C];x.font="12px Arial",x.fillStyle="rgba(255,255,255,0.5)",x.fillText(V.id,V.position.x+10,V.position.y-10)}}},e.collisions=function(g,y,S){var x=S,A=g.options,C,b,V,E;for(x.beginPath(),V=0;V<y.length;V++)if(C=y[V],!!C.isActive)for(b=C.collision,E=0;E<C.contactCount;E++){var B=C.contacts[E],D=B.vertex;x.rect(D.x-1.5,D.y-1.5,3.5,3.5)}for(A.wireframes?x.fillStyle="rgba(255,255,255,0.7)":x.fillStyle="orange",x.fill(),x.beginPath(),V=0;V<y.length;V++)if(C=y[V],!!C.isActive&&(b=C.collision,C.contactCount>0)){var L=C.contacts[0].vertex.x,k=C.contacts[0].vertex.y;C.contactCount===2&&(L=(C.contacts[0].vertex.x+C.contacts[1].vertex.x)/2,k=(C.contacts[0].vertex.y+C.contacts[1].vertex.y)/2),b.bodyB===b.supports[0].body||b.bodyA.isStatic===!0?x.moveTo(L-b.normal.x*8,k-b.normal.y*8):x.moveTo(L+b.normal.x*8,k+b.normal.y*8),x.lineTo(L,k)}A.wireframes?x.strokeStyle="rgba(255,165,0,0.7)":x.strokeStyle="orange",x.lineWidth=1,x.stroke()},e.separations=function(g,y,S){var x=S,A=g.options,C,b,V,E,B;for(x.beginPath(),B=0;B<y.length;B++)if(C=y[B],!!C.isActive){b=C.collision,V=b.bodyA,E=b.bodyB;var D=1;!E.isStatic&&!V.isStatic&&(D=.5),E.isStatic&&(D=0),x.moveTo(E.position.x,E.position.y),x.lineTo(E.position.x-b.penetration.x*D,E.position.y-b.penetration.y*D),D=1,!E.isStatic&&!V.isStatic&&(D=.5),V.isStatic&&(D=0),x.moveTo(V.position.x,V.position.y),x.lineTo(V.position.x+b.penetration.x*D,V.position.y+b.penetration.y*D)}A.wireframes?x.strokeStyle="rgba(255,165,0,0.5)":x.strokeStyle="orange",x.stroke()},e.inspector=function(g,y){g.engine;var S=g.selected,x=g.render,A=x.options,C;if(A.hasBounds){var b=x.bounds.max.x-x.bounds.min.x,V=x.bounds.max.y-x.bounds.min.y,E=b/x.options.width,B=V/x.options.height;y.scale(1/E,1/B),y.translate(-x.bounds.min.x,-x.bounds.min.y)}for(var D=0;D<S.length;D++){var L=S[D].data;switch(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.9)",y.setLineDash([1,2]),L.type){case"body":C=L.bounds,y.beginPath(),y.rect(Math.floor(C.min.x-3),Math.floor(C.min.y-3),Math.floor(C.max.x-C.min.x+6),Math.floor(C.max.y-C.min.y+6)),y.closePath(),y.stroke();break;case"constraint":var k=L.pointA;L.bodyA&&(k=L.pointB),y.beginPath(),y.arc(k.x,k.y,10,0,2*Math.PI),y.closePath(),y.stroke();break}y.setLineDash([]),y.translate(-.5,-.5)}g.selectStart!==null&&(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.6)",y.fillStyle="rgba(255,165,0,0.1)",C=g.selectBounds,y.beginPath(),y.rect(Math.floor(C.min.x),Math.floor(C.min.y),Math.floor(C.max.x-C.min.x),Math.floor(C.max.y-C.min.y)),y.closePath(),y.stroke(),y.fill(),y.translate(-.5,-.5)),A.hasBounds&&y.setTransform(1,0,0,1,0,0)};var f=function(g,y){var S=g.engine,x=g.timing,A=x.historySize,C=S.timing.timestamp;x.delta=y-x.lastTime||e._goodDelta,x.lastTime=y,x.timestampElapsed=C-x.lastTimestamp||0,x.lastTimestamp=C,x.deltaHistory.unshift(x.delta),x.deltaHistory.length=Math.min(x.deltaHistory.length,A),x.engineDeltaHistory.unshift(S.timing.lastDelta),x.engineDeltaHistory.length=Math.min(x.engineDeltaHistory.length,A),x.timestampElapsedHistory.unshift(x.timestampElapsed),x.timestampElapsedHistory.length=Math.min(x.timestampElapsedHistory.length,A),x.engineUpdatesHistory.unshift(S.timing.lastUpdatesPerFrame),x.engineUpdatesHistory.length=Math.min(x.engineUpdatesHistory.length,A),x.engineElapsedHistory.unshift(S.timing.lastElapsed),x.engineElapsedHistory.length=Math.min(x.engineElapsedHistory.length,A),x.elapsedHistory.unshift(x.lastElapsed),x.elapsedHistory.length=Math.min(x.elapsedHistory.length,A)},p=function(g){for(var y=0,S=0;S<g.length;S+=1)y+=g[S];return y/g.length||0},v=function(g,y){var S=document.createElement("canvas");return S.width=g,S.height=y,S.oncontextmenu=function(){return!1},S.onselectstart=function(){return!1},S},w=function(g){var y=g.getContext("2d"),S=window.devicePixelRatio||1,x=y.webkitBackingStorePixelRatio||y.mozBackingStorePixelRatio||y.msBackingStorePixelRatio||y.oBackingStorePixelRatio||y.backingStorePixelRatio||1;return S/x},P=function(g,y){var S=g.textures[y];return S||(S=g.textures[y]=new Image,S.src=y,S)},M=function(g,y){var S=y;/(jpg|gif|png)$/.test(y)&&(S="url("+y+")"),g.canvas.style.background=S,g.canvas.style.backgroundSize="contain",g.currentBackground=y}})()},function(i,d,c){var e={};i.exports=e;var r=c(5),s=c(17),o=c(0);(function(){e._maxFrameDelta=1e3/15,e._frameDeltaFallback=1e3/60,e._timeBufferMargin=1.5,e._elapsedNextEstimate=1,e._smoothingLowerBound=.1,e._smoothingUpperBound=.9,e.create=function(a){var m={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},u=o.extend(m,a);return u.fps=0,u},e.run=function(a,m){return a.timeBuffer=e._frameDeltaFallback,function u(t){a.frameRequestId=e._onNextFrame(a,u),t&&a.enabled&&e.tick(a,m,t)}(),a},e.tick=function(a,m,u){var t=o.now(),l=a.delta,f=0,p=u-a.timeLastTick;if((!p||!a.timeLastTick||p>Math.max(e._maxFrameDelta,a.maxFrameTime))&&(p=a.frameDelta||e._frameDeltaFallback),a.frameDeltaSmoothing){a.frameDeltaHistory.push(p),a.frameDeltaHistory=a.frameDeltaHistory.slice(-a.frameDeltaHistorySize);var v=a.frameDeltaHistory.slice(0).sort(),w=a.frameDeltaHistory.slice(v.length*e._smoothingLowerBound,v.length*e._smoothingUpperBound),P=h(w);p=P||p}a.frameDeltaSnapping&&(p=1e3/Math.round(1e3/p)),a.frameDelta=p,a.timeLastTick=u,a.timeBuffer+=a.frameDelta,a.timeBuffer=o.clamp(a.timeBuffer,0,a.frameDelta+l*e._timeBufferMargin),a.lastUpdatesDeferred=0;var M=a.maxUpdates||Math.ceil(a.maxFrameTime/l),g={timestamp:m.timing.timestamp};r.trigger(a,"beforeTick",g),r.trigger(a,"tick",g);for(var y=o.now();l>0&&a.timeBuffer>=l*e._timeBufferMargin;){r.trigger(a,"beforeUpdate",g),s.update(m,l),r.trigger(a,"afterUpdate",g),a.timeBuffer-=l,f+=1;var S=o.now()-t,x=o.now()-y,A=S+e._elapsedNextEstimate*x/f;if(f>=M||A>a.maxFrameTime){a.lastUpdatesDeferred=Math.round(Math.max(0,a.timeBuffer/l-e._timeBufferMargin));break}}m.timing.lastUpdatesPerFrame=f,r.trigger(a,"afterTick",g),a.frameDeltaHistory.length>=100&&(a.lastUpdatesDeferred&&Math.round(a.frameDelta/l)>M?o.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):a.lastUpdatesDeferred&&o.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof a.isFixed<"u"&&o.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(a.deltaMin||a.deltaMax)&&o.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),a.fps!==0&&o.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},e.stop=function(a){e._cancelNextFrame(a)},e._onNextFrame=function(a,m){if(typeof window<"u"&&window.requestAnimationFrame)a.frameRequestId=window.requestAnimationFrame(m);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return a.frameRequestId},e._cancelNextFrame=function(a){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(a.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var h=function(a){for(var m=0,u=a.length,t=0;t<u;t+=1)m+=a[t];return m/u||0}})()},function(i,d,c){var e={};i.exports=e;var r=c(8),s=c(0),o=s.deprecated;(function(){e.collides=function(h,a){return r.collides(h,a)},o(e,"collides","SAT.collides  replaced by Collision.collides")})()},function(i,d,c){var e={};i.exports=e,c(1);var r=c(0);(function(){e.pathToVertices=function(s,o){typeof window<"u"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var h,a,m,u,t,l,f,p,v,w,P=[],M,g,y=0,S=0,x=0;o=o||15;var A=function(b,V,E){var B=E%2===1&&E>1;if(!v||b!=v.x||V!=v.y){v&&B?(M=v.x,g=v.y):(M=0,g=0);var D={x:M+b,y:g+V};(B||!v)&&(v=D),P.push(D),S=M+b,x=g+V}},C=function(b){var V=b.pathSegTypeAsLetter.toUpperCase();if(V!=="Z"){switch(V){case"M":case"L":case"T":case"C":case"S":case"Q":S=b.x,x=b.y;break;case"H":S=b.x;break;case"V":x=b.y;break}A(S,x,b.pathSegType)}};for(e._svgPathToAbsolute(s),m=s.getTotalLength(),l=[],h=0;h<s.pathSegList.numberOfItems;h+=1)l.push(s.pathSegList.getItem(h));for(f=l.concat();y<m;){if(w=s.getPathSegAtLength(y),t=l[w],t!=p){for(;f.length&&f[0]!=t;)C(f.shift());p=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":u=s.getPointAtLength(y),A(u.x,u.y,0);break}y+=o}for(h=0,a=f.length;h<a;++h)C(f[h]);return P},e._svgPathToAbsolute=function(s){for(var o,h,a,m,u,t,l=s.pathSegList,f=0,p=0,v=l.numberOfItems,w=0;w<v;++w){var P=l.getItem(w),M=P.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(M))"x"in P&&(f=P.x),"y"in P&&(p=P.y);else switch("x1"in P&&(a=f+P.x1),"x2"in P&&(u=f+P.x2),"y1"in P&&(m=p+P.y1),"y2"in P&&(t=p+P.y2),"x"in P&&(f+=P.x),"y"in P&&(p+=P.y),M){case"m":l.replaceItem(s.createSVGPathSegMovetoAbs(f,p),w);break;case"l":l.replaceItem(s.createSVGPathSegLinetoAbs(f,p),w);break;case"h":l.replaceItem(s.createSVGPathSegLinetoHorizontalAbs(f),w);break;case"v":l.replaceItem(s.createSVGPathSegLinetoVerticalAbs(p),w);break;case"c":l.replaceItem(s.createSVGPathSegCurvetoCubicAbs(f,p,a,m,u,t),w);break;case"s":l.replaceItem(s.createSVGPathSegCurvetoCubicSmoothAbs(f,p,u,t),w);break;case"q":l.replaceItem(s.createSVGPathSegCurvetoQuadraticAbs(f,p,a,m),w);break;case"t":l.replaceItem(s.createSVGPathSegCurvetoQuadraticSmoothAbs(f,p),w);break;case"a":l.replaceItem(s.createSVGPathSegArcAbs(f,p,P.r1,P.r2,P.angle,P.largeArcFlag,P.sweepFlag),w);break;case"z":case"Z":f=o,p=h;break}(M=="M"||M=="m")&&(o=f,h=p)}}})()},function(i,d,c){var e={};i.exports=e;var r=c(6);c(0),function(){e.create=r.create,e.add=r.add,e.remove=r.remove,e.clear=r.clear,e.addComposite=r.addComposite,e.addBody=r.addBody,e.addConstraint=r.addConstraint}()}])})})(cn);const te=new Te(0,0,0,"YXZ"),ne=new I,un={type:"change"},fn={type:"lock"},hn={type:"unlock"},je=Math.PI/2;class xn extends It{constructor(n,i=null){super(n,i),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=mn.bind(this),this._onPointerlockChange=dn.bind(this),this._onPointerlockError=pn.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(n){return n.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(n){if(this.enabled===!1)return;const i=this.object;ne.setFromMatrixColumn(i.matrix,0),ne.crossVectors(i.up,ne),i.position.addScaledVector(ne,n)}moveRight(n){if(this.enabled===!1)return;const i=this.object;ne.setFromMatrixColumn(i.matrix,0),i.position.addScaledVector(ne,n)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function mn(T){if(this.enabled===!1||this.isLocked===!1)return;const n=T.movementX||T.mozMovementX||T.webkitMovementX||0,i=T.movementY||T.mozMovementY||T.webkitMovementY||0,d=this.object;te.setFromQuaternion(d.quaternion),te.y-=n*.002*this.pointerSpeed,te.x-=i*.002*this.pointerSpeed,te.x=Math.max(je-this.maxPolarAngle,Math.min(je-this.minPolarAngle,te.x)),d.quaternion.setFromEuler(te),this.dispatchEvent(un)}function dn(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(fn),this.isLocked=!0):(this.dispatchEvent(hn),this.isLocked=!1)}function pn(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}export{yn as A,xn as P,vn as a,ee as l};
